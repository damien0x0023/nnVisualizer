var app=function(){"use strict";function e(){}function t(e){return e()}function a(){return Object.create(null)}function l(e){e.forEach(t)}function n(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(e,t){e.appendChild(t)}function r(e,t,a){e.insertBefore(t,a||null)}function o(e){e.parentNode.removeChild(e)}function d(e,t){for(let a=0;a<e.length;a+=1)e[a]&&e[a].d(t)}function c(e){return document.createElement(e)}function u(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function p(e){return document.createTextNode(e)}function g(){return p(" ")}function h(){return p("")}function y(e,t,a,l){return e.addEventListener(t,a,l),()=>e.removeEventListener(t,a,l)}function m(e,t,a){null==a?e.removeAttribute(t):e.getAttribute(t)!==a&&e.setAttribute(t,a)}function f(e){return""===e?void 0:+e}function x(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function v(e,t){e.value=null==t?"":t}function b(e,t,a,l){e.style.setProperty(t,a,l?"important":"")}function w(e,t){for(let a=0;a<e.options.length;a+=1){const l=e.options[a];if(l.__value===t)return void(l.selected=!0)}}function k(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}function $(e,t,a){e.classList[a?"add":"remove"](t)}let L;function I(e){L=e}function A(){if(!L)throw new Error("Function called outside component initialization");return L}function N(e){A().$$.on_mount.push(e)}function M(e){A().$$.after_update.push(e)}function C(){const e=A();return(t,a)=>{const l=e.$$.callbacks[t];if(l){const n=function(e,t){const a=document.createEvent("CustomEvent");return a.initCustomEvent(e,!1,!1,t),a}(t,a);l.slice().forEach(t=>{t.call(e,n)})}}}const E=[],R=[],S=[],T=[],_=Promise.resolve();let H=!1;function z(e){S.push(e)}let F=!1;const O=new Set;function G(){if(!F){F=!0;do{for(let e=0;e<E.length;e+=1){const t=E[e];I(t),P(t.$$)}for(E.length=0;R.length;)R.pop()();for(let e=0;e<S.length;e+=1){const t=S[e];O.has(t)||(O.add(t),t())}S.length=0}while(E.length);for(;T.length;)T.pop()();H=!1,F=!1,O.clear()}}function P(e){if(null!==e.fragment){e.update(),l(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(z)}}const B=new Set;let V;function q(){V={r:0,c:[],p:V}}function X(){V.r||l(V.c),V=V.p}function j(e,t){e&&e.i&&(B.delete(e),e.i(t))}function D(e,t,a,l){if(e&&e.o){if(B.has(e))return;B.add(e),V.c.push(()=>{B.delete(e),l&&(a&&e.d(1),l())}),e.o(t)}}function W(e){e&&e.c()}function Y(e,a,s){const{fragment:i,on_mount:r,on_destroy:o,after_update:d}=e.$$;i&&i.m(a,s),z(()=>{const a=r.map(t).filter(n);o?o.push(...a):l(a),e.$$.on_mount=[]}),d.forEach(z)}function K(e,t){const a=e.$$;null!==a.fragment&&(l(a.on_destroy),a.fragment&&a.fragment.d(t),a.on_destroy=a.fragment=null,a.ctx=[])}function U(e,t){-1===e.$$.dirty[0]&&(E.push(e),H||(H=!0,_.then(G)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function J(t,n,s,i,r,d,c=[-1]){const u=L;I(t);const p=n.props||{},g=t.$$={fragment:null,ctx:null,props:d,update:e,not_equal:r,bound:a(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:a(),dirty:c};let h=!1;if(g.ctx=s?s(t,p,(e,a,...l)=>{const n=l.length?l[0]:a;return g.ctx&&r(g.ctx[e],g.ctx[e]=n)&&(g.bound[e]&&g.bound[e](n),h&&U(t,e)),a}):[],g.update(),h=!0,l(g.before_update),g.fragment=!!i&&i(g.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);g.fragment&&g.fragment.l(e),e.forEach(o)}else g.fragment&&g.fragment.c();n.intro&&j(t.$$.fragment),Y(t,n.target,n.anchor),G()}I(u)}class Q{$destroy(){K(this,1),this.$destroy=e}$on(e,t){const a=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return a.push(t),()=>{const e=a.indexOf(t);-1!==e&&a.splice(e,1)}}$set(){}}const Z=[];function ee(t,a=e){let l;const n=[];function i(e){if(s(t,e)&&(t=e,l)){const e=!Z.length;for(let e=0;e<n.length;e+=1){const a=n[e];a[1](),Z.push(a,t)}if(e){for(let e=0;e<Z.length;e+=2)Z[e][0](Z[e+1]);Z.length=0}}}return{set:i,update:function(e){i(e(t))},subscribe:function(s,r=e){const o=[s,r];return n.push(o),1===n.length&&(l=a(i)||e),s(t),()=>{const e=n.indexOf(o);-1!==e&&n.splice(e,1),0===n.length&&(l(),l=null)}}}}const te=ee([]),ae=ee(void 0),le=ee(void 0),ne=ee(void 0),se=ee([]),ie=ee(void 0),re=ee({}),oe=ee([]),de=ee([void 0,void 0]),ce=ee(!0),ue=ee(!1),pe=ee(!1),ge=ee({}),he=ee(!1),ye=ee({}),me=ee({}),fe=ee({}),xe=ee([]),ve=ee(void 0),be=ee(void 0),we=ee(void 0),ke=ee([]),$e=ee(void 0),Le=ee({}),Ie=ee([]),Ae=ee([void 0,void 0]),Ne=ee(!0),Me=ee(!1),Ce=ee(!1),Ee=ee({}),Re=ee(!1),Se=ee({}),Te=ee({}),_e=ee({}),He=(e,t,a)=>{let l=[];for(let n=0;n<e;n++){let e=new Array(t).fill(a);l.push(e)}return l},ze=(e,t)=>{console.assert(e.length===t.length,"Dimension not matching"),console.assert(e[0].length===t[0].length,"Dimension not matching");let a=0;for(let l=0;l<e.length;l++)for(let n=0;n<e[0].length;n++)a+=e[l][n]*t[l][n];return a},Fe=(e,t,a,l,n)=>e.slice(t,a).map(e=>e.slice(l,n)),Oe=e=>{let t=-1/0;for(let a=0;a<e.length;a++)for(let l=0;l<e[0].length;l++)e[a][l]>t&&(t=e[a][l]);return t},Ge=(e,t,a=1,l=0)=>{console.assert(e.length===e[0].length,"Conv input is not square"),console.assert(t.length===t[0].length,"Conv kernel is not square");let n=(e.length-t.length)/a+1,s=He(n,n,0);for(let l=0;l<n;l++)for(let i=0;i<n;i++){let n=Fe(e,l*a,l*a+t.length,i*a,i*a+t.length),r=ze(n,t);s[l][i]=r}return s},Pe=(e,t=2,a=2,l="VALID")=>{console.assert(2===t,"Only supports kernen = [2,2]"),console.assert(2===a,"Only supports stride = 2"),console.assert("VALID"===l,"Only support valid padding"),e.length%2==1&&"VALID"===l&&(e=Fe(e,0,e.length-1,0,e.length-1));let n=(e.length-t)/a+1,s=He(n,n,0);for(let l=0;l<n;l++)for(let i=0;i<n;i++){let n=Fe(e,l*a,l*a+t,i*a,i*a+t);s[l][i]=Oe(n)}return s};function Be(e,t){return Array.from({length:e},t?(e,a)=>t(a):void 0)}function Ve(e,t,a){return Array.from({length:e},(e,l)=>Array.from({length:t},a?(e,t)=>a(l,t):void 0))}function qe(e,t,a,l,n){const s=Ve(t.length,t.length,(e,t)=>Ve(a,a));for(let i=0;i<t.length;i++)for(let r=0;r<t.length;r++)for(let t=0;t<a;t++)for(let o=0;o<a;o++){const a=i*e+t*n,d=r*e+o*n;s[i][r][t][o]=a*l+d}return s}function Xe(e,t,a,l,n,s){const i=Be(a*a);for(let a=0;a<s;a++)for(let l=0;l<s;l++){const s=n[e][t][a][l];void 0!==s&&(i[s]=[a,l])}return i}function je(e,t,a){var l=t.reduce((e,t,a)=>(null!=t&&e.push(a),e),[]);return Fe(e,Math.floor(l[0]/e.length),Math.floor(l[0]/e.length)+a,l[0]%e.length,l[0]%e.length+a)}function De(e,t){var a=t.reduce((e,t,a)=>(0!=t&&e.push(a),e),[]);return Fe(e,Math.floor(a[0]/e.length),Math.floor(a[0]/e.length)+1,a[0]%e.length,a[0]%e.length+1)}function We(e,t,a=1){var l=t.reduce((e,t,a)=>(0!=t&&e.push(a),e),[]);e.length;let n=e[0].length;return Fe(e,Math.floor(l[0]/n),Math.floor(l[0]/n)+a,l[0]%n,l[0]%n+a)}function Ye(e){return 150/e>20?20:150/e}function Ke(e){let t=e.map((function(e){return Math.max.apply(Math,e)})),a=Math.max.apply(null,t),l=e.map((function(e){return Math.min.apply(Math,e)})),n=Math.min.apply(null,l);return{range:2*Math.max(Math.abs(n),Math.abs(a)),min:n,max:a}}function Ue(e,t=Ye(e.length)){for(var a=new Array,l=1,n=1,s=t,i=t,r=0;r<e.length;r++){a.push(new Array);for(var o=0;o<e[0].length;o++)a[r].push({text:Math.round(100*e[r][o])/100,row:r,col:o,x:l,y:n,width:s,height:i}),l+=s;l=1,n+=i}return a}function Je(t){let a;return{c(){a=c("div"),a.innerHTML='<svg id="grid" width="100%" height="100%"></svg>',b(a,"display","inline-block"),b(a,"vertical-align","middle"),m(a,"class","grid")},m(e,l){r(e,a,l),t[10](a)},p:e,i:e,o:e,d(e){e&&o(a),t[10](null)}}}function Qe(e,t,a){let l,{data:n}=t,{highlights:s}=t,{isKernelMath:i}=t,{constraint:r}=t,{dataRange:o}=t,{outputLength:d}=t,{stride:c}=t,{colorScale:u=d3.interpolateRdBu}=t,{isInputLayer:p=!1}=t;const g=C();let h=s,y=n;const m=()=>{d3.select(l).selectAll("#grid > *").remove();const e=n.length*r+2;var t=d3.select(l).select("#grid").attr("width",e+"px").attr("height",e+"px").append("svg").attr("width",e+"px").attr("height",e+"px").selectAll(".row").data(n).enter().append("g").attr("class","row");t.selectAll(".square").data((function(e){return e})).enter().append("rect").attr("class","square").attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y})).attr("width",(function(e){return e.width})).attr("height",(function(e){return e.height})).style("opacity",.8).style("fill",(function(e){let t=e.text;return t=p?1-e.text:(e.text+o/2)/o,u(t)})).on("mouseover",(function(e){n.length!=d?g("message",{hoverH:Math.min(Math.floor(e.row/c),d-1),hoverW:Math.min(Math.floor(e.col/c),d-1)}):g("message",{hoverH:Math.min(Math.floor(e.row/1),d-1),hoverW:Math.min(Math.floor(e.col/1),d-1)})}));if(i)t.selectAll(".text").data((function(e){return e})).enter().append("text").attr("class","text").style("font-size",Math.floor(r/2.6)+"px").attr("x",(function(e){return e.x+e.width/2})).attr("y",(function(e){return e.y+e.height/2})).style("fill",(function(e){let t=e.text;return t=p?1-e.text:(e.text+o/2)/o,t<.2||t>.8?"white":"black"})).style("text-anchor","middle").style("dominant-baseline","middle").text((function(e){return e.text}))};return M(()=>{(n!=y&&(m(),y=n),s!=h)&&(d3.select(l).select("#grid").select("svg").selectAll(".square").style("stroke",e=>i||s.length&&s[e.row*n.length+e.col]?"black":null),h=s)}),N(()=>{m()}),e.$set=e=>{"data"in e&&a(1,n=e.data),"highlights"in e&&a(2,s=e.highlights),"isKernelMath"in e&&a(3,i=e.isKernelMath),"constraint"in e&&a(4,r=e.constraint),"dataRange"in e&&a(5,o=e.dataRange),"outputLength"in e&&a(6,d=e.outputLength),"stride"in e&&a(7,c=e.stride),"colorScale"in e&&a(8,u=e.colorScale),"isInputLayer"in e&&a(9,p=e.isInputLayer)},[l,n,s,i,r,o,d,c,u,p,function(e){R[e?"unshift":"push"](()=>{l=e,a(0,l)})}]}class Ze extends Q{constructor(e){super(),J(this,e,Qe,Je,s,{data:1,highlights:2,isKernelMath:3,constraint:4,dataRange:5,outputLength:6,stride:7,colorScale:8,isInputLayer:9})}}function et(t){let a,l,n;return{c(){a=c("div"),l=g(),n=c("div"),n.innerHTML='<svg id="grid" width="100%" height="100%"></svg>',m(a,"class","legend"),m(n,"class","grid")},m(e,s){r(e,a,s),t[10](a),r(e,l,s),r(e,n,s),t[11](n)},p:e,i:e,o:e,d(e){e&&o(a),t[10](null),e&&o(l),e&&o(n),t[11](null)}}}function tt(e,t,a){let l,n,{data:s}=t,{kernel:i}=t,{constraint:r}=t,{dataRange:o}=t,{kernelRange:d}=t,{colorScale:c=d3.interpolateRdBu}=t,{kernelColorScale:u=d3.interpolateBrBG}=t,{isInputLayer:p=!1}=t;const g=Math.floor(r/3);let h=s;const y=()=>{d3.select(l).selectAll("#grid > *").remove();const e=i?s.length*r*2+2:s.length*r+2;var t=d3.select(l).select("#grid").attr("width",e+"px").attr("height",e+"px").append("svg").attr("width",e+"px").attr("height",e+"px").selectAll(".row").data(s).enter().append("g").attr("class","row"),a=t.selectAll(".square").data((function(e){return e})).enter();a.append("rect").attr("class","square").attr("x",(function(e){return 1===e.x?e.x+g:2*e.x+g})).attr("y",(function(e){return 1===e.y?e.y:2*e.y})).attr("width",(function(e){return e.width})).attr("height",(function(e){return e.height})).style("opacity",.5).style("fill",(function(e){let t=e.text;return t=p?1-e.text:(e.text+o/2)/o,c(t)})).style("stroke","black"),a.append("rect").attr("class","square").attr("x",(function(e){return 1===e.x?e.x+g:2*e.x+g})).attr("y",(function(e){return 1===e.y?e.y+e.height:2*e.y+e.height})).attr("width",(function(e){return e.width})).attr("height",(function(e){return e.height/2})).style("opacity",.5).style("fill",(function(e){let t=(i[e.row][e.col].text+d.range/2)/d.range;return u(.6*t+.2)}));var n=t.selectAll(".text").data((function(e){return e})).enter();n.append("text").attr("class","text").style("font-size",Math.floor(r/2.6)+"px").attr("x",(function(e){return 1===e.x?e.x+e.width/2+g:2*e.x+e.width/2+g})).attr("y",(function(e){return 1===e.y?e.y+e.height/2:2*e.y+e.height/2})).style("fill",(function(e){let t=e.text;return t=p?1-e.text:(e.text+o/2)/o,t<.2||t>.8?p&&t<.2?"black":"white":"black"})).style("text-anchor","middle").style("dominant-baseline","middle").text((function(e){return e.text})),n.append("text").attr("class","text").style("font-size",Math.floor(r/2.6)+"px").attr("font-weight",600).attr("x",(function(e){return 1===e.x?e.x+g/2:2*e.x+g/2})).attr("y",(function(e){return 1===e.y?e.y+e.height+e.height/4:2*e.y+e.height+e.height/4})).style("fill","black").style("text-anchor","middle").style("dominant-baseline","middle").text((function(e){return"×"})),n.append("text").attr("class","text").style("font-size",Math.floor(r/2.6)+"px").attr("x",(function(e){return 1===e.x?e.x+e.width/2+g:2*e.x+e.width/2+g})).attr("y",(function(e){return 1===e.y?e.y+e.height+e.height/4:2*e.y+e.height+e.height/4})).style("fill",(function(e){let t=.6*((i[e.row][e.col].text+d.range/2)/d.range)+.2;return t<.2||t>.8?"white":"black"})).style("text-anchor","middle").style("dominant-baseline","middle").text((function(e){return i[e.row][e.col].text})),n.append("text").attr("class","text").style("font-size",Math.floor(r/1.6)+"px").attr("x",(function(e){return 1===e.x?e.x+e.width+e.width/2+g:2*e.x+e.width+e.width/2+g})).attr("y",(function(e){return 1===e.y?e.y+e.height/2:2*e.y+e.height/2})).style("text-anchor","middle").style("dominant-baseline","middle").text((function(e){return e.row==i.length-1&&e.col==i.length-1?"=":"+"}))};return M(()=>{s!=h&&(y(),h=s)}),N(()=>{y()}),e.$set=e=>{"data"in e&&a(2,s=e.data),"kernel"in e&&a(3,i=e.kernel),"constraint"in e&&a(4,r=e.constraint),"dataRange"in e&&a(5,o=e.dataRange),"kernelRange"in e&&a(6,d=e.kernelRange),"colorScale"in e&&a(7,c=e.colorScale),"kernelColorScale"in e&&a(8,u=e.kernelColorScale),"isInputLayer"in e&&a(9,p=e.isInputLayer)},[l,n,s,i,r,o,d,c,u,p,function(e){R[e?"unshift":"push"](()=>{n=e,a(1,n)})},function(e){R[e?"unshift":"push"](()=>{l=e,a(0,l)})}]}class at extends Q{constructor(e){super(),J(this,e,tt,et,s,{data:2,kernel:3,constraint:4,dataRange:5,kernelRange:6,colorScale:7,kernelColorScale:8,isInputLayer:9})}}function lt(e){let t,a,l,n,s,d,u,h,y,f,v,b,w,k,$,L,I,A,N,M,C,E,R,S,T,_=e[2].length+"",H=e[2][0].length+"",z=e[3].length+"",F=e[3][0].length+"";return y=new Ze({props:{data:e[11],highlights:e[9],outputLength:e[3].length,isKernelMath:!1,constraint:Ye(e[2].length),dataRange:e[4],stride:e[0],colorScale:e[5],isInputLayer:e[6]}}),y.$on("message",e[14]),b=new at({props:{data:e[7],kernel:e[13],constraint:Ye(e[1].length),dataRange:e[4],kernelRange:Ke(e[1]),colorScale:e[5],isInputLayer:e[6]}}),k=new Ze({props:{data:e[8],highlights:e[10],isKernelMath:!0,constraint:Ye(e[1].length),dataRange:e[4]}}),S=new Ze({props:{data:e[12],highlights:e[10],isKernelMath:!1,outputLength:e[3].length,constraint:Ye(e[3].length),dataRange:e[4],stride:e[0]}}),S.$on("message",e[14]),{c(){t=c("div"),a=c("div"),l=p("Input ("),n=p(_),s=p(", "),d=p(H),u=p(")"),h=g(),W(y.$$.fragment),f=g(),v=c("div"),W(b.$$.fragment),w=g(),W(k.$$.fragment),$=g(),L=c("div"),I=c("div"),A=p("Output ("),N=p(z),M=p(", "),C=p(F),E=p(")"),R=g(),W(S.$$.fragment),m(a,"class","header-text"),m(t,"class","column has-text-centered svelte-gz7a6i"),m(v,"class","column has-text-centered svelte-gz7a6i"),m(I,"class","header-text"),m(L,"class","column has-text-centered svelte-gz7a6i")},m(e,o){r(e,t,o),i(t,a),i(a,l),i(a,n),i(a,s),i(a,d),i(a,u),i(t,h),Y(y,t,null),r(e,f,o),r(e,v,o),Y(b,v,null),i(v,w),Y(k,v,null),r(e,$,o),r(e,L,o),i(L,I),i(I,A),i(I,N),i(I,M),i(I,C),i(I,E),i(L,R),Y(S,L,null),T=!0},p(e,[t]){(!T||4&t)&&_!==(_=e[2].length+"")&&x(n,_),(!T||4&t)&&H!==(H=e[2][0].length+"")&&x(d,H);const a={};2048&t&&(a.data=e[11]),512&t&&(a.highlights=e[9]),8&t&&(a.outputLength=e[3].length),4&t&&(a.constraint=Ye(e[2].length)),16&t&&(a.dataRange=e[4]),1&t&&(a.stride=e[0]),32&t&&(a.colorScale=e[5]),64&t&&(a.isInputLayer=e[6]),y.$set(a);const l={};128&t&&(l.data=e[7]),8192&t&&(l.kernel=e[13]),2&t&&(l.constraint=Ye(e[1].length)),16&t&&(l.dataRange=e[4]),2&t&&(l.kernelRange=Ke(e[1])),32&t&&(l.colorScale=e[5]),64&t&&(l.isInputLayer=e[6]),b.$set(l);const s={};256&t&&(s.data=e[8]),1024&t&&(s.highlights=e[10]),2&t&&(s.constraint=Ye(e[1].length)),16&t&&(s.dataRange=e[4]),k.$set(s),(!T||8&t)&&z!==(z=e[3].length+"")&&x(N,z),(!T||8&t)&&F!==(F=e[3][0].length+"")&&x(C,F);const i={};4096&t&&(i.data=e[12]),1024&t&&(i.highlights=e[10]),8&t&&(i.outputLength=e[3].length),8&t&&(i.constraint=Ye(e[3].length)),16&t&&(i.dataRange=e[4]),1&t&&(i.stride=e[0]),S.$set(i)},i(e){T||(j(y.$$.fragment,e),j(b.$$.fragment,e),j(k.$$.fragment,e),j(S.$$.fragment,e),T=!0)},o(e){D(y.$$.fragment,e),D(b.$$.fragment,e),D(k.$$.fragment,e),D(S.$$.fragment,e),T=!1},d(e){e&&o(t),K(y),e&&o(f),e&&o(v),K(b),K(k),e&&o($),e&&o(L),K(S)}}}function nt(e,t,a){let{stride:l}=t,{dilation:n}=t,{kernel:s}=t,{image:i}=t,{output:r}=t,{isPaused:o}=t,{dataRange:d}=t,{colorScale:c}=t,{isInputInputLayer:u=!1}=t;const p=C();let g=i.length+0,h=[];for(let e=0;e<s.length;e++){h.push([]);for(let t=0;t<s.length;t++)h[e].push(0)}h=Ue(h);let y,m,f=Ue([0]),x=[],v=Be(r.length*r.length,e=>!0);function b(e){m=0;let t=qe(e,r,s.length,g,n);e<=0||(y&&clearInterval(y),a(18,y=setInterval(()=>{if(o)return;const e=m%(r.length*r.length);a(10,v=Be(r.length*r.length,e=>!1));const l=Math.floor(e/r.length),n=e%r.length;a(10,v[l*r.length+n]=!0,v),a(9,x=Xe(l,n,g,s.length,t,s.length));const d=je(i,x,s.length);a(7,h=Ue(d));const c=De(r,v);a(8,f=Ue(c)),m++},250)))}b(l);let w=Ue(i),k=Ue(r),$=Ue(s);return e.$set=e=>{"stride"in e&&a(0,l=e.stride),"dilation"in e&&a(16,n=e.dilation),"kernel"in e&&a(1,s=e.kernel),"image"in e&&a(2,i=e.image),"output"in e&&a(3,r=e.output),"isPaused"in e&&a(15,o=e.isPaused),"dataRange"in e&&a(4,d=e.dataRange),"colorScale"in e&&a(5,c=e.colorScale),"isInputInputLayer"in e&&a(6,u=e.isInputInputLayer)},e.$$.update=()=>{if(4&e.$$.dirty&&(g=i.length+0),8&e.$$.dirty){Be(r.length*r.length,e=>!0)}15&e.$$.dirty&&(b(l),a(11,w=Ue(i)),a(12,k=Ue(r)),a(13,$=Ue(s)))},[l,s,i,r,d,c,u,h,f,x,v,w,k,$,function(e){let t=qe(l,r,s.length,g,n);a(10,v=Be(r.length*r.length,e=>!1));const d=e.detail.hoverH,c=e.detail.hoverW;a(10,v[d*r.length+c]=!0,v),a(9,x=Xe(d,c,g,s.length,t,s.length));const u=je(i,x,s.length);a(7,h=Ue(u));const y=De(r,v);a(8,f=Ue(y)),a(15,o=!0),p("message",{text:o})},o,n]}class st extends Q{constructor(e){super(),J(this,e,nt,lt,s,{stride:0,dilation:16,kernel:1,image:2,output:3,isPaused:15,dataRange:4,colorScale:5,isInputInputLayer:6})}}function it(e){let t,a,n,s,d,u,p,h,f,x,v,b,w,k,$,L,I,A,N,M=e[6]?'<i class="fas fa-play-circle play-icon"></i>':'<i class="fas fa-pause-circle"></i>';return k=new st({props:{kernel:e[2],image:e[1],output:e[7],stride:ot,dilation:dt,isPaused:e[6],dataRange:e[3],colorScale:e[4],isInputInputLayer:e[5]}}),k.$on("message",e[9]),{c(){t=c("div"),a=c("div"),n=c("div"),s=c("div"),s.textContent="Convolution",d=g(),u=c("div"),p=c("div"),p.innerHTML='<i class="fas fa-info-circle"></i>',h=g(),f=c("div"),x=g(),v=c("div"),v.innerHTML='<i class="fas control-icon fa-times-circle"></i>',b=g(),w=c("div"),W(k.$$.fragment),$=g(),L=c("div"),L.innerHTML='<img src="/rnnExplainer/assets/img/pointer.svg" alt="pointer icon" class="svelte-1j8mhv0"> \n        <div class="annotation-text"><span style="font-weight:600">Hover over</span> the matrices to change kernel position.</div>',m(s,"class","title-text svelte-1j8mhv0"),m(p,"class","control-button svelte-1j8mhv0"),m(p,"title","Jump to article section"),m(f,"class","play-button control-button svelte-1j8mhv0"),m(f,"title","Play animation"),m(v,"class","delete-button control-button svelte-1j8mhv0"),m(v,"title","Close"),m(u,"class","buttons svelte-1j8mhv0"),m(n,"class","control-pannel svelte-1j8mhv0"),m(w,"class","container is-centered svelte-1j8mhv0"),m(L,"class","annotation svelte-1j8mhv0"),m(a,"class","box svelte-1j8mhv0"),m(t,"class","container svelte-1j8mhv0"),m(t,"id","detailview-container")},m(l,o){r(l,t,o),i(t,a),i(a,n),i(n,s),i(n,d),i(n,u),i(u,p),i(u,h),i(u,f),f.innerHTML=M,i(u,x),i(u,v),i(a,b),i(a,w),Y(k,w,null),i(a,$),i(a,L),I=!0,A||(N=[y(p,"click",ct),y(f,"click",e[8]),y(v,"click",e[10])],A=!0)},p(e,t){(!I||64&t)&&M!==(M=e[6]?'<i class="fas fa-play-circle play-icon"></i>':'<i class="fas fa-pause-circle"></i>')&&(f.innerHTML=M);const a={};4&t&&(a.kernel=e[2]),2&t&&(a.image=e[1]),128&t&&(a.output=e[7]),64&t&&(a.isPaused=e[6]),8&t&&(a.dataRange=e[3]),16&t&&(a.colorScale=e[4]),32&t&&(a.isInputInputLayer=e[5]),k.$set(a)},i(e){I||(j(k.$$.fragment,e),I=!0)},o(e){D(k.$$.fragment,e),I=!1},d(e){e&&o(t),K(k),A=!1,l(N)}}}function rt(e){let t,a,l=!e[0]&&it(e);return{c(){l&&l.c(),t=h()},m(e,n){l&&l.m(e,n),r(e,t,n),a=!0},p(e,[a]){e[0]?l&&(q(),D(l,1,1,()=>{l=null}),X()):l?(l.p(e,a),1&a&&j(l,1)):(l=it(e),l.c(),j(l,1),l.m(t.parentNode,t))},i(e){a||(j(l),a=!0)},o(e){D(l),a=!1},d(e){l&&l.d(e),e&&o(t)}}}let ot=1;const dt=1;function ct(){let e=Number(d3.select("#cnn-svg").style("height").replace("px",""))+150,t=new SmoothScroll('a[href*="#"]',{offset:-e}),a=document.querySelector("#article-convolution");t.animateScroll(a)}function ut(e,t,a){let{input:l}=t,{kernel:n}=t,{dataRange:s}=t,{colorScale:i=d3.interpolateRdBu}=t,{isInputInputLayer:r=!1}=t,{isExited:o=!1}=t;const d=C();var c=!1,u=Ge(l,n,ot);return e.$set=e=>{"input"in e&&a(1,l=e.input),"kernel"in e&&a(2,n=e.kernel),"dataRange"in e&&a(3,s=e.dataRange),"colorScale"in e&&a(4,i=e.colorScale),"isInputInputLayer"in e&&a(5,r=e.isInputInputLayer),"isExited"in e&&a(0,o=e.isExited)},e.$$.update=()=>{if(6&e.$$.dirty)try{a(7,u=Ge(l,n,ot))}catch{console.log("Cannot handle stride of "+ot)}},[o,l,n,s,i,r,c,u,function(){a(6,c=!c)},function(e){a(6,c=e.detail.text)},function(){a(0,o=!0),d("message",{text:o})}]}class pt extends Q{constructor(e){super(),J(this,e,ut,rt,s,{input:1,kernel:2,dataRange:3,colorScale:4,isInputInputLayer:5,isExited:0})}}function gt(e){let t,a,l,n,s,d,u,h,y,f,v,b,w,k,$,L,I,A,N,M,C,E,R,S,T,_,H,z,F,O=e[0].length+"",G=e[0][0].length+"",P=e[1].length+"",B=e[1][0].length+"";return y=new Ze({props:{data:e[7],highlights:e[5],outputLength:e[1].length,isKernelMath:!1,constraint:Ye(e[0].length),dataRange:e[2],stride:1}}),y.$on("message",e[9]),k=new Ze({props:{data:Ue([[0]]),highlights:e[6],isKernelMath:!0,constraint:20,dataRange:e[2]}}),L=new Ze({props:{data:e[3],highlights:e[6],isKernelMath:!0,constraint:20,dataRange:e[2]}}),A=new Ze({props:{data:e[4],highlights:e[6],isKernelMath:!0,constraint:20,dataRange:e[2]}}),z=new Ze({props:{data:e[8],highlights:e[6],isKernelMath:!1,outputLength:e[1].length,constraint:Ye(e[1].length),dataRange:e[2],stride:1}}),z.$on("message",e[9]),{c(){t=c("div"),a=c("div"),l=p("Input ("),n=p(O),s=p(", "),d=p(G),u=p(")"),h=g(),W(y.$$.fragment),f=g(),v=c("div"),b=c("span"),w=p("max(\n    "),W(k.$$.fragment),$=p("\n    ,\n    "),W(L.$$.fragment),I=p("\n    )\n    =\n    "),W(A.$$.fragment),N=g(),M=c("div"),C=c("div"),E=p("Output ("),R=p(P),S=p(", "),T=p(B),_=p(")"),H=g(),W(z.$$.fragment),m(a,"class","header-text"),m(t,"class","column has-text-centered svelte-gz7a6i"),m(v,"class","column has-text-centered svelte-gz7a6i"),m(C,"class","header-text"),m(M,"class","column has-text-centered svelte-gz7a6i")},m(e,o){r(e,t,o),i(t,a),i(a,l),i(a,n),i(a,s),i(a,d),i(a,u),i(t,h),Y(y,t,null),r(e,f,o),r(e,v,o),i(v,b),i(b,w),Y(k,b,null),i(b,$),Y(L,b,null),i(b,I),Y(A,b,null),r(e,N,o),r(e,M,o),i(M,C),i(C,E),i(C,R),i(C,S),i(C,T),i(C,_),i(M,H),Y(z,M,null),F=!0},p(e,[t]){(!F||1&t)&&O!==(O=e[0].length+"")&&x(n,O),(!F||1&t)&&G!==(G=e[0][0].length+"")&&x(d,G);const a={};128&t&&(a.data=e[7]),32&t&&(a.highlights=e[5]),2&t&&(a.outputLength=e[1].length),1&t&&(a.constraint=Ye(e[0].length)),4&t&&(a.dataRange=e[2]),y.$set(a);const l={};64&t&&(l.highlights=e[6]),4&t&&(l.dataRange=e[2]),k.$set(l);const s={};8&t&&(s.data=e[3]),64&t&&(s.highlights=e[6]),4&t&&(s.dataRange=e[2]),L.$set(s);const i={};16&t&&(i.data=e[4]),64&t&&(i.highlights=e[6]),4&t&&(i.dataRange=e[2]),A.$set(i),(!F||2&t)&&P!==(P=e[1].length+"")&&x(R,P),(!F||2&t)&&B!==(B=e[1][0].length+"")&&x(T,B);const r={};256&t&&(r.data=e[8]),64&t&&(r.highlights=e[6]),2&t&&(r.outputLength=e[1].length),2&t&&(r.constraint=Ye(e[1].length)),4&t&&(r.dataRange=e[2]),z.$set(r)},i(e){F||(j(y.$$.fragment,e),j(k.$$.fragment,e),j(L.$$.fragment,e),j(A.$$.fragment,e),j(z.$$.fragment,e),F=!0)},o(e){D(y.$$.fragment,e),D(k.$$.fragment,e),D(L.$$.fragment,e),D(A.$$.fragment,e),D(z.$$.fragment,e),F=!1},d(e){e&&o(t),K(y),e&&o(f),e&&o(v),K(k),K(L),K(A),e&&o(N),e&&o(M),K(z)}}}function ht(e,t,a){let{image:l}=t,{output:n}=t,{isPaused:s}=t,{dataRange:i}=t;const r=C();let o,d,c=l.length+0,u=Ue([[0]]),p=Ue([[0]]),g=Be(l.length*l.length,e=>!0),h=Be(n.length*n.length,e=>!0);function y(){d=0,o&&clearInterval(o),a(12,o=setInterval(()=>{if(s)return;const e=d%(n.length*n.length);a(6,h=Be(n.length*n.length,e=>!1)),a(5,g=Be(l.length*l.length,e=>{}));const t=Math.floor(e/n.length),i=e%n.length;a(6,h[t*n.length+i]=!0,h),a(5,g[t*n.length+i]=!0,g);const r=je(l,g,1);a(3,u=Ue(r));const o=De(n,h);a(4,p=Ue(o)),d++},250))}y();let m=Ue(l),f=Ue(n);return e.$set=e=>{"image"in e&&a(0,l=e.image),"output"in e&&a(1,n=e.output),"isPaused"in e&&a(10,s=e.isPaused),"dataRange"in e&&a(2,i=e.dataRange)},e.$$.update=()=>{if(1&e.$$.dirty&&(c=l.length+0),3&e.$$.dirty){Be(l.length*l.length,e=>!0),Be(n.length*n.length,e=>!0)}3&e.$$.dirty&&(y(),a(7,m=Ue(l)),a(8,f=Ue(n)))},[l,n,i,u,p,g,h,m,f,function(e){a(6,h=Be(n.length*n.length,e=>!1));const t=e.detail.hoverH,i=e.detail.hoverW;a(6,h[t*n.length+i]=!0,h),a(5,g=Be(l.length*l.length,e=>{})),a(5,g[t*n.length+i]=!0,g);const o=je(l,g,1);a(3,u=Ue(o));const d=De(n,h);a(4,p=Ue(d)),a(10,s=!0),r("message",{text:s})},s]}class yt extends Q{constructor(e){super(),J(this,e,ht,gt,s,{image:0,output:1,isPaused:10,dataRange:2})}}function mt(e){let t,a,n,s,d,u,p,h,f,x,v,b,w,k,$,L,I,A,N,M=e[4]?'<i class="fas fa-play-circle play-icon"></i>':'<i class="fas fa-pause-circle"></i>';return k=new yt({props:{image:e[0],output:e[1],isPaused:e[4],dataRange:e[2]}}),k.$on("message",e[6]),{c(){t=c("div"),a=c("div"),n=c("div"),s=c("div"),s.textContent="ReLU Activation",d=g(),u=c("div"),p=c("div"),p.innerHTML='<i class="fas fa-info-circle"></i>',h=g(),f=c("div"),x=g(),v=c("div"),v.innerHTML='<i class="fas control-icon fa-times-circle"></i>',b=g(),w=c("div"),W(k.$$.fragment),$=g(),L=c("div"),L.innerHTML='<img src="/rnnExplainer/assets/img/pointer.svg" alt="pointer icon" class="svelte-1lq7956"> \n        <div class="annotation-text"><span style="font-weight:600">Hover over</span> the matrices to change pixel.</div>',m(s,"class","title-text svelte-1lq7956"),m(p,"class","control-button svelte-1lq7956"),m(p,"title","Jump to article section"),m(f,"class","play-button control-button svelte-1lq7956"),m(f,"title","Play animation"),m(v,"class","delete-button control-button svelte-1lq7956"),m(v,"title","Close"),m(u,"class","buttons svelte-1lq7956"),m(n,"class","control-pannel svelte-1lq7956"),m(w,"class","container is-centered is-vcentered svelte-1lq7956"),m(L,"class","annotation svelte-1lq7956"),m(a,"class","box svelte-1lq7956"),m(t,"class","container svelte-1lq7956")},m(l,o){r(l,t,o),i(t,a),i(a,n),i(n,s),i(n,d),i(n,u),i(u,p),i(u,h),i(u,f),f.innerHTML=M,i(u,x),i(u,v),i(a,b),i(a,w),Y(k,w,null),i(a,$),i(a,L),I=!0,A||(N=[y(p,"click",xt),y(f,"click",e[5]),y(v,"click",e[7])],A=!0)},p(e,t){(!I||16&t)&&M!==(M=e[4]?'<i class="fas fa-play-circle play-icon"></i>':'<i class="fas fa-pause-circle"></i>')&&(f.innerHTML=M);const a={};1&t&&(a.image=e[0]),2&t&&(a.output=e[1]),16&t&&(a.isPaused=e[4]),4&t&&(a.dataRange=e[2]),k.$set(a)},i(e){I||(j(k.$$.fragment,e),I=!0)},o(e){D(k.$$.fragment,e),I=!1},d(e){e&&o(t),K(k),A=!1,l(N)}}}function ft(e){let t,a,l=!e[3]&&mt(e);return{c(){l&&l.c(),t=h()},m(e,n){l&&l.m(e,n),r(e,t,n),a=!0},p(e,[a]){e[3]?l&&(q(),D(l,1,1,()=>{l=null}),X()):l?(l.p(e,a),8&a&&j(l,1)):(l=mt(e),l.c(),j(l,1),l.m(t.parentNode,t))},i(e){a||(j(l),a=!0)},o(e){D(l),a=!1},d(e){l&&l.d(e),e&&o(t)}}}function xt(){let e=Number(d3.select("#cnn-svg").style("height").replace("px",""))+150,t=new SmoothScroll('a[href*="#"]',{offset:-e}),a=document.querySelector("#article-relu");t.animateScroll(a)}function vt(e,t,a){let{input:l}=t,{output:n}=t,{dataRange:s}=t,{isExited:i}=t;const r=C();let o=!1;return e.$set=e=>{"input"in e&&a(0,l=e.input),"output"in e&&a(1,n=e.output),"dataRange"in e&&a(2,s=e.dataRange),"isExited"in e&&a(3,i=e.isExited)},[l,n,s,i,o,function(){a(4,o=!o)},function(e){a(4,o=e.detail.text)},function(){r("message",{text:!0})}]}class bt extends Q{constructor(e){super(),J(this,e,vt,ft,s,{input:0,output:1,dataRange:2,isExited:3})}}function wt(e){let t,a,l,n,s,d,u,h,y,f,v,b,w,k,$,L,I,A,N,M,C,E,R,S,T,_,H,z=e[9].length+"",F=e[9][0].length+"",O=e[10].length+"",G=e[10][0].length+"";return y=new Ze({props:{data:e[9],highlights:e[7],outputLength:e[3].length,isKernelMath:!1,constraint:Ye(e[2].length),dataRange:e[4],stride:e[0]}}),y.$on("message",e[11]),k=new Ze({props:{data:e[5],highlights:e[8],isKernelMath:!0,constraint:Ye(e[1]),dataRange:e[4]}}),L=new Ze({props:{data:e[6],highlights:e[8],isKernelMath:!0,constraint:Ye(e[1]),dataRange:e[4]}}),_=new Ze({props:{data:e[10],highlights:e[8],isKernelMath:!1,outputLength:e[3].length,constraint:Ye(e[3].length),dataRange:e[4],stride:e[0]}}),_.$on("message",e[11]),{c(){t=c("div"),a=c("div"),l=p("Input ("),n=p(z),s=p(", "),d=p(F),u=p(")"),h=g(),W(y.$$.fragment),f=g(),v=c("div"),b=c("span"),w=p("max(\n    "),W(k.$$.fragment),$=p("\n    )\n    =\n    "),W(L.$$.fragment),I=g(),A=c("div"),N=c("div"),M=p("Output ("),C=p(O),E=p(", "),R=p(G),S=p(")"),T=g(),W(_.$$.fragment),m(a,"class","header-text"),m(t,"class","column has-text-centered svelte-gz7a6i"),m(v,"class","column has-text-centered svelte-gz7a6i"),m(N,"class","header-text"),m(A,"class","column has-text-centered svelte-gz7a6i")},m(e,o){r(e,t,o),i(t,a),i(a,l),i(a,n),i(a,s),i(a,d),i(a,u),i(t,h),Y(y,t,null),r(e,f,o),r(e,v,o),i(v,b),i(b,w),Y(k,b,null),i(b,$),Y(L,b,null),r(e,I,o),r(e,A,o),i(A,N),i(N,M),i(N,C),i(N,E),i(N,R),i(N,S),i(A,T),Y(_,A,null),H=!0},p(e,[t]){(!H||512&t)&&z!==(z=e[9].length+"")&&x(n,z),(!H||512&t)&&F!==(F=e[9][0].length+"")&&x(d,F);const a={};512&t&&(a.data=e[9]),128&t&&(a.highlights=e[7]),8&t&&(a.outputLength=e[3].length),4&t&&(a.constraint=Ye(e[2].length)),16&t&&(a.dataRange=e[4]),1&t&&(a.stride=e[0]),y.$set(a);const l={};32&t&&(l.data=e[5]),256&t&&(l.highlights=e[8]),2&t&&(l.constraint=Ye(e[1])),16&t&&(l.dataRange=e[4]),k.$set(l);const s={};64&t&&(s.data=e[6]),256&t&&(s.highlights=e[8]),2&t&&(s.constraint=Ye(e[1])),16&t&&(s.dataRange=e[4]),L.$set(s),(!H||1024&t)&&O!==(O=e[10].length+"")&&x(C,O),(!H||1024&t)&&G!==(G=e[10][0].length+"")&&x(R,G);const i={};1024&t&&(i.data=e[10]),256&t&&(i.highlights=e[8]),8&t&&(i.outputLength=e[3].length),8&t&&(i.constraint=Ye(e[3].length)),16&t&&(i.dataRange=e[4]),1&t&&(i.stride=e[0]),_.$set(i)},i(e){H||(j(y.$$.fragment,e),j(k.$$.fragment,e),j(L.$$.fragment,e),j(_.$$.fragment,e),H=!0)},o(e){D(y.$$.fragment,e),D(k.$$.fragment,e),D(L.$$.fragment,e),D(_.$$.fragment,e),H=!1},d(e){e&&o(t),K(y),e&&o(f),e&&o(v),K(k),K(L),e&&o(I),e&&o(A),K(_)}}}function kt(e,t,a){let{stride:l}=t,{dilation:n}=t,{kernelLength:s}=t,{image:i}=t,{output:r}=t,{isPaused:o}=t,{dataRange:d}=t;const c=C();let u=i.length+0,p=[];for(let e=0;e<s;e++){p.push([]);for(let t=0;t<s;t++)p[e].push(0)}p=Ue(p);let g,h,y=Ue([[0]]),m=[],f=Be(r.length*r.length,e=>!0);function x(e){h=0;let t=qe(e,r,s,u,n);e<=0||(g&&clearInterval(g),a(15,g=setInterval(()=>{if(o)return;const e=h%(r.length*r.length);a(8,f=Be(r.length*r.length,e=>!1));const l=Math.floor(e/r.length),n=e%r.length;a(8,f[l*r.length+n]=!0,f),a(7,m=Xe(l,n,u,0,t,s));const d=je(i,m,s);a(5,p=Ue(d));const c=De(r,f);a(6,y=Ue(c)),h++},250)))}x(l);let v=Ue(i),b=Ue(r);return e.$set=e=>{"stride"in e&&a(0,l=e.stride),"dilation"in e&&a(13,n=e.dilation),"kernelLength"in e&&a(1,s=e.kernelLength),"image"in e&&a(2,i=e.image),"output"in e&&a(3,r=e.output),"isPaused"in e&&a(12,o=e.isPaused),"dataRange"in e&&a(4,d=e.dataRange)},e.$$.update=()=>{if(4&e.$$.dirty&&(u=i.length+0),8&e.$$.dirty){Be(r.length*r.length,e=>!0)}13&e.$$.dirty&&(x(l),a(9,v=Ue(i)),a(10,b=Ue(r)))},[l,s,i,r,d,p,y,m,f,v,b,function(e){let t=qe(l,r,s,u,n);a(8,f=Be(r.length*r.length,e=>!1));const d=e.detail.hoverH,g=e.detail.hoverW;a(8,f[d*r.length+g]=!0,f),a(7,m=Xe(d,g,u,0,t,s));const h=je(i,m,s);a(5,p=Ue(h));const x=De(r,f);a(6,y=Ue(x)),a(12,o=!0),c("message",{text:o})},o,n]}class $t extends Q{constructor(e){super(),J(this,e,kt,wt,s,{stride:0,dilation:13,kernelLength:1,image:2,output:3,isPaused:12,dataRange:4})}}function Lt(e){let t,a,n,s,d,u,p,h,f,x,v,b,w,k,$,L,I,A,N,M=e[4]?'<i class="fas fa-play-circle play-icon"></i>':'<i class="fas fa-pause-circle"></i>';return k=new $t({props:{kernelLength:e[1],image:e[0],output:e[5],stride:At,dilation:Nt,isPaused:e[4],dataRange:e[2]}}),k.$on("message",e[7]),{c(){t=c("div"),a=c("div"),n=c("div"),s=c("div"),s.textContent="Max Pooling",d=g(),u=c("div"),p=c("div"),p.innerHTML='<i class="fas fa-info-circle"></i>',h=g(),f=c("div"),x=g(),v=c("div"),v.innerHTML='<i class="fas control-icon fa-times-circle"></i>',b=g(),w=c("div"),W(k.$$.fragment),$=g(),L=c("div"),L.innerHTML='<img src="/rnnExplainer/assets/img/pointer.svg" alt="pointer icon" class="svelte-kahisg"> \n          <div class="annotation-text"><span style="font-weight:600">Hover over</span> the matrices to change kernel position.</div>',m(s,"class","title-text svelte-kahisg"),m(p,"class","control-button svelte-kahisg"),m(p,"title","Jump to article section"),m(f,"class","play-button control-button svelte-kahisg"),m(f,"title","Play animation"),m(v,"class","delete-button control-button svelte-kahisg"),m(v,"title","Close"),m(u,"class","buttons svelte-kahisg"),m(n,"class","control-pannel svelte-kahisg"),m(w,"class","container is-centered is-vcentered svelte-kahisg"),m(L,"class","annotation svelte-kahisg"),m(a,"class","box svelte-kahisg"),m(t,"class","container svelte-kahisg")},m(l,o){r(l,t,o),i(t,a),i(a,n),i(n,s),i(n,d),i(n,u),i(u,p),i(u,h),i(u,f),f.innerHTML=M,i(u,x),i(u,v),i(a,b),i(a,w),Y(k,w,null),i(a,$),i(a,L),I=!0,A||(N=[y(p,"click",Mt),y(f,"click",e[6]),y(v,"click",e[8])],A=!0)},p(e,t){(!I||16&t)&&M!==(M=e[4]?'<i class="fas fa-play-circle play-icon"></i>':'<i class="fas fa-pause-circle"></i>')&&(f.innerHTML=M);const a={};2&t&&(a.kernelLength=e[1]),1&t&&(a.image=e[0]),32&t&&(a.output=e[5]),16&t&&(a.isPaused=e[4]),4&t&&(a.dataRange=e[2]),k.$set(a)},i(e){I||(j(k.$$.fragment,e),I=!0)},o(e){D(k.$$.fragment,e),I=!1},d(e){e&&o(t),K(k),A=!1,l(N)}}}function It(e){let t,a,l=!e[3]&&Lt(e);return{c(){l&&l.c(),t=h()},m(e,n){l&&l.m(e,n),r(e,t,n),a=!0},p(e,[a]){e[3]?l&&(q(),D(l,1,1,()=>{l=null}),X()):l?(l.p(e,a),8&a&&j(l,1)):(l=Lt(e),l.c(),j(l,1),l.m(t.parentNode,t))},i(e){a||(j(l),a=!0)},o(e){D(l),a=!1},d(e){l&&l.d(e),e&&o(t)}}}let At=2;const Nt=1;function Mt(){let e=Number(d3.select("#cnn-svg").style("height").replace("px",""))+150,t=new SmoothScroll('a[href*="#"]',{offset:-e}),a=document.querySelector("#article-pooling");t.animateScroll(a)}function Ct(e,t,a){let{input:l}=t,{kernelLength:n}=t,{dataRange:s}=t,{isExited:i}=t;const r=C();var o=!1,d=Pe(l);return e.$set=e=>{"input"in e&&a(0,l=e.input),"kernelLength"in e&&a(1,n=e.kernelLength),"dataRange"in e&&a(2,s=e.dataRange),"isExited"in e&&a(3,i=e.isExited)},e.$$.update=()=>{if(1&e.$$.dirty)try{a(5,d=Pe(l))}catch{console.log("Cannot handle stride of "+At)}},[l,n,s,i,o,d,function(){a(4,o=!o),console.log(o)},function(e){a(4,o=e.detail.text)},function(){r("message",{text:!0})}]}class Et extends Q{constructor(e){super(),J(this,e,Ct,It,s,{input:0,kernelLength:1,dataRange:2,isExited:3})}}function Rt(t){let a,n,s,d,h,f,v,b,w,k,$,L,I,A,N,M,C,E,R;return{c(){a=c("div"),n=c("div"),s=c("div"),d=c("div"),d.innerHTML='<i class="fas fa-info-circle"></i>',h=g(),f=c("div"),f.innerHTML='<i class="fas control-icon fa-times-circle"></i>',v=g(),b=c("div"),w=p("Softmax Score for "),k=c("i"),$=p('"'),L=p(t[0]),I=p('"'),A=g(),N=u("svg"),M=g(),C=c("div"),C.innerHTML='<img src="/rnnExplainer/assets/img/pointer.svg" alt="pointer icon" class="svelte-1uac4ng"> \n      <div class="annotation-text"><span style="font-weight:600">Hover over</span> the numbers to highlight logit circles.</div>',m(d,"class","control-button svelte-1uac4ng"),m(d,"title","Jump to article section"),m(f,"class","delete-button control-button svelte-1uac4ng"),m(f,"title","Close"),m(s,"class","buttons svelte-1uac4ng"),m(b,"class","title-text svelte-1uac4ng"),m(N,"id","softmax-svg"),m(N,"width","470"),m(N,"height","105"),m(N,"class","svelte-1uac4ng"),m(C,"class","annotation svelte-1uac4ng"),m(n,"class","box svelte-1uac4ng"),m(a,"class","container")},m(e,l){r(e,a,l),i(a,n),i(n,s),i(s,d),i(s,h),i(s,f),i(n,v),i(n,b),i(b,w),i(b,k),i(k,$),i(k,L),i(k,I),i(n,A),i(n,N),i(n,M),i(n,C),t[9](a),E||(R=[y(d,"click",St),y(f,"click",t[2])],E=!0)},p(e,[t]){1&t&&x(L,e[0])},i:e,o:e,d(e){e&&o(a),t[9](null),E=!1,l(R)}}}function St(){let e=Number(d3.select("#cnn-svg").style("height").replace("px",""))+150,t=new SmoothScroll('a[href*="#"]',{offset:-e}),a=document.querySelector("#article-softmax");t.animateScroll(a)}function Tt(e,t,a){let l,{logits:n}=t,{logitColors:s}=t,{selectedI:i}=t,{highlightI:r=-1}=t,{outputName:o}=t,{outputValue:d}=t,{startAnimation:c}=t,u=null;const p=C(),g=(e,t)=>void 0===t?d3.format(".2f")(e):d3.format(`.${t}f`)(e),h=(e,t,l,n)=>{a(3,r=n),p("mouseOver",{curI:n})},y=(e,t,l,n)=>{a(3,r=-1),p("mouseLeave",{curI:n})};return N(()=>{a(10,u=d3.select(l).select("#softmax-svg"));let e=u.append("g").attr("class","formula-right").attr("transform","translate(10, 0)").style("font-size","15px"),t=e.append("g").attr("class","denominator").attr("transform","translate(0, 58)");t.append("text").attr("x",0).attr("y",0).style("fill","gray").text("(");let r=8;n.forEach((e,a)=>{a/4>=1&&a%4==0&&(r=8);let l=t.append("text").attr("x",r).attr("y",20*Math.floor(a/4)).style("cursor","crosshair").style("pointer-events","all").on("mouseover",(e,t,l)=>h(0,0,0,a)).on("mouseleave",(e,t,l)=>y(0,0,0,a)).text("exp(");l.append("tspan").attr("class",`formula-term-${a} formula-term`).attr("dx","1").style("fill",s[a]).style("fill-opacity",a===i||c.hasInitialized?1:0).text(g(e)),l.append("tspan").attr("dx","1").text(")");let o=l.node().getBBox();r+=o.width+4,a!==n.length-1?(t.append("text").attr("x",r).attr("y",20*Math.floor(a/4)).text("+"),r+=14):t.append("text").attr("x",r-2).attr("y",20*Math.floor(a/4)).style("fill","gray").text(")")}),t.selectAll("text").data(n).enter().append("text").attr("x",(e,t)=>40*t).attr("y",0).text(e=>g(e));let o=t.node().getBBox();e.append("line").attr("class","separation-line").attr("x1",-5).attr("x2",o.width+5).attr("y1",32).attr("y2",32).style("stroke-width",1.2).style("stroke","gray");let p=e.append("g").attr("class","numerator-group").attr("transform","translate(0, 20)").append("text").attr("x",o.x+o.width/2).attr("y",0).on("mouseover",(e,t,a)=>h(0,0,0,i)).on("mouseleave",(e,t,a)=>y(0,0,0,i)).style("pointer-events","all").style("cursor","crosshair").style("text-anchor","middle").text("exp(");p.append("tspan").attr("class",`formula-term-${i} formula-term`).attr("dx",1).style("fill",s[i]).text(""+g(n[i])),p.append("tspan").attr("dx",1).text(")");let m=u.append("g").attr("class","formula-left").attr("transform","translate(395, 32)");m.append("text").attr("x",20).attr("dominant-baseline","middle").text(""+g(d,4)).node().getBBox();m.append("text").attr("dominant-baseline","middle").attr("x",0).attr("y",0).style("fill","gray").style("font-weight","bold").text("=")}),e.$set=e=>{"logits"in e&&a(4,n=e.logits),"logitColors"in e&&a(5,s=e.logitColors),"selectedI"in e&&a(6,i=e.selectedI),"highlightI"in e&&a(3,r=e.highlightI),"outputName"in e&&a(0,o=e.outputName),"outputValue"in e&&a(7,d=e.outputValue),"startAnimation"in e&&a(8,c=e.startAnimation)},e.$$.update=()=>{1032&e.$$.dirty&&null!==u&&(u.selectAll(".formula-term").style("text-decoration","none").style("font-weight","normal"),u.selectAll(".formula-term-"+r).style("font-weight","bold").style("text-decoration","underline")),1280&e.$$.dirty&&null!==u&&u.select(".formula-term-"+c.i).transition("softmax-edge").duration(c.duration).style("fill-opacity",1)},[o,l,()=>{p("xClicked",{})},r,n,s,i,d,c,function(e){R[e?"unshift":"push"](()=>{l=e,a(1,l)})}]}class _t extends Q{constructor(e){super(),J(this,e,Tt,Rt,s,{logits:4,logitColors:5,selectedI:6,highlightI:3,outputName:0,outputValue:7,startAnimation:8})}}function Ht(t){let a,n,s,d,u,h,f,w,k,L,I,A,N,M,C,E,R,S,T,_,H,z,F,O,G,P,B,V,q,X,j,D,W,Y,K,U,J,Q=t[5].error+"";return{c(){a=c("div"),n=c("div"),s=c("div"),d=g(),u=c("div"),h=c("header"),f=c("p"),f.textContent="Add Input Image",w=g(),k=c("button"),L=g(),I=c("section"),A=c("div"),N=c("div"),M=c("input"),C=g(),E=c("span"),E.innerHTML='<i class="fas fa-link"></i>',R=g(),S=c("div"),S.textContent="or",T=g(),_=c("div"),H=c("label"),z=c("input"),F=g(),O=c("span"),O.innerHTML='<span class="file-icon"><i class="fas fa-upload"></i></span> \n                <span class="file-label">Upload</span>',G=g(),P=c("footer"),B=c("div"),V=p(Q),q=g(),X=c("div"),j=c("button"),j.textContent="Cancel",D=g(),W=c("button"),W.textContent="Add",Y=g(),K=c("img"),m(s,"class","modal-background"),m(f,"class","modal-card-title svelte-1o5lxfe"),m(k,"class","delete"),m(k,"aria-label","close"),m(h,"class","modal-card-head svelte-1o5lxfe"),m(M,"class","input small-font svelte-1o5lxfe"),m(M,"type","url"),m(M,"placeholder","Paste URL of image..."),m(E,"class","icon small-font is-left svelte-1o5lxfe"),m(N,"class","control has-icons-left svelte-1o5lxfe"),$(N,"is-loading",t[3]),m(S,"class","or-label svelte-1o5lxfe"),m(z,"class","file-input"),m(z,"type","file"),m(z,"name","image"),m(z,"accept",".png,.jpeg,.tiff,.jpg,.png"),m(O,"class","file-cta small-font svelte-1o5lxfe"),m(H,"class","file-label"),m(_,"class","file"),m(A,"class","field svelte-1o5lxfe"),m(I,"class","modal-card-body"),m(B,"class","error-message svelte-1o5lxfe"),$(B,"hidden",!t[5].show),m(j,"class","button is-smaller svelte-1o5lxfe"),m(W,"class","button is-success is-smaller svelte-1o5lxfe"),m(X,"class","button-container"),m(P,"class","modal-card-foot svelte-1o5lxfe"),m(u,"class","modal-card svelte-1o5lxfe"),m(n,"class","modal"),m(n,"id","input-modal"),$(n,"is-active",t[6].show),b(K,"display","none"),m(K,"id","vali-image"),m(K,"alt","hidden image"),m(a,"class","modal-component")},m(e,l){r(e,a,l),i(a,n),i(n,s),i(n,d),i(n,u),i(u,h),i(h,f),i(h,w),i(h,k),i(u,L),i(u,I),i(I,A),i(A,N),i(N,M),v(M,t[2]),i(N,C),i(N,E),i(A,R),i(A,S),i(A,T),i(A,_),i(_,H),i(H,z),i(H,F),i(H,O),i(u,G),i(u,P),i(P,B),i(B,V),i(P,q),i(P,X),i(X,j),i(X,D),i(X,W),i(a,Y),i(a,K),t[14](K),t[15](a),U||(J=[y(s,"click",t[10]),y(k,"click",t[10]),y(M,"input",t[12]),y(z,"change",t[9]),y(z,"change",t[13]),y(j,"click",t[10]),y(W,"click",t[11]),y(K,"error",t[7]),y(K,"load",t[8])],U=!0)},p(e,[t]){4&t&&v(M,e[2]),8&t&&$(N,"is-loading",e[3]),32&t&&Q!==(Q=e[5].error+"")&&x(V,Q),32&t&&$(B,"hidden",!e[5].show),64&t&&$(n,"is-active",e[6].show)},i:e,o:e,d(e){e&&o(a),t[14](null),t[15](null),U=!1,l(J)}}}function zt(e,t,a){let l,n,s,i="",r=!1,o=!0,d={show:!1,error:""};const c=C();let u={show:!1};me.set(u),me.subscribe(e=>{a(6,u=e)});return N(()=>{d3.select(l).select("#input-modal")}),[l,n,i,r,s,d,u,()=>{a(3,r=!1),a(5,d.show=!0,d),a(5,d.error=o?"We can't find the image at that URL.":"Not a valid image file.",d)},()=>{let e=document.createElement("canvas"),t=e.getContext("2d");e.width=n.width,e.height=n.height,t.drawImage(n,0,0);try{t.getImageData(0,0,n.width,n.height),a(3,r=!1),a(6,u.show=!1,u),me.set(u),c("urlTyped",{url:n.src}),a(2,i=null)}catch(e){a(3,r=!1),a(5,d.show=!0,d),a(5,d.error="No permission to load this image.",d)}},()=>{o=!1;let e=new FileReader;e.onload=e=>{a(1,n.src=e.target.result,n)},e.readAsDataURL(s[0])},()=>{a(6,u.show=!1,u),me.set(u),c("xClicked",{preImage:u.preImage})},()=>{a(3,r=!0),a(5,d.show=!1,d),a(1,n.crossOrigin="Anonymous",n),a(1,n.src=i,n)},function(){i=this.value,a(2,i)},function(){s=this.files,a(4,s)},function(e){R[e?"unshift":"push"](()=>{n=e,a(1,n)})},function(e){R[e?"unshift":"push"](()=>{l=e,a(0,l)})}]}class Ft extends Q{constructor(e){super(),J(this,e,zt,Ht,s,{})}}function Ot(t){let a;return{c(){a=c("div"),a.innerHTML='<svg id="grid" width="100%" height="100%"></svg>',b(a,"display","inline-block"),b(a,"vertical-align","middle"),m(a,"class","grid")},m(e,l){r(e,a,l),t[8](a)},p:e,i:e,o:e,d(e){e&&o(a),t[8](null)}}}function Gt(e,t,a){let l,{data:n}=t,{highlights:s}=t,{outputLength:i}=t,{stride:r}=t,{padding:o}=t,{isOutput:d=!1}=t,{isStrideValid:c}=t;const u=C();let p=s,g=n;const h=()=>{d3.select(l).selectAll("#grid > *").remove();d3.select(l).select("#grid").attr("width",200).attr("height",200).append("svg").attr("width",200).attr("height",200).selectAll(".row").data(n).enter().append("g").attr("class","row").selectAll(".square").data((function(e){return e})).enter().append("rect").attr("class","square").attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y})).attr("width",(function(e){return e.width})).attr("height",(function(e){return e.height})).style("opacity",.5).style("stroke","black").style("fill",(function(e){return!d&&(e.row<o||e.row>n.length-o-1||e.col<o||e.col>n.length-o-1)?"#aaa":"#ddd"})).on("mouseover",(function(e){c&&(n.length!=i?u("message",{hoverH:Math.min(Math.floor(e.row/r),i-1),hoverW:Math.min(Math.floor(e.col/r),i-1)}):u("message",{hoverH:Math.min(Math.floor(e.row/1),i-1),hoverW:Math.min(Math.floor(e.col/1),i-1)}))}))};return M(()=>{(n!=g&&(h(),g=n),s!=p)&&(d3.select(l).select("#grid").select("svg").selectAll(".square").style("fill",(function(e){return s.length&&s[e.row*n.length+e.col]?"#FF2738":!d&&(e.row<o||e.row>n.length-o-1||e.col<o||e.col>n.length-o-1)?"#aaa":"#ddd"})),p=s)}),N(()=>{h()}),e.$set=e=>{"data"in e&&a(1,n=e.data),"highlights"in e&&a(2,s=e.highlights),"outputLength"in e&&a(3,i=e.outputLength),"stride"in e&&a(4,r=e.stride),"padding"in e&&a(5,o=e.padding),"isOutput"in e&&a(6,d=e.isOutput),"isStrideValid"in e&&a(7,c=e.isStrideValid)},[l,n,s,i,r,o,d,c,function(e){R[e?"unshift":"push"](()=>{l=e,a(0,l)})}]}class Pt extends Q{constructor(e){super(),J(this,e,Gt,Ot,s,{data:1,highlights:2,outputLength:3,stride:4,padding:5,isOutput:6,isStrideValid:7})}}function Bt(e){let t,a,l,n,s,d,u,h,y,f,v,w,k,$,L,I,A,N,M,C,E,R,S,T,_,H,z,F,O,G,P,B=e[1].length-2*e[3]+"",V=e[1].length-2*e[3]+"",q=e[1].length+"",X=e[1].length+"",U=e[2].length+"",J=e[2].length+"";return N=new Pt({props:{data:e[7],highlights:e[5],outputLength:e[2].length,stride:e[0],padding:e[3],isStrideValid:e[4]}}),N.$on("message",e[9]),G=new Pt({props:{data:e[8],highlights:e[6],outputLength:e[2].length,stride:e[0],padding:e[3],isOutput:!0,isStrideValid:e[4]}}),G.$on("message",e[9]),{c(){t=c("div"),a=c("div"),l=c("div"),n=p("Input ("),s=p(B),d=p(", "),u=p(V),h=p(") "),y=c("br"),f=g(),v=c("div"),w=p("After-padding ("),k=p(q),$=p(", "),L=p(X),I=p(")"),A=g(),W(N.$$.fragment),M=g(),C=c("div"),E=c("div"),R=p("Output ("),S=p(U),T=p(", "),_=p(J),H=p(")"),z=g(),F=c("div"),F.textContent=" ",O=g(),W(G.$$.fragment),m(l,"class","header-text svelte-w25jpk"),m(v,"class","header-sub-text svelte-w25jpk"),m(a,"class","column has-text-centered svelte-w25jpk"),m(E,"class","header-text svelte-w25jpk"),b(E,"padding-top","27px"),m(F,"class","header-sub-text svelte-w25jpk"),m(C,"class","column has-text-centered svelte-w25jpk"),m(t,"class","wrapper svelte-w25jpk")},m(e,o){r(e,t,o),i(t,a),i(a,l),i(l,n),i(l,s),i(l,d),i(l,u),i(l,h),i(l,y),i(a,f),i(a,v),i(v,w),i(v,k),i(v,$),i(v,L),i(v,I),i(a,A),Y(N,a,null),i(t,M),i(t,C),i(C,E),i(E,R),i(E,S),i(E,T),i(E,_),i(E,H),i(C,z),i(C,F),i(C,O),Y(G,C,null),P=!0},p(e,[t]){(!P||10&t)&&B!==(B=e[1].length-2*e[3]+"")&&x(s,B),(!P||10&t)&&V!==(V=e[1].length-2*e[3]+"")&&x(u,V),(!P||2&t)&&q!==(q=e[1].length+"")&&x(k,q),(!P||2&t)&&X!==(X=e[1].length+"")&&x(L,X);const a={};128&t&&(a.data=e[7]),32&t&&(a.highlights=e[5]),4&t&&(a.outputLength=e[2].length),1&t&&(a.stride=e[0]),8&t&&(a.padding=e[3]),16&t&&(a.isStrideValid=e[4]),N.$set(a),(!P||4&t)&&U!==(U=e[2].length+"")&&x(S,U),(!P||4&t)&&J!==(J=e[2].length+"")&&x(_,J);const l={};256&t&&(l.data=e[8]),64&t&&(l.highlights=e[6]),4&t&&(l.outputLength=e[2].length),1&t&&(l.stride=e[0]),8&t&&(l.padding=e[3]),16&t&&(l.isStrideValid=e[4]),G.$set(l)},i(e){P||(j(N.$$.fragment,e),j(G.$$.fragment,e),P=!0)},o(e){D(N.$$.fragment,e),D(G.$$.fragment,e),P=!1},d(e){e&&o(t),K(N),K(G)}}}function Vt(e,t,a){let{stride:l}=t,{dilation:n}=t,{kernel:s}=t,{image:i}=t,{output:r}=t,{isPaused:o}=t,{padding:d}=t,{isStrideValid:c}=t;const u=C();let p,g,h=[],y=Be(r.length*r.length,e=>!0);function m(e){g=0,a(10,o=!1),u("message",{text:o});let t=qe(e,r,s.length,i.length,n);e<=0||(p&&clearInterval(p),a(13,p=setInterval(()=>{if(o||!c)return;const e=g%(r.length*r.length);a(6,y=Be(r.length*r.length,e=>!1));const l=Math.floor(e/r.length),n=e%r.length;a(6,y[l*r.length+n]=!0,y),a(5,h=Xe(l,n,i.length,s.length,t,s.length)),g++},1e3)))}m(l);let f=Ue(i,198/i.length),x=Ue(r,198/r.length),v=Ue(s,198/s.length);return e.$set=e=>{"stride"in e&&a(0,l=e.stride),"dilation"in e&&a(11,n=e.dilation),"kernel"in e&&a(12,s=e.kernel),"image"in e&&a(1,i=e.image),"output"in e&&a(2,r=e.output),"isPaused"in e&&a(10,o=e.isPaused),"padding"in e&&a(3,d=e.padding),"isStrideValid"in e&&a(4,c=e.isStrideValid)},e.$$.update=()=>{if(4&e.$$.dirty){Be(r.length*r.length,e=>!0)}4103&e.$$.dirty&&(m(l),a(7,f=Ue(i,198/i.length)),a(8,x=Ue(r,198/r.length)),v=Ue(s,198/s.length))},[l,i,r,d,c,h,y,f,x,function(e){let t=qe(l,r,s.length,i.length,n);a(6,y=Be(r.length*r.length,e=>!1));const d=e.detail.hoverH,c=e.detail.hoverW;a(6,y[d*r.length+c]=!0,y),a(5,h=Xe(d,c,i.length,s.length,t,s.length)),a(10,o=!0),u("message",{text:o})},o,n,s]}class qt extends Q{constructor(e){super(),J(this,e,Vt,Bt,s,{stride:0,dilation:11,kernel:12,image:1,output:2,isPaused:10,padding:3,isStrideValid:4})}}function Xt(e){let t,a,n,s,d,u,p,h,x,b,w,k,$,L,I,A,N,M,C,E,R,S,T,_,H,z,F,O,G,P,B,V,q,X,U,J,Q,Z,ee,te,ae,le,ne,se,ie,re,oe,de,ce,ue,pe,ge,he,ye,me,fe=e[4]?'<i class="fas fa-play-circle play-icon"></i>':'<i class="fas fa-pause-circle"></i>';return ue=new qt({props:{kernel:e[7],image:e[6],output:e[8],isStrideValid:e[5],stride:e[3],dilation:jt,padding:e[2],isPaused:e[4]}}),ue.$on("message",e[11]),{c(){t=c("div"),a=c("div"),n=c("div"),s=g(),d=c("div"),u=c("div"),p=c("div"),h=c("div"),x=c("div"),x.innerHTML='<label class="label svelte-159efdy">Input Size:</label>',b=g(),w=c("input"),$=g(),L=c("input"),A=g(),N=c("div"),M=c("div"),C=c("div"),C.innerHTML='<label class="label svelte-159efdy">Padding:</label>',E=g(),R=c("input"),_=g(),H=c("input"),O=g(),G=c("div"),P=c("div"),B=c("div"),B.innerHTML='<label class="label svelte-159efdy">Kernel Size:</label>',V=g(),q=c("input"),U=g(),J=c("input"),Z=g(),ee=c("div"),te=c("div"),ae=c("div"),ae.innerHTML='<label class="label svelte-159efdy">Stride:</label>',le=g(),ne=c("input"),ie=g(),re=c("input"),de=g(),ce=c("div"),W(ue.$$.fragment),pe=g(),ge=c("div"),ge.innerHTML='<img src="/rnnExplainer/assets/img/pointer.svg" alt="pointer icon" width="25px" class="svelte-159efdy"> \n            <div class="annotation-text-hyper svelte-159efdy"><span style="font-weight:600">Hover over</span> the matrices to change kernel position.</div>',m(n,"class","control-button svelte-159efdy"),m(x,"class","field-label is-normal svelte-159efdy"),m(w,"class","input is-very-small svelte-159efdy"),m(w,"type","number"),m(w,"min",e[1]),m(w,"max",k=7),m(h,"class","field is-horizontal svelte-159efdy"),m(L,"type","range"),m(L,"min",e[1]),m(L,"max",I=7),m(L,"class","svelte-159efdy"),m(p,"class","input-row"),m(C,"class","field-label is-normal svelte-159efdy"),m(R,"class","input is-very-small svelte-159efdy"),m(R,"type","number"),m(R,"min",S=0),m(R,"max",T=e[1]-1),m(M,"class","field is-horizontal svelte-159efdy"),m(H,"type","range"),m(H,"min",z=0),m(H,"max",F=e[1]-1),m(H,"class","svelte-159efdy"),m(N,"class","input-row"),m(B,"class","field-label is-normal svelte-159efdy"),m(q,"class","input is-very-small svelte-159efdy"),m(q,"type","number"),m(q,"min",X=e[2]+1),m(q,"max",e[9]),m(P,"class","field is-horizontal svelte-159efdy"),m(J,"type","range"),m(J,"min",Q=e[2]+1),m(J,"max",e[9]),m(J,"class","svelte-159efdy"),m(G,"class","input-row"),m(ae,"class","field-label is-normal svelte-159efdy"),m(ne,"class","input is-very-small svelte-159efdy"),m(ne,"type","number"),m(ne,"id","strideNumber"),m(ne,"min","1"),m(ne,"max",se=Math.max(e[9]-e[1]+1,2)),m(te,"class","field is-horizontal svelte-159efdy"),m(re,"type","range"),m(re,"min","1"),m(re,"max",oe=Math.max(e[9]-e[1]+1,2)),m(re,"class","svelte-159efdy"),m(ee,"class","input-row"),m(u,"class","left-part svelte-159efdy"),m(ge,"class","annotation svelte-159efdy"),m(ce,"class","right-part svelte-159efdy"),m(d,"class","content-container svelte-159efdy"),m(a,"class","box svelte-159efdy"),m(t,"class","container has-text-centered"),m(t,"id","detailview-container")},m(l,o){r(l,t,o),i(t,a),i(a,n),n.innerHTML=fe,i(a,s),i(a,d),i(d,u),i(u,p),i(p,h),i(h,x),i(h,b),i(h,w),v(w,e[0]),i(p,$),i(p,L),v(L,e[0]),i(u,A),i(u,N),i(N,M),i(M,C),i(M,E),i(M,R),v(R,e[2]),i(N,_),i(N,H),v(H,e[2]),i(u,O),i(u,G),i(G,P),i(P,B),i(P,V),i(P,q),v(q,e[1]),i(G,U),i(G,J),v(J,e[1]),i(u,Z),i(u,ee),i(ee,te),i(te,ae),i(te,le),i(te,ne),v(ne,e[3]),i(ee,ie),i(ee,re),v(re,e[3]),i(d,de),i(d,ce),Y(ue,ce,null),i(ce,pe),i(ce,ge),he=!0,ye||(me=[y(n,"click",e[10]),y(w,"input",e[12]),y(L,"change",e[13]),y(L,"input",e[13]),y(R,"input",e[14]),y(H,"change",e[15]),y(H,"input",e[15]),y(q,"input",e[16]),y(J,"change",e[17]),y(J,"input",e[17]),y(ne,"input",e[18]),y(re,"change",e[19]),y(re,"input",e[19])],ye=!0)},p(e,[t]){(!he||16&t)&&fe!==(fe=e[4]?'<i class="fas fa-play-circle play-icon"></i>':'<i class="fas fa-pause-circle"></i>')&&(n.innerHTML=fe),(!he||2&t)&&m(w,"min",e[1]),1&t&&f(w.value)!==e[0]&&v(w,e[0]),(!he||2&t)&&m(L,"min",e[1]),1&t&&v(L,e[0]),(!he||2&t&&T!==(T=e[1]-1))&&m(R,"max",T),4&t&&f(R.value)!==e[2]&&v(R,e[2]),(!he||2&t&&F!==(F=e[1]-1))&&m(H,"max",F),4&t&&v(H,e[2]),(!he||4&t&&X!==(X=e[2]+1))&&m(q,"min",X),(!he||512&t)&&m(q,"max",e[9]),2&t&&f(q.value)!==e[1]&&v(q,e[1]),(!he||4&t&&Q!==(Q=e[2]+1))&&m(J,"min",Q),(!he||512&t)&&m(J,"max",e[9]),2&t&&v(J,e[1]),(!he||514&t&&se!==(se=Math.max(e[9]-e[1]+1,2)))&&m(ne,"max",se),8&t&&f(ne.value)!==e[3]&&v(ne,e[3]),(!he||514&t&&oe!==(oe=Math.max(e[9]-e[1]+1,2)))&&m(re,"max",oe),8&t&&v(re,e[3]);const a={};128&t&&(a.kernel=e[7]),64&t&&(a.image=e[6]),256&t&&(a.output=e[8]),32&t&&(a.isStrideValid=e[5]),8&t&&(a.stride=e[3]),4&t&&(a.padding=e[2]),16&t&&(a.isPaused=e[4]),ue.$set(a)},i(e){he||(j(ue.$$.fragment,e),he=!0)},o(e){D(ue.$$.fragment,e),he=!1},d(e){e&&o(t),K(ue),ye=!1,l(me)}}}const jt=1;function Dt(e){let t=[];for(let a=0;a<e;a++){t.push([]);for(let l=0;l<e;l++)t[a].push(0)}return t}function Wt(e,t,a){let l=5,n=2,s=0,i=1,r=!1,o=!0;let d,c=Dt(l+2*s),u=Dt(n),p=Ge(c,u,i);return e.$$.update=()=>{if(5&e.$$.dirty&&a(9,d=l+2*s),5&e.$$.dirty&&a(6,c=Dt(l+2*s)),2&e.$$.dirty&&a(7,u=Dt(n)),714&e.$$.dirty&&i>0){const e=(d-n)/i+1;let t=document.getElementById("strideNumber");Number.isInteger(e)?(a(8,p=Ge(c,u,i)),null!=t&&(t.className=t.className.replace("is-danger","")),a(5,o=!0)):(t.className.includes("is-danger")||(t.className+=" is-danger"),a(5,o=!1),console.log("Cannot handle stride of "+i))}},[l,n,s,i,r,o,c,u,p,d,function(){a(4,r=!r)},function(e){a(4,r=e.detail.text)},function(){l=f(this.value),a(0,l)},function(){l=f(this.value),a(0,l)},function(){s=f(this.value),a(2,s)},function(){s=f(this.value),a(2,s)},function(){n=f(this.value),a(1,n)},function(){n=f(this.value),a(1,n)},function(){i=f(this.value),a(3,i)},function(){i=f(this.value),a(3,i)}]}class Yt extends Q{constructor(e){super(),J(this,e,Wt,Xt,s,{})}}function Kt(t){let a;return{c(){a=c("div"),m(a,"id",t[0])},m(e,t){r(e,a,t)},p(e,[t]){1&t&&m(a,"id",e[0])},i:e,o:e,d(e){e&&o(a)}}}var Ut=document.createElement("script");Ut.src="https://www.youtube.com/iframe_api";var Jt=document.getElementsByTagName("script")[0];function Qt(e,t,a){let l,{videoId:n}=t,{playerId:s="player"}=t;C();function i(e){l.mute()}return window.addEventListener("iframeApiReady",(function(e){l=new YT.Player(s,{videoId:n,events:{onReady:i}})})),e.$set=e=>{"videoId"in e&&a(1,n=e.videoId),"playerId"in e&&a(0,s=e.playerId)},[s,n,function(e=0){l.seekTo(e),l.playVideo()}]}Jt.parentNode.insertBefore(Ut,Jt),window.onYouTubeIframeAPIReady=()=>window.dispatchEvent(new Event("iframeApiReady"));class Zt extends Q{constructor(e){super(),J(this,e,Qt,Kt,s,{videoId:1,playerId:0,play:2})}get play(){return this.$$.ctx[2]}}function ea(e){let t,a,s,d,u,h,f,x,v,w,k,$,L,I,A,N,M,C,E,R,S,T,_,H,z,F,O,G,P,B,V,q,X,U,J,Q,Z,ee,te,ae,le,ne,se,ie,re,oe,de,ce,ue,pe,ge,he,ye,me,fe,xe,ve,be,we,ke,$e,Le,Ie,Ae,Ne,Me,Ce,Ee,Re,Se,Te,_e,He,ze,Fe,Oe,Ge,Pe,Be,Ve,qe,Xe,je,De,We,Ye,Ke,Ue,Je,Qe,Ze,et,tt,at,lt,nt,st,it,rt,ot,dt,ct,ut,pt,gt,ht,yt,mt,ft,xt,vt,bt,wt,kt,$t,Lt,It,At,Nt,Mt,Ct;ie=new Yt({});return xt=new Zt({props:{videoId:"HnWIHWFbuUQ",playerId:"demo_video"}}),e[3](xt),{c(){t=c("body"),a=c("div"),s=c("h2"),s.textContent="What is a Convolutional Neural Network?",d=g(),u=c("p"),u.innerHTML="In machine learning, a classifier assigns a class label to a data point.  For example, an <em>image classifier</em> produces a class label (e.g, bird, plane) for what objects exist within an image.  A <em>convolutional neural network</em>, or CNN for short, is a type of classifier, which excels at solving this problem!",h=g(),f=c("p"),f.textContent="A CNN is a neural network: an algorithm used to recognize patterns in data. Neural Networks in general are composed of a collection of neurons that are organized in layers, each with their own learnable weights and biases.  Let’s break down a CNN into its basic building blocks.",x=g(),v=c("ol"),v.innerHTML='<li class="svelte-ixpg0w">A <strong>tensor</strong> can be thought of as an n-dimensional matrix.  In the CNN above, tensors will be 3-dimensional with the exception of the output layer.</li> \n  \t\t<li class="svelte-ixpg0w">A <strong>neuron</strong> can be thought of as a function that takes in multiple inputs and yields a single output.  The outputs of neurons are represented above as the <span style="color:#FF7577;">red</span> → <span style="color:#60A7D7;">blue</span>  <strong>activation maps</strong>.</li> \n  \t\t<li class="svelte-ixpg0w">A <strong>layer</strong> is simply a collection of neurons with the same operation, including the same hyperparameters.</li> \n  \t\t<li class="svelte-ixpg0w"><strong>Kernel weights and biases</strong>, while unique to each neuron, are tuned during the training phase, and allow the classifier to adapt to the problem and dataset provided.  They are encoded in the visualization with a <span style="color:#BC8435;">yellow</span> → <span style="color:#39988F;">green</span> diverging colorscale.  The specific values can be viewed in the <em>Interactive Formula View</em> by clicking a neuron or by hovering over the kernel/bias in the <em>Convolutional Elastic Explanation View</em>.</li> \n  \t\t<li class="svelte-ixpg0w">A CNN conveys a <strong>differentiable score function</strong>, which is represented as <strong>class scores</strong> in the visualization on the output layer.</li>',w=g(),k=c("p"),k.innerHTML='If you have studied neural networks before, these terms may sound familiar to you.  So what makes a CNN different? CNNs utilize a special type of layer, aptly named a convolutional layer, that makes them well-positioned to learn from image and image-like data.  Regarding image data, CNNs can be used for many different computer vision tasks, such as <a href="http://ijcsit.com/docs/Volume%207/vol7issue5/ijcsit20160705014.pdf" title="CNN Applications" class="svelte-ixpg0w">image processing, classification, segmentation, and object detection</a>.',$=g(),L=c("p"),L.innerHTML='In CNN Explainer, you can see how a simple CNN can be used for image classification.  Because of the network’s simplicity, its performance isn’t perfect, but that’s okay! The network architecture, <a href="http://cs231n.stanford.edu/" title="Tiny VGG Net presented by Stanford&#39;s CS231n" class="svelte-ixpg0w">Tiny VGG</a>, used in CNN Explainer contains many of the same layers and operations used in state-of-the-art CNNs today, but on a smaller scale.  This way, it will be easier to understand getting started.',I=g(),A=c("h2"),A.textContent="What does each layer of the network do?",N=g(),M=c("p"),M.textContent="Let’s walk through each layer in the network.  Feel free to interact with the visualization above by clicking and hovering over various parts of it as you read.",C=g(),E=c("h4"),E.textContent="Input Layer",R=g(),S=c("p"),S.innerHTML='The input layer (leftmost layer) represents the input image into the CNN.  Because we use RGB images as input, the input layer has three channels, corresponding to the red, green, and blue channels, respectively, which are shown in this layer. Use the color scale when you click on the <img class="is-rounded svelte-ixpg0w" width="12%" height="12%" src="/rnnExplainer/assets/figures/network_details.png" alt="network details icon"> icon above to display detailed information (on this layer, and others).',T=g(),_=c("h4"),_.textContent="Convolutional Layers",H=g(),z=c("p"),z.textContent="The convolutional layers are the foundation of CNN, as they contain the learned kernels (weights), which extract features that distinguish different images from one another—this is what we want for classification!  As you interact with the convolutional layer, you will notice links between the previous layers and the convolutional layers.  Each link represents a unique kernel, which is used for the convolution operation to produce the current convolutional neuron’s output or activation map.",F=g(),O=c("p"),O.textContent="The convolutional neuron performs an elementwise dot product with a unique kernel and the output of the previous layer’s corresponding neuron.  This will yield as many intermediate results as there are unique kernels.  The convolutional neuron is the result of all of the intermediate results summed together with the learned bias.",G=g(),P=c("p"),P.textContent="For example, let’s look at the first convolutional layer in the Tiny VGG architecture above.  Notice that there are 10 neurons in this layer, but only 3 neurons in the previous layer.  In the Tiny VGG architecture, convolutional layers are fully-connected, meaning each neuron is connected to every other neuron in the previous layer.  Focusing on the output of the topmost convolutional neuron from the first convolutional layer, we see that there are 3 unique kernels when we hover over the activation map.",B=g(),V=c("div"),V.innerHTML='<img src="/rnnExplainer/assets/figures/convlayer_overview_demo.gif" alt="clicking on topmost first conv. layer activation map" width="60%" height="60%" align="middle" class="svelte-ixpg0w"> \n      <div class="figure-caption svelte-ixpg0w">Figure 1.  As you hover over the activation map of the topmost node from the first convolutional layer, you can see that 3 kernels were applied to yield this activation map.  After clicking this activation map, you can see the convolution operation occuring with each unique kernel.</div>',q=g(),X=c("p"),X.textContent="The size of these kernels is a hyper-parameter specified by the designers of the network architecture.  In order to produce the output of the convolutional neuron (activation map), we must perform an elementwise dot product with the output of the previous layer and the unique kernel learned by the network.  In TinyVGG, the dot product operation uses a stride of 1, which means that the kernel is shifted over 1 pixel per dot product, but this is a hyperparameter that the network architecture designer can adjust to better fit their dataset.  We must do this for all 3 kernels, which will yield 3 intermediate results.",U=g(),J=c("div"),J.innerHTML='<img src="/rnnExplainer/assets/figures/convlayer_detailedview_demo.gif" alt="clicking on topmost first conv. layer activation map" class="svelte-ixpg0w"> \n      <div class="figure-caption svelte-ixpg0w">Figure 2. The kernel being applied to yield the topmost intermediate result for the discussed activation map.</div>',Q=g(),Z=c("p"),Z.textContent="Then, an elementwise sum is performed containing all 3 intermediate results along with the bias the network has learned.  After this, the resulting 2-dimensional tensor will be the activation map viewable on the interface above for the topmost neuron in the first convolutional layer.  This same operation must be applied to produce each neuron’s activation map.",ee=g(),te=c("p"),te.textContent="With some simple math, we are able to deduce that there are 3 x 10 = 30 unique kernels, each of size 3x3, applied in the first convolutional layer.  The connectivity between the convolutional layer and the previous layer is a design decision when building a network architecture, which will affect the number of kernels per convolutional layer.  Click around the visualization to better understand the operations behind the convolutional layer.  See if you can follow the example above!",ae=g(),le=c("h6"),le.textContent="Understanding Hyperparameters",ne=g(),se=c("p"),W(ie.$$.fragment),re=g(),oe=c("ol"),oe.innerHTML='<li class="svelte-ixpg0w"><strong>Padding</strong> is often necessary when the kernel extends beyond the activation map.  Padding conserves data at the borders of activation maps, which leads to better performance, and it can help <a href="https://arxiv.org/pdf/1603.07285.pdf" title="See page 13" class="svelte-ixpg0w">preserve the input&#39;s spatial size</a>, which allows an architecture designer to build depper, higher performing networks.  There exist <a href="https://arxiv.org/pdf/1811.11718.pdf" title="Outlines major padding techniques" class="svelte-ixpg0w">many padding techniques</a>, but the most commonly used approach is zero-padding because of its performance, simplicity, and computational efficiency.  The technique involves adding zeros symmetrically around the edges of an input.  This approach is adopted by many high-performing CNNs such as <a href="https://papers.nips.cc/paper/4824-imagenet-classification-with-deep-convolutional-neural-networks.pdf" title="AlexNet" class="svelte-ixpg0w">AlexNet</a>.</li> \n    \t<li class="svelte-ixpg0w"><strong>Kernel size</strong>, often also referred to as filter size, refers to the dimensions of the sliding window over the input.  Choosing this hyperparameter has a massive impact on the image classification task.  For example, small kernel sizes are able to extract a much larger amount of information containing highly local features from the input.  As you can see on the visualization above, a smaller kernel size also leads to a smaller reduction in layer dimensions, which allows for a deeper architecture.  Conversely, a large kernel size extracts less information, which leads to a faster reduction in layer dimensions, often leading to worse performance.  Large kernels are better suited to extract features that are larger.  At the end of the day, choosing an appropriate kernel size will be dependent on your task and dataset, but generally, smaller kernel sizes lead to better performance for the image classification task because an architecture designer is able to stack <a href="https://arxiv.org/pdf/1409.1556.pdf" title="Learn why deeper networks perform better!" class="svelte-ixpg0w">more and more layers together to learn more and more complex features</a>!</li> \n    \t<li class="svelte-ixpg0w"><strong>Stride</strong> indicates how many pixels the kernel should be shifted over at a time.  For example, as described in the convolutional layer example above, Tiny VGG uses a stride of 1 for its convolutional layers, which means that the dot product is performed on a 3x3 window of the input to yield an output value, then is shifted to the right by one pixel for every subsequent operation.  The impact stride has on a CNN is similar to kernel size.  As stride is decreased, more features are learned because more data is extracted, which also leads to larger output layers.  On the contrary, as stride is increased, this leads to more limited feature extraction and smaller output layer dimensions.  One responsibility of the architecture designer is to ensure that the kernel slides across the input symmetrically when implementing a CNN.  Use the hyperparameter visualization above to alter stride on various input/kernel dimensions to understand this constraint!</li>',de=g(),ce=c("h4"),ce.textContent="Activation Functions",ue=g(),pe=c("h6"),pe.textContent="ReLU",ge=g(),he=c("p"),he.innerHTML='Neural networks are extremely prevalent in modern technology—because they are so accurate!  The highest performing CNNs today consist of an absurd amount of layers, which are able to learn more and more features.  Part of the reason these groundbreaking CNNs are able to achieve such <a href="https://arxiv.org/pdf/1512.03385.pdf" title="ResNet" class="svelte-ixpg0w">tremendous accuracies</a> is because of their non-linearity.  ReLU applies much-needed non-linearity into the model.  Non-linearity is necessary to produce non-linear decision boundaries, so that the output cannot be written as a linear combination of the inputs.  If a non-linear activation function was not present, deep CNN architectures would devolve into a single, equivalent convolutional layer, which would not perform nearly as well.  The ReLU activation function is specifically used as a non-linear activation function, as opposed to other non-linear functions such as <em>Sigmoid</em> because it has been <a href="https://arxiv.org/pdf/1906.01975.pdf" title="See page 29" class="svelte-ixpg0w">empirically observed</a> that CNNs using ReLU are faster to train than their counterparts.',ye=g(),me=c("p"),me.textContent="The ReLU activation function is a one-to-one mathematical operation: "+e[2],fe=g(),xe=c("div"),xe.innerHTML='<img src="/rnnExplainer/assets/figures/relu_graph.svg" alt="relu graph" width="30%" height="30%" class="svelte-ixpg0w"> \n      <div class="figure-caption svelte-ixpg0w">Figure 3. The ReLU activation function graphed, which disregards all negative data.</div>',ve=g(),be=c("p"),be.textContent="This activation function is applied elementwise on every value from the input tensor.  For example, if applied ReLU on the value 2.24, the result would be 2.24, since 2.24 is larger than 0.  You can observe how this activation function is applied by clicking a ReLU neuron in the network above.  The Rectified Linear Activation function (ReLU) is performed after every convolutional layer in the network architecture outlined above.  Notice the impact this layer has on the activation map of various neurons throughout the network!",we=g(),ke=c("h6"),ke.textContent="Softmax",$e=g(),Le=c("p"),Ie=p(e[1]),Ae=p("\n    \tA softmax operation serves a key purpose: making sure the CNN outputs sum to 1.  Because of this, softmax operations are useful to scale model outputs into probabilities.  Clicking on the last layer reveals the softmax operation in the network. Notice how the logits after flatten aren’t scaled between zero to one.  For a visual indication of the impact of each logit (unscaled scalar value), they are encoded using a "),Ne=c("span"),Ne.textContent="light orange",Me=p(" → "),Ce=c("span"),Ce.textContent="dark orange",Ee=p(" color scale.  After passing through the softmax function, each class now corresponds to an appropriate probability!"),Re=g(),Se=c("p"),Se.textContent="You might be thinking what the difference between standard normalization and softmax is—after all, both rescale the logits between 0 and 1.  Remember that backpropagation is a key aspect of training neural networks—we want the correct answer to have the largest “signal.” By using softmax, we are effectively “approximating” argmax while gaining differentiability.  Rescaling doesn’t weigh the max significantly higher than other logits, whereas softmax does.  Simply put, softmax is a “softer” argmax—see what we did there?",Te=g(),_e=c("div"),_e.innerHTML='<img src="/rnnExplainer/assets/figures/softmax_animation.gif" alt="softmax interactive formula view" class="svelte-ixpg0w"> \n      <div class="figure-caption svelte-ixpg0w">Figure 4. The <em>Softmax Interactive Formula View</em> allows a user to interact with both the color encoded logits and formula to understand how the prediction scores after the flatten layer are normalized to yield classification scores.</div>',He=g(),ze=c("h4"),ze.textContent="Pooling Layers",Fe=g(),Oe=c("p"),Oe.textContent="There are many types of pooling layers in different CNN architectures, but they all have the purpose of gradually decreasing the spatial extent of the network, which reduces the parameters and overall computation of the network.  The type of pooling used in the Tiny VGG architecture above is Max-Pooling.",Ge=g(),Pe=c("p"),Pe.textContent="The Max-Pooling operation requires selecting a kernel size and a stride length during architecture design.  Once selected, the operation slides the kernel with the specified stride over the input while only selecting the largest value at each kernel slice from the input to yield a value for the output.  This process can be viewed by clicking a pooling neuron in the network above.",Be=g(),Ve=c("p"),Ve.textContent="In the Tiny VGG architecture above, the pooling layers use a 2x2 kernel and a stride of 2.  This operation with these specifications results in the discarding of 75% of activations.  By discarding so many values, Tiny VGG is more computationally efficient and avoids overfitting.",qe=g(),Xe=c("h4"),Xe.textContent="Flatten Layer",je=g(),De=c("p"),De.textContent="This layer converts a three-dimensional layer in the network into a one-dimensional vector to fit the  input of a fully-connected layer for classification.  For example, a 5x5x2 tensor would be converted into a vector of size 50.  The previous convolutional layers of the network extracted the features from the input image, but now it is time to classify the features.  We use the softmax function to classify these features, which requires a 1-dimensional input.  This is why the flatten layer is necessary.  This layer can be viewed by clicking any output class.",We=g(),Ye=c("h2"),Ye.textContent="Interactive features",Ke=g(),Ue=c("ol"),Ue.innerHTML='<li class="svelte-ixpg0w"><strong>Upload your own image</strong> by selecting <img class="icon is-rounded svelte-ixpg0w" src="/rnnExplainer/assets/figures/upload_image_icon.png" alt="upload image icon"> to understand how your image is classified into the 10 classes.  By analyzing the neurons throughout the network, you can understand the activations maps and extracted features.</li> \n    \t<li class="svelte-ixpg0w"><strong>Change the activation map colorscale</strong> to better understand the impact of activations at different levels of abstraction by adjusting <img class="is-rounded svelte-ixpg0w" width="12%" height="12%" src="/rnnExplainer/assets/figures/heatmap_scale.png" alt="heatmap">.</li> \n    \t<li class="svelte-ixpg0w"><strong>Understand network details</strong> such as layer dimensions and colorscales by clicking the <img class="is-rounded svelte-ixpg0w" width="12%" height="12%" src="/rnnExplainer/assets/figures/network_details.png" alt="network details icon"> icon.</li> \n    \t<li class="svelte-ixpg0w"><strong>Simulate network operations</strong> by clicking the <img class="icon is-rounded svelte-ixpg0w" src="/rnnExplainer/assets/figures/play_button.png" alt="play icon"> button or interact with the layer slice in the <em>Interactive Formula View</em> by hovering over portions of the input or output to understand the mappings and underlying operations.</li> \n      <li class="svelte-ixpg0w"><strong>Learn layer functions</strong> by clicking <img class="icon is-rounded svelte-ixpg0w" src="/rnnExplainer/assets/figures/info_button.png" alt="info icon"> from the <em>Interactive Formula View</em> to read layer details from the article.</li>',Je=g(),Qe=c("h2"),Qe.textContent="Video Tutorial",Ze=g(),et=c("ul"),tt=c("li"),tt.innerHTML='CNN Explainer Introduction\n        <small class="svelte-ixpg0w">(0:00-0:22)</small>',at=g(),lt=c("li"),lt.innerHTML='<em>Overview</em> \n        <small class="svelte-ixpg0w">(0:27-0:37)</small>',nt=g(),st=c("li"),st.innerHTML='Convolutional <em>Elastic Explanation View</em> \n        <small class="svelte-ixpg0w">(0:37-0:46)</small>',it=g(),rt=c("li"),rt.innerHTML='Convolutional, ReLU, and Pooling <em>Interactive Formula Views</em> \n        <small class="svelte-ixpg0w">(0:46-1:21)</small>',ot=g(),dt=c("li"),dt.innerHTML='Flatten <em>Elastic Explanation View</em> \n        <small class="svelte-ixpg0w">(1:22-1:41)</small>',ct=g(),ut=c("li"),ut.innerHTML='Softmax <em>Interactive Formula View</em> \n        <small class="svelte-ixpg0w">(1:41-2:02)</small>',pt=g(),gt=c("li"),gt.innerHTML='Engaging Learning Experience: Understanding Classification\n        <small class="svelte-ixpg0w">(2:06-2:28)</small>',ht=g(),yt=c("li"),yt.innerHTML='Interactive Tutorial Article\n        <small class="svelte-ixpg0w">(2:29-2:54)</small>',mt=g(),ft=c("div"),W(xt.$$.fragment),vt=g(),bt=c("h2"),bt.textContent="How is CNN Explainer implemented?",wt=g(),kt=c("p"),kt.innerHTML='CNN Explainer uses <a href="https://js.tensorflow.org/" class="svelte-ixpg0w"><em>TensorFlow.js</em></a>, an in-browser GPU-accelerated deep learning library to load the pretrained model for visualization.  The entire interactive system is written in Javascript using <a href="https://svelte.dev/" class="svelte-ixpg0w"><em>Svelte</em></a> as a framework and <a href="https://d3js.org/" class="svelte-ixpg0w"><em>D3.js</em></a> for visualizations. You only need a web browser to get started learning CNNs today!',$t=g(),Lt=c("h2"),Lt.textContent="Who developed CNN Explainer?",It=g(),At=c("p"),At.innerHTML='CNN Explainer was created by \n      <a href="https://zijie.wang/" class="svelte-ixpg0w">Jay Wang</a>,\n      <a href="https://www.linkedin.com/in/robert-turko/" class="svelte-ixpg0w">Robert Turko</a>, \n      <a href="http://oshaikh.com/" class="svelte-ixpg0w">Omar Shaikh</a>,\n      <a href="https://haekyu.com/" class="svelte-ixpg0w">Haekyu Park</a>,\n      <a href="http://nilakshdas.com/" class="svelte-ixpg0w">Nilaksh Das</a>,\n      <a href="https://fredhohman.com/" class="svelte-ixpg0w">Fred Hohman</a>,\n      <a href="http://minsuk.com" class="svelte-ixpg0w">Minsuk Kahng</a>, and\n      <a href="https://www.cc.gatech.edu/~dchau/" class="svelte-ixpg0w">Polo Chau</a>,\n      which was the result of a research collaboration between \n      Georgia Tech and Oregon State.  We thank Anmol Chhabria, Kaan Sancak, Kantwon Rogers, and the Georgia Tech Visualization Lab for their support and constructive feedback.  This work was supported in part by NSF grants IIS-1563816, CNS-1704701, NASA NSTRF, DARPA GARD, gifts from Intel, NVIDIA, Google, Amazon.',m(s,"class","svelte-ixpg0w"),m(u,"class","svelte-ixpg0w"),m(f,"class","svelte-ixpg0w"),m(v,"class","svelte-ixpg0w"),m(k,"class","svelte-ixpg0w"),m(L,"class","svelte-ixpg0w"),m(A,"class","svelte-ixpg0w"),m(M,"class","svelte-ixpg0w"),m(E,"id","article-input"),m(E,"class","svelte-ixpg0w"),m(S,"class","svelte-ixpg0w"),m(_,"id","article-convolution"),m(_,"class","svelte-ixpg0w"),m(z,"class","svelte-ixpg0w"),m(O,"class","svelte-ixpg0w"),m(P,"class","svelte-ixpg0w"),m(V,"class","figure svelte-ixpg0w"),m(X,"class","svelte-ixpg0w"),m(J,"class","figure svelte-ixpg0w"),m(Z,"class","svelte-ixpg0w"),m(te,"class","svelte-ixpg0w"),m(le,"class","svelte-ixpg0w"),m(se,"class","svelte-ixpg0w"),m(oe,"class","svelte-ixpg0w"),m(ce,"class","svelte-ixpg0w"),m(pe,"id","article-relu"),m(pe,"class","svelte-ixpg0w"),m(he,"class","svelte-ixpg0w"),m(me,"class","svelte-ixpg0w"),m(xe,"class","figure svelte-ixpg0w"),m(be,"class","svelte-ixpg0w"),m(ke,"id","article-softmax"),m(ke,"class","svelte-ixpg0w"),b(Ne,"color","#FFC385"),b(Ce,"color","#C44103"),m(Le,"class","svelte-ixpg0w"),m(Se,"class","svelte-ixpg0w"),m(_e,"class","figure svelte-ixpg0w"),m(ze,"id","article-pooling"),m(ze,"class","svelte-ixpg0w"),m(Oe,"class","svelte-ixpg0w"),m(Pe,"class","svelte-ixpg0w"),m(Ve,"class","svelte-ixpg0w"),m(Xe,"id","article-flatten"),m(Xe,"class","svelte-ixpg0w"),m(De,"class","svelte-ixpg0w"),m(Ye,"class","svelte-ixpg0w"),m(Ue,"class","svelte-ixpg0w"),m(Qe,"class","svelte-ixpg0w"),m(tt,"class","video-link svelte-ixpg0w"),m(lt,"class","video-link svelte-ixpg0w"),m(st,"class","video-link svelte-ixpg0w"),m(rt,"class","video-link svelte-ixpg0w"),m(dt,"class","video-link svelte-ixpg0w"),m(ut,"class","video-link svelte-ixpg0w"),m(gt,"class","video-link svelte-ixpg0w"),m(yt,"class","video-link svelte-ixpg0w"),m(et,"class","svelte-ixpg0w"),m(ft,"class","video svelte-ixpg0w"),m(bt,"class","svelte-ixpg0w"),m(kt,"class","svelte-ixpg0w"),m(Lt,"class","svelte-ixpg0w"),m(At,"class","svelte-ixpg0w"),m(a,"id","description"),m(a,"class","svelte-ixpg0w")},m(l,o){r(l,t,o),i(t,a),i(a,s),i(a,d),i(a,u),i(a,h),i(a,f),i(a,x),i(a,v),i(a,w),i(a,k),i(a,$),i(a,L),i(a,I),i(a,A),i(a,N),i(a,M),i(a,C),i(a,E),i(a,R),i(a,S),i(a,T),i(a,_),i(a,H),i(a,z),i(a,F),i(a,O),i(a,G),i(a,P),i(a,B),i(a,V),i(a,q),i(a,X),i(a,U),i(a,J),i(a,Q),i(a,Z),i(a,ee),i(a,te),i(a,ae),i(a,le),i(a,ne),i(a,se),Y(ie,se,null),i(a,re),i(a,oe),i(a,de),i(a,ce),i(a,ue),i(a,pe),i(a,ge),i(a,he),i(a,ye),i(a,me),i(a,fe),i(a,xe),i(a,ve),i(a,be),i(a,we),i(a,ke),i(a,$e),i(a,Le),i(Le,Ie),i(Le,Ae),i(Le,Ne),i(Le,Me),i(Le,Ce),i(Le,Ee),i(a,Re),i(a,Se),i(a,Te),i(a,_e),i(a,He),i(a,ze),i(a,Fe),i(a,Oe),i(a,Ge),i(a,Pe),i(a,Be),i(a,Ve),i(a,qe),i(a,Xe),i(a,je),i(a,De),i(a,We),i(a,Ye),i(a,Ke),i(a,Ue),i(a,Je),i(a,Qe),i(a,Ze),i(a,et),i(et,tt),i(et,at),i(et,lt),i(et,nt),i(et,st),i(et,it),i(et,rt),i(et,ot),i(et,dt),i(et,ct),i(et,ut),i(et,pt),i(et,gt),i(et,ht),i(et,yt),i(a,mt),i(a,ft),Y(xt,ft,null),i(a,vt),i(a,bt),i(a,wt),i(a,kt),i(a,$t),i(a,Lt),i(a,It),i(a,At),Nt=!0,Mt||(Ct=[y(tt,"click",(function(){n(e[0].play(0))&&e[0].play(0).apply(this,arguments)})),y(lt,"click",(function(){n(e[0].play(27))&&e[0].play(27).apply(this,arguments)})),y(st,"click",(function(){n(e[0].play(37))&&e[0].play(37).apply(this,arguments)})),y(rt,"click",(function(){n(e[0].play(46))&&e[0].play(46).apply(this,arguments)})),y(dt,"click",(function(){n(e[0].play(82))&&e[0].play(82).apply(this,arguments)})),y(ut,"click",(function(){n(e[0].play(101))&&e[0].play(101).apply(this,arguments)})),y(gt,"click",(function(){n(e[0].play(126))&&e[0].play(126).apply(this,arguments)})),y(yt,"click",(function(){n(e[0].play(149))&&e[0].play(149).apply(this,arguments)}))],Mt=!0)},p(t,[a]){e=t;xt.$set({})},i(e){Nt||(j(ie.$$.fragment,e),j(xt.$$.fragment,e),Nt=!0)},o(e){D(ie.$$.fragment,e),D(xt.$$.fragment,e),Nt=!1},d(a){a&&o(t),K(ie),e[3](null),K(xt),Mt=!1,l(Ct)}}}function ta(e,t,a){let l;return[l,"$$\\text{Softmax}(x_{i}) = \\frac{\\exp(x_i)}{\\sum_j \\exp(x_j)}$$","$$\\text{ReLU}(x) = \\max(0,x)$$",function(e){R[e?"unshift":"push"](()=>{l=e,a(0,l)})}]}class aa extends Q{constructor(e){super(),J(this,e,ta,ea,s,{})}}class la{constructor(e,t,a,l,n){this.layerName=e,this.index=t,this.type=a,this.bias=l,this.output=n,this.inputLinks=[],this.outputLinks=[]}}class na{constructor(e,t,a){this.source=e,this.dest=t,this.weight=a}}const sa="input",ia="conv",ra="pool",oa="relu",da="fc",ca="flatten",ua=async(e,t)=>{let a=await ga(e,!0);console.log("input image tensor is: ",a);let l=tf.stack([a]),n=[];for(let e=0;e<t.layers.length;e++){let a=t.layers[e].apply(l),s=a.squeeze();3===s.shape.length&&(s=s.transpose([2,0,1])),n.push(s),l=a}return console.log("final cnn outputs is "),console.log(n),console.log("cnn result is "+n[11]),((e,t,a)=>{let l=[],n=[],s=t.layers[0].batchInputShape.slice(1),i=a.transpose([2,0,1]).arraySync();for(let e=0;e<s[2];e++){let t=new la("input",e,sa,0,i[e]);n.push(t)}l.push(n);let r=1;for(let a=0;a<t.layers.length;a++){let n=t.layers[a],s=e[a].squeeze();s=s.arraySync();let i,o=[];switch(n.name.includes("conv")?i=ia:n.name.includes("pool")?i=ra:n.name.includes("relu")?i=oa:n.name.includes("output")?i=da:n.name.includes("flatten")?i=ca:console.log("Find unknown type"),i){case ia:{let e=n.bias.val.arraySync(),t=n.kernel.val.transpose([3,2,0,1]).arraySync();for(let a=0;a<s.length;a++){let d=new la(n.name,a,i,e[a],s[a]);for(let e=0;e<l[r-1].length;e++){let n=l[r-1][e],s=new na(n,d,t[a][e]);n.outputLinks.push(s),d.inputLinks.push(s)}o.push(d)}break}case da:{let e=n.bias.val.arraySync(),t=n.kernel.val.transpose([1,0]).arraySync();for(let a=0;a<s.length;a++){let d=new la(n.name,a,i,e[a],s[a]),c=0;for(let e=0;e<l[r-1].length;e++){let n=l[r-1][e],s=new na(n,d,t[a][e]);n.outputLinks.push(s),d.inputLinks.push(s),c+=n.output*t[a][e]}c+=e[a],d.logit=c,o.push(d)}l[r-1].sort((e,t)=>e.realIndex-t.realIndex);break}case oa:case ra:{let e=0,t=null;for(let a=0;a<s.length;a++){let d=new la(n.name,a,i,e,s[a]),c=l[r-1][a],u=new na(c,d,t);c.outputLinks.push(u),d.inputLinks.push(u),o.push(d)}break}case ca:{let e=0;for(let t=0;t<s.length;t++){let a=l[r-1][0].output.length,d=l[r-1].length,c=t%d,u=Math.floor(Math.floor(t/d)/a),p=Math.floor(t/d)%a,g=c*(a*a)+u*a+p,h=new la(n.name,t,i,e,s[t]);h.realIndex=g;let y=new na(l[r-1][c],h,[u,p]);l[r-1][c].outputLinks.push(y),h.inputLinks.push(y),o.push(h)}o.sort((e,t)=>e.index-t.index);break}default:console.error("Encounter unknown layer type")}l.push(o),r++}return l})(n,t,a)},pa=(e,t,a,l=!0)=>{let n=tf.fill([t,a,3],0).arraySync();for(let s=0;s<e.length;s++){let i=Math.floor(s/4),r=s%4,o=t===a?Math.floor(i/t):i%t,d=t===a?i%t:Math.floor(i/t);if(r<3){let t=e[s];l&&(t/=255),n[o][d][r]=t}}return 64!=t&&64!=a&&(n=(e=>{let t,a=e.length,l=e[0].length;if(a<64||l<64){let t=Math.min(a,l),n=Math.floor(a/2)-t/2,s=Math.floor(l/2)-t/2;e.slice(n,n+t).map(e=>e.slice(s,s+t))}else{let n=Math.floor(a/2)-Math.floor(32),s=Math.floor(l/2)-Math.floor(32);t=e.slice(n,n+64).map(e=>e.slice(s,s+64))}return t})(n)),tf.tensor3d(n)},ga=(e,t=!0)=>{let a=document.createElement("canvas");a.style.cssText="display:none;",document.getElementsByTagName("body")[0].appendChild(a);let l=a.getContext("2d");return new Promise((n,s)=>{let i,r=new Image;r.crossOrigin="Anonymous",r.src=e,r.onload=()=>{if(a.width=r.width,a.height=r.height,r.width>64||r.height>64){let e=document.createElement("canvas"),t=e.getContext("2d");const a=65/Math.min(r.width,r.height);e.width=r.width*a,e.height=r.height*a,t.drawImage(r,0,0,e.width,e.height),r.width!=r.height&&(l.translate(e.width,0),l.scale(-1,1),l.translate(e.width/2,e.height/2),l.rotate(90*Math.PI/180)),r.width!=r.height?l.drawImage(e,-e.width/2,-e.height/2):l.drawImage(e,0,0),i=l.getImageData(0,0,e.width,e.height)}else l.drawImage(r,0,0),i=l.getImageData(0,0,r.width,r.height);let e=i.data,s=i.width,o=i.height;a.parentNode.removeChild(a),n(pa(e,s,o,t))},r.onerror=s})};const ha={nodeLength:40,plusSymbolRadius:8,numLayers:12,edgeOpacity:.8,edgeInitColor:"rgb(230, 230, 230)",edgeHoverColor:"rgb(130, 130, 130)",edgeHoverOuting:!1,edgeStrokeWidth:.7,intermediateColor:"gray",layerColorScales:{input:[d3.interpolateGreys,d3.interpolateGreys,d3.interpolateGreys],conv:d3.interpolateRdBu,relu:d3.interpolateRdBu,pool:d3.interpolateRdBu,fc:d3.interpolateGreys,weight:d3.interpolateBrBG,logit:d3.interpolateOranges},svgPaddings:{top:25,bottom:25,left:50,right:50},kernelRectLength:8/3,gapRatio:4,overlayRectOffset:12,classLists:["lifeboat","ladybug","pizza","bell pepper","school bus","koala","espresso","red panda","orange","sport car"]};const ya={nodeLength:96,nodeHeight:9.6,embedddingLength:307.2,inputNodeHeight:4.8,plusSymbolRadius:9.6,numLayers:4,edgeOpacity:.8,edgeInitColor:"rgb(230, 230, 230)",edgeHoverColor:"rgb(130, 130, 130)",edgeHoverOuting:!1,edgeStrokeWidth:.4,intermediateColor:"gray",layerColorScales:{input:d3.interpolateGreys,conv:d3.interpolateRdBu,embedding:d3.interpolateRdBu,lstm:d3.interpolateRdBu,dense:d3.interpolateGreys,weight:d3.interpolateBrBG,logit:d3.interpolateOranges},svgPaddings:{top:25,bottom:25,left:25,right:25},kernelRectLength:8/3,gapRatio:4,overlayRectOffset:12,classLists:["Hate","Love"]},ma=ha.nodeLength,fa=e=>{let t=1/0,a=-1/0;if(void 0===e.length||1===e.length)return[e,e];if(void 0===e[0].length){for(let l=0;l<e.length;l++)e[l]<t?t=e[l]:e[l]>a&&(a=e[l]);return[t,a]}for(let l=0;l<e.length;l++)for(let n=0;n<e[0].length;n++)e[l][n]<t?t=e[l][n]:e[l][n]>a&&(a=e[l][n]);return[t,a]},xa=e=>({x:e.x+ma,y:e.y+ma/2}),va=e=>({x:e.x,y:e.y+ma/2}),ba=(e,t,a,l)=>(void 0===l&&(l=0),e((a+t/2)/t*(1-2*l)+l)),wa=ha.layerColorScales,ka=ha.nodeLength,$a=ha.numLayers,La=ha.edgeOpacity,Ia=ha.edgeInitColor,Aa=ha.edgeStrokeWidth,Na=ha.svgPaddings,Ma=ha.gapRatio,Ca=ha.classLists,Ea=d3.format(".4f");let Ra=void 0;ae.subscribe(e=>{Ra=e});let Sa=void 0;le.subscribe(e=>{Sa=e});let Ta=void 0;ne.subscribe(e=>{Ta=e});let _a=void 0;te.subscribe(e=>{_a=e});let Ha=void 0;se.subscribe(e=>{Ha=e});let za=void 0;ie.subscribe(e=>{za=e});let Fa=void 0;re.subscribe(e=>{Fa=e});let Oa=void 0;oe.subscribe(e=>{Oa=e});let Ga=void 0;ce.subscribe(e=>{Ga=e});const Pa=(e,t,a,l)=>{let n=a[t],s=wa[e.type];"input"===e.type&&(s=s[e.index]);let i=void 0===e.output.length?1:e.output.length,r=document.createElement("canvas"),o=r.getContext("2d");r.width=i,r.height=i;let d=o.getImageData(0,0,i,i),c=d.data;if(1===i)c[0]=e.output;else for(let t=0;t<c.length;t+=4){let a=Math.floor(t/4),n=Math.floor(a/i),r=a%i,o=void 0;o="input"===e.type||"fc"===e.type?d3.rgb(s(1-e.output[n][r])):d3.rgb(s((e.output[n][r]+l/2)/l)),c[t]=o.r,c[t+1]=o.g,c[t+2]=o.b,c[t+3]=255}let u=document.createElement("canvas");u.width=3*ka,u.height=3*ka;let p=u.getContext("2d");o.putImageData(d,0,0),p.drawImage(r,0,0,i,i,0,0,3*ka,3*ka);let g=u.toDataURL();d3.select(n).attr("xlink:href",g),r.remove(),u.remove()},Ba=(e,t,a,l)=>{d3.select(a[t]).select("rect.output-rect").transition("output").delay(500).duration(800).ease(d3.easeCubicIn).attr("width",l(e.output))},Va=(e,t,a,l,n)=>{void 0===l&&(l=0),void 0===n&&(n=1);let s=e.append("defs").append("svg:linearGradient").attr("id",""+a).attr("x1","0%").attr("y1","100%").attr("x2","100%").attr("y2","100%").attr("spreadMethod","pad");for(let e=0;e<10;e++){let a=e/9,i=t(a*(n-l)+l);s.append("stop").attr("offset",100*a+"%").attr("stop-color",i).attr("stop-opacity",1)}},qa=(e,t,a,l,n,s)=>{Ta=(e-ka*$a)/(8+5*Ma),ne.set(Ta);let i=0;Ha.length=0;for(let e=0;e<_a.length;e++){let r=_a[e],o="output"===r[0].layerName;Ha.push([]),o||"conv"===r[0].type?i+=Ta*Ma:i+=Ta;let d=i,c=a.append("g").attr("class","cnn-layer-group").attr("id","cnn-layer-group-"+e);Sa=(t-ka*r.length)/(r.length+1),le.set(Sa);let u=c.selectAll("g.node-group").data(r,e=>e.index).enter().append("g").attr("class","node-group").style("cursor","pointer").style("pointer-events","all").on("click",s).on("mouseover",l).on("mouseleave",n).classed("node-output",o).attr("id",(t,a)=>{let l=a*ka+(a+1)*Sa;return l+=Na.top,Ha[e].push({x:d,y:l}),`layer-${e}-node-${a}`});c.selectAll("g.node-output").on("mouseover",(e,t,a)=>{l(e,t,a),ye.set({show:!0,text:"Output value: "+Ea(e.output)})}).on("mouseleave",(e,t,a)=>{n(e,t,a),ye.set({show:!1,text:"Output value: "+Ea(e.output)})}),"output"!==r[0].layerName?(u.append("image").attr("class","node-image").attr("width",ka).attr("height",ka).attr("x",d).attr("y",(t,a)=>Ha[e][a].y),u.append("rect").attr("class","bounding").attr("width",ka).attr("height",ka).attr("x",d).attr("y",(t,a)=>Ha[e][a].y).style("fill","none").style("stroke","gray").style("stroke-width",1).classed("hidden",!0)):(u.append("rect").attr("class","output-rect").attr("x",d).attr("y",(t,a)=>Ha[e][a].y+ka/2+8).attr("height",ka/4).attr("width",0).style("fill","gray"),u.append("text").attr("class","output-text").attr("x",d).attr("y",(t,a)=>Ha[e][a].y+ka/2).style("dominant-baseline","middle").style("font-size","11px").style("fill","black").style("opacity",.5).text((e,t)=>Ca[t])),i+=ka}se.set(Ha);let r=d3.scaleLinear().domain(Fa.output).range([0,ka]);for(let e=0;e<_a.length;e++){let t=Fa[za][e];Ra.select("g#cnn-layer-group-"+e).selectAll("image.node-image").each((e,a,l)=>Pa(e,a,l,t))}Ra.selectAll("g.node-output").each((e,t,a)=>Ba(e,t,a,r));let o=_a.map(e=>"output"===e[0].layerName?{name:e[0].layerName,dimension:`(${e.length})`}:{name:e[0].layerName,dimension:`(${e[0].output.length}, ${e[0].output.length}, ${e.length})`}),d=Number(d3.select("#cnn-svg").style("height").replace("px",""))+150,c=new SmoothScroll('a[href*="#"]',{offset:-d}),u=Ra.selectAll("g.layer-detailed-label").data(o).enter().append("g").attr("class","layer-detailed-label").attr("id",(e,t)=>"layer-detailed-label-"+t).classed("hidden",!Ga).attr("transform",(e,t)=>`translate(${Ha[t][0].x+ka/2}, ${(Na.top+Sa)/2-6})`).style("cursor",e=>e.name.includes("output")?"default":"help").on("click",e=>{let t="";e.name.includes("conv")&&(t="convolution"),e.name.includes("relu")&&(t="relu"),e.name.includes("max_pool")&&(t="pooling"),e.name.includes("input")&&(t="input");let a=document.querySelector("#article-"+t);c.animateScroll(a)});u.append("title").text("Move to article section"),u.append("text").style("opacity",.7).style("dominant-baseline","middle").append("tspan").style("font-size","12px").text(e=>e.name).append("tspan").style("font-size","8px").style("font-weight","normal").attr("x",0).attr("dy","1.5em").text(e=>e.dimension);let p=Ra.selectAll("g.layer-label").data(o).enter().append("g").attr("class","layer-label").attr("id",(e,t)=>"layer-label-"+t).classed("hidden",Ga).attr("transform",(e,t)=>`translate(${Ha[t][0].x+ka/2}, ${(Na.top+Sa)/2+5})`).style("cursor",e=>e.name.includes("output")?"default":"help").on("click",e=>{let t="";e.name.includes("conv")&&(t="convolution"),e.name.includes("relu")&&(t="relu"),e.name.includes("max_pool")&&(t="pooling"),e.name.includes("input")&&(t="input");let a=document.querySelector("#article-"+t);c.animateScroll(a)});p.append("title").text("Move to article section"),p.append("text").style("dominant-baseline","middle").style("opacity",.8).text(e=>e.name.includes("conv")?"conv":e.name.includes("relu")?"relu":e.name.includes("max_pool")?"max_pool":e.name),Va(Ra,wa.conv,"convGradient"),Va(Ra,wa.input[0],"inputGradient");((e,t)=>{for(let a=0;a<2;a++){let l=1+5*a,n=Fa.local[l],s=Fa.local[l+2],i=d3.scaleLinear().range([0,2*ka+Ta-1.2]).domain([-n/2,n/2]),r=d3.scaleLinear().range([0,3*ka+2*Ta-1.2]).domain([-s/2,s/2]),o=d3.axisBottom().scale(i).tickFormat(d3.format(".2f")).tickValues([-n/2,0,n/2]),d=d3.axisBottom().scale(r).tickFormat(d3.format(".2f")).tickValues([-s/2,0,s/2]),c=e.append("g").attr("class","legend local-legend").attr("id",`local-legend-${a}-1`).classed("hidden",!Ga||"local"!==za).attr("transform",`translate(${Ha[l][0].x}, 0)`);c.append("g").attr("transform",`translate(0, ${t-3})`).call(o),c.append("rect").attr("width",2*ka+Ta).attr("height",t).style("fill","url(#convGradient)");let u=e.append("g").attr("class","legend local-legend").attr("id",`local-legend-${a}-2`).classed("hidden",!Ga||"local"!==za).attr("transform",`translate(${Ha[l+2][0].x}, 0)`);u.append("g").attr("transform",`translate(0, ${t-3})`).call(d),u.append("rect").attr("width",3*ka+2*Ta).attr("height",t).style("fill","url(#convGradient)")}for(let a=0;a<2;a++){let l=1+5*a,n=Fa.module[l],s=d3.scaleLinear().range([0,5*ka+3*Ta+1*Ta*Ma-1.2]).domain([-n/2,n/2]),i=d3.axisBottom().scale(s).tickFormat(d3.format(".2f")).tickValues([-n/2,-n/4,0,n/4,n/2]),r=e.append("g").attr("class","legend module-legend").attr("id","module-legend-"+a).classed("hidden",!Ga||"module"!==za).attr("transform",`translate(${Ha[l][0].x}, 0)`);r.append("g").attr("transform",`translate(0, ${t-3})`).call(i),r.append("rect").attr("width",5*ka+3*Ta+1*Ta*Ma).attr("height",t).style("fill","url(#convGradient)")}let a=Fa.global[1],l=d3.scaleLinear().range([0,10*ka+6*Ta+3*Ta*Ma-1.2]).domain([-a/2,a/2]),n=d3.axisBottom().scale(l).tickFormat(d3.format(".2f")).tickValues([-a/2,-a/4,0,a/4,a/2]),s=e.append("g").attr("class","legend global-legend").attr("id","global-legend").classed("hidden",!Ga||"global"!==za).attr("transform",`translate(${Ha[1][0].x}, 0)`);s.append("g").attr("transform",`translate(0, ${t-3})`).call(n),s.append("rect").attr("width",10*ka+6*Ta+3*Ta*Ma).attr("height",t).style("fill","url(#convGradient)");let i=d3.scaleLinear().domain(Fa.output).range([0,ka-1.2]),r=d3.axisBottom().scale(i).tickFormat(d3.format(".1f")).tickValues([0,Fa.output[1]]),o=e.append("g").attr("class","legend output-legend").attr("id","output-legend").classed("hidden",!Ga).attr("transform",`translate(${Ha[11][0].x}, 0)`);o.append("g").attr("transform",`translate(0, ${t-3})`).call(r),o.append("rect").attr("width",ka).attr("height",t).style("fill","gray");let d=d3.scaleLinear().range([0,ka-1.2]).domain([0,1]),c=d3.axisBottom().scale(d).tickFormat(d3.format(".1f")).tickValues([0,.5,1]),u=e.append("g").attr("class","legend input-legend").classed("hidden",!Ga).attr("transform",`translate(${Ha[0][0].x}, 0)`);u.append("g").attr("transform",`translate(0, ${t-3})`).call(c),u.append("rect").attr("x",.3).attr("width",ka-.3).attr("height",t).attr("transform",`rotate(180, ${ka/2}, ${t/2})`).style("stroke","rgb(20, 20, 20)").style("stroke-width",.3).style("fill","url(#inputGradient)")})(Ra.append("g").attr("class","color-legend").attr("transform",`translate(0, ${Na.top+10*Sa+Sa+10*ka})`),5);let g=d3.linkHorizontal().x(e=>e.x).y(e=>e.y),h=((e,t)=>{let a=[];for(let l=1;l<t.length;l++)for(let n=0;n<t[l].length;n++){let s="output"===t[l][n].layerName,i=va(e[l][n]);for(let r=0;r<t[l][n].inputLinks.length;r++){let o=t[l][n].inputLinks[r].source.index;if(s){let e=t[l-1][0].output.length*t[l-1][0].output.length;if(o%e!=0)continue;o=Math.floor(o/e)}let d=xa(e[l-1][o]),c=t[l][n].inputLinks[r].weight;a.push({source:d,target:i,weight:c,targetLayerIndex:l,targetNodeIndex:n,sourceNodeIndex:o})}}return a})(Ha,_a);a.append("g").attr("class","edge-group").selectAll("path.edge").data(h).enter().append("path").attr("class",e=>`edge edge-${e.targetLayerIndex} edge-${e.targetLayerIndex}-${e.targetNodeIndex}`).attr("id",e=>`edge-${e.targetLayerIndex}-${e.targetNodeIndex}-${e.sourceNodeIndex}`).attr("d",e=>g({source:e.source,target:e.target})).style("fill","none").style("stroke-width",Aa).style("opacity",La).style("stroke",Ia);let y=a.append("g").attr("class","input-annotation"),m=y.append("text").attr("x",Ha[0][0].x+ka/2).attr("y",Ha[0][0].y+ka+5).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor","middle");m.append("tspan").style("dominant-baseline","hanging").style("fill","#C95E67").text("Red"),m.append("tspan").style("dominant-baseline","hanging").text(" channel"),y.append("text").attr("x",Ha[0][1].x+ka/2).attr("y",Ha[0][1].y+ka+5).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor","middle").style("fill","#3DB665").text("Green"),y.append("text").attr("x",Ha[0][2].x+ka/2).attr("y",Ha[0][2].y+ka+5).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor","middle").style("fill","#3F7FBC").text("Blue")},Xa=()=>{let e=d3.scaleLinear().domain(Fa.output).range([0,ka]);for(let t=0;t<_a.length;t++){let a=_a[t],l=Fa[za][t],n=Ra.select("g#cnn-layer-group-"+t).selectAll("g.node-group").data(a);t<_a.length-1?n.transition("disappear").duration(300).ease(d3.easeCubicOut).style("opacity",0).on("end",(function(){d3.select(this).select("image.node-image").each((e,t,a)=>Pa(e,t,a,l)),d3.select(this).transition("appear").duration(700).ease(d3.easeCubicIn).style("opacity",1)})):n.each((t,a,l)=>Ba(t,a,l,e))}for(let e=0;e<2;e++){let t=1+5*e,a=Fa.local[t],l=Fa.local[t+2],n=d3.scaleLinear().range([0,2*ka+Ta]).domain([-a,a]),s=d3.scaleLinear().range([0,3*ka+2*Ta]).domain([-l,l]),i=d3.axisBottom().scale(n).tickFormat(d3.format(".2f")).tickValues([-a,0,a]),r=d3.axisBottom().scale(s).tickFormat(d3.format(".2f")).tickValues([-l,0,l]);Ra.select(`g#local-legend-${e}-1`).select("g").call(i),Ra.select(`g#local-legend-${e}-2`).select("g").call(r)}for(let e=0;e<2;e++){let t=1+5*e,a=Fa.local[t],l=d3.scaleLinear().range([0,5*ka+3*Ta+1*Ta*Ma-1.2]).domain([-a,a]),n=d3.axisBottom().scale(l).tickFormat(d3.format(".2f")).tickValues([-a,-a/2,0,a/2,a]);Ra.select("g#module-legend-"+e).select("g").call(n)}let t=Fa.global[1],a=d3.scaleLinear().range([0,10*ka+6*Ta+3*Ta*Ma-1.2]).domain([-t,t]),l=d3.axisBottom().scale(a).tickFormat(d3.format(".2f")).tickValues([-t,-t/2,0,t/2,t]);Ra.select("g#global-legend").select("g").call(l);let n=d3.axisBottom().scale(e).tickFormat(d3.format(".1f")).tickValues([0,Fa.output[1]]);Ra.select("g#output-legend").select("g").call(n)},ja=()=>{let e=[1],t=void 0;Oa=[];for(let a=0;a<_a.length-1;a++){let l=_a[a],n=l.map(e=>fa(e.output)).reduce((e,t)=>[Math.min(e[0],t[0]),Math.max(e[1],t[1])]);Oa.push({min:n[0],max:n[1]}),"conv"!==l[0].type&&"fc"!==l[0].type||(n=n.map(Math.abs),t=2*(.1+Math.round(1e3*Math.max(...n))/1e3)),void 0!==t&&e.push(t)}e.push(1),Oa.push({min:0,max:1});let a=[1],l=($a-2)/5;for(let t=0;t<l;t++){let l=e.slice(1+5*t,1+5*t+5),n=Math.max(...l);for(let e=0;e<5;e++)a.push(n)}a.push(1);let n=[1],s=Math.max(...e.slice(1,e.length-1));for(let e=0;e<$a-2;e++)n.push(s);n.push(1),Fa.local=e,Fa.module=a,Fa.global=n,Fa.output=[0,d3.max(_a[_a.length-1].map(e=>e.output))],re.set(Fa),oe.set(Oa)},Da=ha.layerColorScales,Wa=ha.nodeLength,Ya=ha.intermediateColor,Ka=ha.svgPaddings;let Ua=void 0;ae.subscribe(e=>{Ua=e});let Ja=void 0;le.subscribe(e=>{Ja=e});const Qa=e=>{let t=e.layerIndex,a=e.targetX,l=e.disable,n=e.delay,s=e.opacity,i=e.specialIndex,r=e.onEndFunc,o=void 0===e.transitionName?"move":e.transitionName,d=void 0===e.duration?500:e.duration;Ua.select("g#cnn-layer-group-"+t).selectAll("g.node-group").each((e,t,r)=>{d3.select(r[t]).style("cursor",l&&t!==i?"default":"pointer").style("pointer-events",l&&t!==i?"none":"all").select("image").transition(o).ease(d3.easeCubicInOut).delay(n).duration(d).attr("x",a),d3.select(r[t]).select("rect.bounding").transition(o).ease(d3.easeCubicInOut).delay(n).duration(d).attr("x",a),void 0!==s&&t!==i&&d3.select(r[t]).select("image").style("opacity",s)}),Ua.selectAll("g#layer-label-"+t).transition(o).ease(d3.easeCubicInOut).delay(n).duration(d).attr("transform",()=>`translate(${a+Wa/2}, ${(Ka.top+Ja)/2+5})`).on("end",r),Ua.selectAll("g#layer-detailed-label-"+t).transition(o).ease(d3.easeCubicInOut).delay(n).duration(d).attr("transform",()=>`translate(${a+Wa/2}, ${(Ka.top+Ja)/2-6})`).on("end",r)},Za=(e,t,a)=>{void 0===a&&(a=Ua);let l=a.append("defs").attr("class","overlay-gradient").append("linearGradient").attr("id",e).attr("x1","0%").attr("x2","100%").attr("y1","100%").attr("y2","100%");t.forEach(e=>{l.append("stop").attr("offset",e.offset).attr("stop-color",e.color).attr("stop-opacity",e.opacity)})},el=e=>{let t=e.legendHeight,a=e.curLayerIndex,l=e.range,n=e.group,s=e.minMax,i=e.width,r=e.x,o=e.y,d=e.isInput,c=e.colorScale,u=e.gradientAppendingName,p=e.gradientGap;void 0===c&&(c=Da.conv),void 0===p&&(p=0);let g="url(#inputGradient)",h=e=>c(e*(1-2*p)+p);if(!d){let e=(s.min+l/2)/l,t=(0+l/2)/l,a=(s.max+l/2)/l,i=s.max-s.min,r=(0-s.min)/i,o=e+(t-e)/2,d=t+(a-t)/2,c=[{offset:0,color:h(e),opacity:1},{offset:r/2,color:h(o),opacity:1},{offset:r,color:h(t),opacity:1},{offset:r+(1-t)/2,color:h(d),opacity:1},{offset:1,color:h(a),opacity:1}];void 0===u?(Za("intermediate-legend-gradient",c,n),g="url(#intermediate-legend-gradient)"):(Za(""+u,c,n),g=`url(#${u})`)}let y=d3.scaleLinear().range([0,i-1.2]).domain(d?[0,l]:[s.min,s.max]),m=d3.axisBottom().scale(y).tickFormat(d3.format(d?"d":".2f")).tickValues(d?[0,l]:[s.min,0,s.max]),f=n.append("g").attr("class","intermediate-legend-"+(a-1)).attr("transform",`translate(${r}, ${o})`),x=f.append("g").attr("transform",`translate(0, ${t-3})`).call(m);x.selectAll("text").style("font-size","9px").style("fill",Ya),x.selectAll("path, line").style("stroke",Ya),f.append("rect").attr("width",i).attr("height",t).attr("transform",`rotate(${d?180:0},\n      ${i/2}, ${t/2})`).style("fill",g)},tl=e=>{let t=e.group,a=e.sx,l=e.sy,n=e.tx,s=e.ty,i=e.dr,r=e.hFlip,o=void 0===e.marker?"marker":e.marker;t.append("g").attr("class","arrow-group").append("path").attr("d",`M${a},${l}A${i},${i} 0 0,${r?0:1} ${n},${s}`).attr("marker-end",`url(#${o})`).style("stroke","gray").style("fill","none")},al=ha.layerColorScales,ll=ha.nodeLength,nl=ha.plusSymbolRadius,sl=ha.numLayers,il=ha.intermediateColor,rl=ha.kernelRectLength,ol=ha.svgPaddings,dl=ha.gapRatio,cl=ha.overlayRectOffset,ul=d3.format(".4f");let pl=!1,gl=void 0;ae.subscribe(e=>{gl=e});let hl=void 0;le.subscribe(e=>{hl=e});let yl=void 0;ne.subscribe(e=>{yl=e});let ml=void 0;te.subscribe(e=>{ml=e});let fl=void 0;se.subscribe(e=>{fl=e});let xl=void 0;ie.subscribe(e=>{xl=e});let vl=void 0;re.subscribe(e=>{vl=e});let bl=void 0;oe.subscribe(e=>{bl=e});let wl=[void 0,void 0];de.subscribe(e=>{wl=e});let kl=void 0;ue.subscribe(e=>{kl=e});let $l=void 0;ce.subscribe(e=>{$l=e});let Ll=void 0;fe.subscribe(e=>{Ll=e});const Il=(e,t,a,l,n)=>{const s=()=>{let i=+e.attr("data-origin-x"),r=+e.attr("data-origin-y"),o=+e.attr("data-tick"),d=o%t,c=Math.floor(o/t),u=i+d*a,p=r+c*a,g=(o+1)%(t*t);gl.selectAll(`rect.mask-${d}-${c}`).transition("window-sliding-mask").delay(l+100).duration(300).style("opacity",0),e.attr("data-tick",g).transition("window-sliding-input").delay(l).duration(200).attr("transform",`translate(${u}, ${p})`).on("end",()=>{0===g&&(pl||Nl(n)),kl&&s()})};s()},Al=(e,t,a,l)=>{const n=()=>{let s=+e.attr("data-origin-x"),i=+e.attr("data-origin-y"),r=+t.attr("data-origin-x"),o=+e.attr("data-tick"),d=o%a,c=Math.floor(o/a),u=s+d*l,p=i+c*l,g=r+o%a*l,h=(o+1)%(a*a);gl.selectAll(`rect.mask-${d}-${c}`).transition("window-sliding-mask").delay(300).duration(300).style("opacity",0),e.attr("data-tick",h).transition("window-sliding-input").delay(200).duration(200).attr("transform",`translate(${u}, ${p})`),t.attr("data-tick",h).transition("window-sliding-result").delay(200).duration(200).attr("transform",`translate(${g}, ${p})`).on("end",()=>{kl&&n()})};n()},Nl=e=>{null!==d3.event&&d3.event.stopPropagation();let t=ll/(3*rl),a=3*rl;if(pl){ue.set(!0),gl.selectAll(".kernel-clone").transition().duration(300).style("opacity",1),gl.selectAll("rect.mask-overlay").transition().duration(300).style("opacity",1);for(let l=0;l<fl[e-1].length;l++)Al(d3.select(".kernel-input-"+l),d3.select(".kernel-result-"+l),t,a);Il(d3.select(".kernel-output"),t,a,200,e),gl.selectAll("path.flow-edge").attr("stroke-dasharray","4 2").attr("stroke-dashoffset",0).each((e,t,a)=>Ml(e,t,a,-1e3)),gl.select(".animation-control-button").attr("xlink:href","/rnnExplainer/assets/img/fast_forward.svg"),pl=!1}else{ue.set(!1),gl.selectAll("rect.mask-overlay").transition("skip").duration(600).style("opacity",0),gl.selectAll(".kernel-clone").attr("data-tick",0).transition("skip").duration(300).style("opacity",0).on("end",(e,t,a)=>{let l=d3.select(a[t]),n=+l.attr("data-origin-x"),s=+l.attr("data-origin-y");l.attr("transform",`translate(${n}, ${s})`)}),gl.selectAll("path.flow-edge").interrupt().attr("stroke-dasharray","0 0"),gl.select(".animation-control-button").attr("xlink:href","/rnnExplainer/assets/img/redo.svg"),pl=!0}},Ml=(e,t,a,l)=>{d3.select(a[t]).transition().duration(6e4).ease(d3.easeLinear).attr("stroke-dashoffset",l).on("end",(e,t,a)=>{kl&&Ml(e,t,a,l-2e3)})},Cl=(e,t,a,l,n,s,i,r,o,d)=>{let c=gl.append("g").attr("class","intermediate-layer").style("opacity",0);pl=!1;let u=t+ll+n,p=u+ll+1.5*n,g=vl[xl][e],h=al[s.type],y=[],m=[],f=s.inputLinks.map(e=>fa(e.weight)).reduce((e,t)=>[Math.min(e[0],t[0]),Math.max(e[1],t[1])]),x=Math.round(1e3*Math.max(...f.map(Math.abs)))/1e3*2,v=3*rl,b=fl[e][i].y,w=gl.select(`#layer-${e}-node-${i}`),k=w.append("g").attr("class","overlay-group").attr("transform",`translate(${a}, ${b})`),$=Math.floor(ll/v);for(let e=0;e<$;e++)for(let t=0;t<$;t++)k.append("rect").attr("class",`mask-overlay mask-${e}-${t}`).attr("width",v).attr("height",v).attr("x",e*v).attr("y",t*v).style("fill","var(--light-gray)").style("stroke","var(--light-gray)").style("opacity",1);w.select("rect.bounding").raise();let L=c.append("g").attr("class","kernel kernel-output kernel-clone").attr("transform",`translate(${a}, ${b})`);L.append("rect").attr("x",0).attr("y",0).attr("width",3*rl).attr("height",3*rl).attr("fill","none").attr("stroke",il),L.attr("data-tick",0).attr("data-origin-x",a).attr("data-origin-y",b);let I=ll/(3*rl);Il(L,I,v,200,e),fl[e-1].forEach((a,l)=>{let n=ml[e-1][l].output,f=ml[e][i].inputLinks[l].weight,b=Ge(n,f);y.push(fa(b)),((e,t,a,l,n)=>{let s=l,i=document.createElement("canvas"),r=i.getContext("2d");i.width=s,i.height=s;let o=r.getImageData(0,0,s,s),d=o.data;for(let e=0;e<d.length;e+=4){let l=Math.floor(e/4),i=Math.floor(l/s),r=l%s,o=d3.rgb(a((n[i][r]+t/2)/t));d[e]=o.r,d[e+1]=o.g,d[e+2]=o.b,d[e+3]=255}let c=document.createElement("canvas");c.width=3*ll,c.height=3*ll;let u=c.getContext("2d");r.putImageData(o,0,0),u.drawImage(i,0,0,s,s,0,0,3*ll,3*ll);let p=c.toDataURL();e.attr("xlink:href",p),i.remove(),c.remove()})(((e,t,a,l,n,s,i,r,o,d,c)=>{let u=a.append("g").datum(ml[e-1][s]).attr("class","intermediate-node").attr("cursor",c?"pointer":"default").attr("pointer-events",c?"all":"none").attr("node-index",s).on("mouseover",r).on("mouseleave",o).on("click",(a,l,n)=>d(a,l,n,t,e));u.append("image").attr("width",ll).attr("height",ll).attr("x",l).attr("y",n);let p=Math.floor(ll/i),g=u.append("g").attr("class","overlay-group").attr("transform",`translate(${l}, ${n})`);for(let e=0;e<p;e++)for(let t=0;t<p;t++)g.append("rect").attr("class",`mask-overlay mask-${e}-${t}`).attr("width",i).attr("height",i).attr("x",e*i).attr("y",t*i).style("fill","var(--light-gray)").style("stroke","var(--light-gray)").style("opacity",1);return u.append("rect").attr("class","bounding").attr("width",ll).attr("height",ll).attr("x",l).attr("y",n).style("fill","none").style("stroke",il).style("stroke-width",1),u})(e,i,c,u,a.y,l,v,r,o,d,!0).select("image"),g,h,s.output.length,b),m.push({source:xa({x:t,y:a.y}),target:va({x:u,y:a.y}),name:`input-${l}-inter1-${l}`}),m.push({source:xa({x:u,y:a.y}),target:va({x:p,y:fl[e][i].y}),name:`inter1-${l}-inter2-1`});let w=t-3*rl*2,k=c.append("g").attr("class","kernel kernel-"+l).attr("transform",`translate(${w}, ${a.y})`),$="Kernel weights: [",L=d3.format(".2f");for(let e=0;e<f.length;e++)for(let t=0;t<f[0].length;t++){k.append("rect").attr("class","kernel").attr("x",rl*t).attr("y",rl*e).attr("width",rl).attr("height",rl).attr("fill",ba(al.weight,x,f[e][t],.2));let a="";a=0===t&&0==e?"":0===t?"; ":", ",$=$.concat(a,""+L(f[e][t]))}$=$.concat("]"),k.append("rect").attr("x",0).attr("y",0).attr("width",3*rl).attr("height",3*rl).attr("fill","none").attr("stroke",il),k.style("pointer-events","all").style("cursor","crosshair").on("mouseover",()=>{ye.set({show:!0,text:$})}).on("mouseleave",()=>{ye.set({show:!1,text:$})}).on("click",()=>{d3.event.stopPropagation()});let A=k.clone(!0).style("pointer-events","none").style("cursor","pointer").classed("kernel-clone",!0).classed("kernel-input-"+l,!0);A.style("opacity",.9).selectAll("rect.kernel").style("opacity",.7),A.attr("transform",`translate(${t}, ${a.y})`).attr("data-tick",0).attr("data-origin-x",t).attr("data-origin-y",a.y);let N=k.clone(!0).style("pointer-events","none").style("cursor","pointer").classed("kernel-clone",!0).classed("kernel-result-"+l,!0);N.style("opacity",.9).selectAll("rect.kernel").style("fill","none"),N.attr("transform",`translate(${u}, ${a.y})`).attr("data-origin-x",u).attr("data-origin-y",a.y),Al(A,N,I,v)});let A=y.reduce((e,t)=>[Math.min(e[0],t[0]),Math.max(e[1],t[1])]),N={min:A[0],max:A[1]},M=fl[e][i].y+ll/2,C=c.append("g").attr("class","plus-symbol").attr("transform",`translate(${p+nl}, ${M})`);C.append("rect").attr("x",-nl).attr("y",-nl).attr("width",2*nl).attr("height",2*nl).attr("rx",3).attr("ry",3).style("fill","none").style("stroke",il),C.append("rect").attr("x",-(nl-3)).attr("y",-.5).attr("width",2*(nl-3)).attr("height",1).style("fill",il),C.append("rect").attr("x",-.5).attr("y",-(nl-3)).attr("width",1).attr("height",2*(nl-3)).style("fill",il),0==i?(C.append("circle").attr("cx",0).attr("cy",ll/2+rl).attr("r",4).style("stroke",il).style("cursor","crosshair").style("fill",ba(al.weight,x,s.bias,.2)).on("mouseover",()=>{ye.set({show:!0,text:"Bias: "+ul(s.bias)})}).on("mouseleave",()=>{ye.set({show:!1,text:"Bias: "+ul(s.bias)})}),m.push({source:{x:p+nl,y:fl[e][i].y+ll},target:{x:p+nl,y:fl[e][i].y+ll/2+nl},name:"bias-plus"})):(C.append("circle").attr("cx",0).attr("cy",-ll/2-rl).attr("r",4).style("stroke",il).style("cursor","crosshair").style("fill",ba(al.weight,x,s.bias,.2)).on("mouseover",()=>{ye.set({show:!0,text:"Bias: "+ul(s.bias)})}).on("mouseleave",()=>{ye.set({show:!1,text:"Bias: "+ul(s.bias)})}),m.push({source:{x:p+nl,y:fl[e][i].y},target:{x:p+nl,y:fl[e][i].y+ll/2-nl},name:"bias-plus"})),m.push({source:xa({x:p+2*nl-ll,y:fl[e][i].y}),target:va({x:a,y:fl[e][i].y}),name:"symbol-output"}),m.push({source:xa({x:a,y:fl[e][i].y}),target:va({x:l,y:fl[e][i].y}),name:"output-next"}),c.append("g").attr("class","layer-intermediate-label layer-label").attr("transform",()=>`translate(${u+ll/2}, ${(ol.top+hl)/2+5})`).classed("hidden",$l).append("text").style("text-anchor","middle").style("dominant-baseline","middle").style("font-weight",800).style("opacity","0.8").text("intermediate"),c.append("g").attr("class","animation-control").attr("transform",()=>`translate(${u+ll/2}, ${(ol.top+hl)/2-4})`).on("click",()=>Nl(e)).append("image").attr("class","animation-control-button").attr("xlink:href","/rnnExplainer/assets/img/fast_forward.svg").attr("x",50).attr("y",0).attr("height",13).attr("width",13),c.append("g").attr("class","layer-intermediate-label layer-detailed-label").attr("transform",()=>`translate(${u+ll/2}, ${(ol.top+hl)/2-5})`).classed("hidden",!$l).append("text").style("text-anchor","middle").style("dominant-baseline","middle").style("opacity","0.7").style("font-weight",800).append("tspan").text("intermediate").append("tspan").style("font-size","8px").style("font-weight","normal").attr("x",0).attr("dy","1.5em").text(`(${ml[e][0].output.length},\n      ${ml[e][0].output[0].length},\n      ${ml[e].length})`);let E=d3.linkHorizontal().x(e=>e.x).y(e=>e.y),R=c.append("g").attr("class","edge-group").lower();return R.selectAll("path").data(m).enter().append("path").classed("flow-edge",e=>"output-next"!==e.name).attr("id",e=>"edge-"+e.name).attr("d",e=>E({source:e.source,target:e.target})).style("fill","none").style("stroke-width",1).style("stroke",il),R.select("#edge-output-next").style("opacity",.1),R.selectAll("path.flow-edge").attr("stroke-dasharray","4 2").attr("stroke-dashoffset",0).each((e,t,a)=>Ml(e,t,a,-1e3)),{intermediateLayer:c,intermediateMinMax:N,kernelRange:x,kernelMinMax:{min:f[0],max:f[1]}}},El=e=>{let t,a,l,n,s,i,r,o,d,c,u,p,g=e.leftX,h=e.curLayerIndex,y=e.group,m=e.intermediateGap,f=e.isFirstConv,x=e.i,v=y.append("g").attr("class","kernel-annotation");v.append("text").text("Kernel").attr("class","annotation-text").attr("x",g-2.5*rl*3).attr("y",fl[h-1][0].y+3*rl).style("dominant-baseline","baseline").style("text-anchor","end"),f?(t=g,a=fl[h-1][0].y+ll+3*rl,l=g-5,n=fl[h-1][0].y+ll+3*rl+5,s=20,i=g,r=fl[h-1][1].y+ll+3*rl,o=g-3*rl,d=fl[h-1][1].y+ll+15,u=g-13,p=fl[h-1][1].y+15,c=35):(t=g-3*rl*3,a=fl[h-1][0].y+ll/3,l=g-2*rl*3-5,n=fl[h-1][0].y+ll-10,s=50,i=g-3*rl*3,r=fl[h-1][2].y-3,u=g-3*rl-4,p=fl[h-1][2].y+3*rl+6,o=g-3*rl-13,d=fl[h-1][2].y+26,c=20);let b=v.append("text").attr("x",t).attr("y",a).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor",f?"start":"end");b.append("tspan").style("dominant-baseline","hanging").text("Slide kernel over input channel"),b.append("tspan").attr("x",t).attr("dy","1em").style("dominant-baseline","hanging").text("to get intermediate result"),b.append("tspan").attr("x",t).attr("dy","1.2em").style("dominant-baseline","hanging").style("font-weight",700).text("Click "),b.append("tspan").style("dominant-baseline","hanging").style("font-weight",400).text("to learn more"),tl({group:y,tx:g-7,ty:fl[h-1][0].y+ll/2,sx:l,sy:n,hFlip:!f,dr:s,marker:"marker"});let w=v.append("text").attr("x",i).attr("y",r).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor",f?"start":"end");w.append("tspan").style("dominant-baseline","hanging").text("Each input chanel"),w.append("tspan").attr("x",t).attr("dy","1em").style("dominant-baseline","hanging").text("gets a different kernel"),w.append("tspan").attr("x",t).attr("dy","1.3em").style("font-weight",700).style("dominant-baseline","hanging").text("Hover over "),w.append("tspan").style("font-weight",400).style("dominant-baseline","hanging").text("to see value!"),tl({group:y,tx:u,ty:p,sx:o,sy:d,dr:c,hFlip:!f,marker:"marker"});let k=y.append("g").attr("class","plus-annotation"),$=g+2*ll+2.5*m,L=$,I=fl[h][x].y+ll+3*rl;0===x&&(L+=30),9===x&&(L=$+nl-10,I-=2.5*ll);let A=k.append("text").attr("x",L).attr("y",I).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor","start");A.append("tspan").style("dominant-baseline","hanging").text("Add up all intermediate"),A.append("tspan").attr("x",L).attr("dy","1em").style("dominant-baseline","hanging").text("results and then add bias"),tl(9===x?{group:y,sx:$+50,sy:fl[h][x].y-(ll/2+2*rl),tx:$+2*nl+5,ty:fl[h][x].y+ll/2-nl,dr:50,hFlip:!1,marker:"marker-alt"}:{group:y,sx:$+35,sy:fl[h][x].y+ll+2*rl,tx:$+2*nl+5,ty:fl[h][x].y+ll/2+nl,dr:30,hFlip:!0,marker:"marker-alt"});let N=fl[h][x].y;0===x?N+=ll+3*rl:N-=2*rl+5,k.append("text").attr("class","annotation-text").attr("x",$+nl).attr("y",N).style("text-anchor","middle").style("dominant-baseline",0===x?"hanging":"baseline").text("Bias")},Rl=(e,t,a,l,n,s,i,r)=>{let o=gl.select("g.underneath");for(let d=0;d<ml[e-1].length;d++)o.append("rect").attr("class","underneath-gateway").attr("id","underneath-gateway-"+d).attr("x",a-n).attr("y",fl[e-1][d].y-n).attr("width",2*ll+l+2*n).attr("height",ll+2*n).attr("rx",10).style("fill","rgba(160, 160, 160, 0.2)").style("opacity",0),gl.select(`g#layer-${e-1}-node-${d}`).style("pointer-events","all").style("cursor","pointer").on("mouseover",s).on("mouseleave",i).on("click",(a,l,n)=>r(a,l,n,t,e));o.lower()},Sl=(e,t,a,l,n)=>{gl.select(".intermediate-layer-overlay").empty()&&gl.append("g").attr("class","intermediate-layer-overlay"),gl.select(".intermediate-layer-overlay").append("rect").attr("class","overlay").style("fill",`url(#${e})`).style("stroke","none").attr("width",l).attr("height",n).attr("x",t).attr("y",a).style("opacity",0).transition("move").duration(800).ease(d3.easeCubicInOut).style("opacity",1)},Tl=(e,t)=>{let a=vl[xl][e-1],l=vl[xl][e],n=Math.max(a,l);a>l?(gl.select(`g#layer-${e}-node-${t}`).select("image.node-image").each((e,t,a)=>Pa(e,t,a,n)),wl=[e,t],de.set(wl)):a<l&&(gl.select("g#cnn-layer-group-"+(e-1)).selectAll("image.node-image").each((e,t,a)=>Pa(e,t,a,n)),wl=[e-1,void 0],de.set(wl));let s=bl[e-1].min,i=bl[e-1].max,r=ml[e][t];for(let e=0;e<r.output.length;e++)for(let t=0;t<r.output[0].length;t++)r.output[e][t]<s&&(s=r.output[e][t]),r.output[e][t]>i&&(i=r.output[e][t]);return{range:n,minMax:{min:s,max:i}}},_l=(e,t,a,l,n,s,i,r)=>{let o=fl[e-1][0].x+2*ll+2*yl*dl+2*nl,d=yl*dl*2/3,c=fl[e-1][0].x;Ll.conv_1_1=o+ll,fe.set(Ll),gl.select("g.edge-group").style("visibility","hidden"),Qa({layerIndex:e,targetX:o,disable:!0,delay:0,opacity:.15,specialIndex:a});let u=o+ll+yl*dl,p=(l-u-10*ll)/10;for(let t=e+1;t<sl;t++){Qa({layerIndex:t,targetX:u+(t-(e+1))*(ll+p),disable:!0,delay:0})}Za("overlay-gradient",[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.95},{offset:"100%",color:"rgb(250, 250, 250)",opacity:1}]),Sl("overlay-gradient",u-cl/2,0,l-u+cl,n+ol.top+ol.bottom);let{intermediateLayer:g,intermediateMinMax:h,kernelRange:y,kernelMinMax:m}=Cl(e,c,o,u,d,t,a,s,i,r);Rl(e,a,c,d,8,s,i,r);let f=1/0,x=-1/0,v=ml[e][a];for(let e=0;e<v.output.length;e++)for(let t=0;t<v.output[0].length;t++)v.output[e][t]<f&&(f=v.output[e][t]),v.output[e][t]>x&&(x=v.output[e][t]);let b={min:Math.min(f,h.min),max:Math.max(x,h.max)},w=gl.append("g").attr("class","intermediate-layer-annotation").style("opacity",0);El({leftX:c,curLayerIndex:e,group:w,intermediateGap:d,isFirstConv:!0,i:a});let k=vl.local[e];el({legendHeight:5,curLayerIndex:e,range:1,group:g,width:2*ll+d,isInput:!0,x:c,y:ol.top+10*hl+hl+10*ll-25}),el({legendHeight:5,curLayerIndex:e,range:k,minMax:b,group:g,width:2*ll+d,x:fl[e-1][2].x,y:ol.top+10*hl+hl+10*ll}),el({legendHeight:5,curLayerIndex:e,range:y,minMax:m,group:g,width:2*ll+d,x:o+ll-(2*ll+d),y:ol.top+10*hl+hl+10*ll,gradientAppendingName:"kernelColorGradient",colorScale:al.weight,gradientGap:.2}),gl.selectAll("g.intermediate-layer, g.intermediate-layer-annotation").transition().delay(500).duration(500).ease(d3.easeCubicInOut).style("opacity",1)},Hl=(e,t,a,l,n,s,i,r)=>{let o=fl[e-1][0].x+2*ll+2*yl*dl+2*nl,d=yl*dl*2/3;Ll.conv_1_2=o+ll,fe.set(Ll);let{range:c,minMax:u}=Tl(e,a);gl.select("g.edge-group").style("visibility","hidden"),Qa({layerIndex:e,targetX:o,disable:!0,delay:0,opacity:.15,specialIndex:a});let p=o+ll+yl*dl,g=(l-p-8*ll)/8;for(let t=e+1;t<sl;t++){Qa({layerIndex:t,targetX:p+(t-(e+1))*(ll+g),disable:!0,delay:0})}let h=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.95},{offset:"100%",color:"rgb(250, 250, 250)",opacity:1}];Za("overlay-gradient-right",h),h=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85+(.95-.85)*((2*ll+yl*dl)/(8*ll+7*d))},{offset:"100%",color:"rgb(250, 250, 250)",opacity:.85}],Za("overlay-gradient-left",h),Sl("overlay-gradient-right",p-cl/2,0,l-p+cl,n+ol.top+ol.bottom),Sl("overlay-gradient-left",fl[0][0].x-cl/2,0,2*ll+yl*dl+cl,n+ol.top+ol.bottom);let y=fl[e-1][0].x,{intermediateLayer:m,intermediateMinMax:f,kernelRange:x,kernelMinMax:v}=Cl(e,y,o,p,d,t,a,s,i,r);Rl(e,a,y,d,5,s,i,r);let b={min:Math.min(u.min,f.min),max:Math.max(u.max,f.max)},w=gl.append("g").attr("class","intermediate-layer-annotation").style("opacity",0);El({leftX:y,curLayerIndex:e,group:w,intermediateGap:d,i:a}),el({legendHeight:5,curLayerIndex:e,range:c,minMax:b,group:m,width:2*ll+d,x:y,y:ol.top+10*hl+hl+10*ll}),el({legendHeight:5,curLayerIndex:e,range:x,minMax:v,group:m,width:2*ll+d,x:o+ll-(2*ll+d),y:ol.top+10*hl+hl+10*ll,gradientAppendingName:"kernelColorGradient",colorScale:al.weight,gradientGap:.2}),gl.selectAll("g.intermediate-layer, g.intermediate-layer-annotation").transition().delay(500).duration(500).ease(d3.easeCubicInOut).style("opacity",1)},zl=(e,t,a,l,n,s,i,r)=>{let o=fl[e][0].x,d=o-(2*ll+2*yl*dl+2*nl),c=yl*dl*2/3;Ll.conv_2_1=o+ll,fe.set(Ll),gl.select("g.edge-group").style("visibility","hidden");let{range:u,minMax:p}=Tl(e,a);Qa({layerIndex:e-1,targetX:d,disable:!0,delay:0}),Qa({layerIndex:e,targetX:o,disable:!0,delay:0,opacity:.15,specialIndex:a});let g=d-yl,h=(g-fl[0][0].x-5*ll)/5,y=fl[e][0].x+ll+yl;for(let t=0;t<e-1;t++){let e=fl[0][0].x+t*(ll+h);Qa({layerIndex:t,targetX:e,disable:!0,delay:0})}let m=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:1},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.9},{offset:"100%",color:"rgb(250, 250, 250)",opacity:.85}];Za("overlay-gradient-left",m),m=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.95},{offset:"100%",color:"rgb(250, 250, 250)",opacity:1}],Za("overlay-gradient-right",m),Sl("overlay-gradient-left",fl[0][0].x-cl/2,0,g-fl[0][0].x+cl,n+ol.top+ol.bottom),Sl("overlay-gradient-right",y-cl/2,0,l-y+cl,n+ol.top+ol.bottom);let{intermediateLayer:f,intermediateMinMax:x,kernelRange:v,kernelMinMax:b}=Cl(e,d,fl[e][0].x,y,c,t,a,s,i,r);Rl(e,a,d,c,5,s,i,r);let w={min:Math.min(p.min,x.min),max:Math.max(p.max,x.max)},k=gl.append("g").attr("class","intermediate-layer-annotation").style("opacity",0);El({leftX:d,curLayerIndex:e,group:k,intermediateGap:c,i:a}),el({legendHeight:5,curLayerIndex:e,range:u,group:f,width:2*ll+c,minMax:w,x:d,y:ol.top+10*hl+hl+10*ll}),el({legendHeight:5,curLayerIndex:e,range:v,minMax:b,group:f,width:2*ll+c,x:o+ll-(2*ll+c),y:ol.top+10*hl+hl+10*ll,gradientAppendingName:"kernelColorGradient",colorScale:al.weight,gradientGap:.2}),gl.selectAll("g.intermediate-layer, g.intermediate-layer-annotation").transition().delay(500).duration(500).ease(d3.easeCubicInOut).style("opacity",1)},Fl=(e,t,a,l,n,s,i,r)=>{let o=fl[e][0].x,d=o-(2*ll+2*yl*dl+2*nl),c=yl*dl*2/3;Ll.conv_2_2=d,fe.set(Ll),gl.select("g.edge-group").style("visibility","hidden");let{range:u,minMax:p}=Tl(e,a);Qa({layerIndex:e-1,targetX:d,disable:!0,delay:0}),Qa({layerIndex:e,targetX:o,disable:!0,delay:0,opacity:.15,specialIndex:a});let g=d-yl,h=(g-fl[0][0].x-7*ll)/7,y=o+ll+yl;for(let t=0;t<e-1;t++){let e=fl[0][0].x+t*(ll+h);Qa({layerIndex:t,targetX:e,disable:!0,delay:0})}let m=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:1},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.95},{offset:"100%",color:"rgb(250, 250, 250)",opacity:.85}];Za("overlay-gradient-left",m),m=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.95},{offset:"100%",color:"rgb(250, 250, 250)",opacity:1}],Za("overlay-gradient-right",m),Sl("overlay-gradient-left",fl[0][0].x-cl/2,0,g-fl[0][0].x+cl,n+ol.top+ol.bottom),Sl("overlay-gradient-right",y-cl/2,0,l-y+cl,n+ol.top+ol.bottom);let{intermediateLayer:f,intermediateMinMax:x,kernelRange:v,kernelMinMax:b}=Cl(e,d,fl[e][0].x,y,c,t,a,s,i,r);Rl(e,a,d,c,5,s,i,r);let w={min:Math.min(p.min,x.min),max:Math.max(p.max,x.max)},k=gl.append("g").attr("class","intermediate-layer-annotation").style("opacity",0);El({leftX:d,curLayerIndex:e,group:k,intermediateGap:c,i:a}),el({legendHeight:5,curLayerIndex:e,range:u,group:f,minMax:w,width:2*ll+c,x:d,y:ol.top+10*hl+hl+10*ll}),el({legendHeight:5,curLayerIndex:e,range:v,minMax:b,group:f,width:2*ll+c,x:o+ll-(2*ll+c),y:ol.top+10*hl+hl+10*ll,gradientAppendingName:"kernelColorGradient",colorScale:al.weight,gradientGap:.2}),gl.selectAll("g.intermediate-layer, g.intermediate-layer-annotation").transition().delay(500).duration(500).ease(d3.easeCubicInOut).style("opacity",1)},Ol=ha.layerColorScales,Gl=ha.nodeLength,Pl=ha.plusSymbolRadius,Bl=ha.intermediateColor,Vl=ha.kernelRectLength,ql=ha.svgPaddings,Xl=ha.gapRatio,jl=ha.classLists,Dl=d3.format(".4f");let Wl=void 0;ae.subscribe(e=>{Wl=e});let Yl=void 0;le.subscribe(e=>{Yl=e});let Kl=void 0;ne.subscribe(e=>{Kl=e});let Ul=void 0;te.subscribe(e=>{Ul=e});let Jl=void 0;se.subscribe(e=>{Jl=e});let Ql=void 0;ie.subscribe(e=>{Ql=e});let Zl=void 0;re.subscribe(e=>{Zl=e});let en=void 0;oe.subscribe(e=>{en=e});let tn=void 0;pe.subscribe(e=>{tn=e});let an=void 0;he.subscribe(e=>{an=e});let ln=void 0;ge.subscribe(e=>{ln=e});let nn=void 0;ye.subscribe(e=>{nn=e});let sn=void 0;ce.subscribe(e=>{sn=e});let rn=10,on=11,dn=!1,cn=[],un={};const pn=(e,t,a,l,n,s)=>{let i=d3.select(a[t]);if(s){let e=+i.attr("data-preX"),t=+i.attr("data-preY");i.transition("softmax").duration(n).ease(d3.easeCubicInOut).attr("transform",`translate(${e}, ${t})`)}else{let e=i.attr("transform"),t=+e.replace(/.*\(([\d\.]+),.*/,"$1"),a=+e.replace(/.*,\s([\d\.]+)\)/,"$1");i.transition("softmax").duration(n).ease(d3.easeCubicInOut).attr("transform",`translate(${t-l}, ${a})`),i.attr("data-preX",t),i.attr("data-preY",a)}},gn=e=>{ye.set({show:!0,text:"Logit: "+Dl(cn[e])}),ln.highlightI=e,ge.set(ln);let t=Wl.select(".logit-layer"),a=Wl.select(".underneath"),l=Wl.select(".intermediate-layer");t.select("#logit-circle-"+e).style("stroke-width",2),l.select("#plus-symbol-clone-"+e).style("opacity",1).select("circle").style("fill",e=>e.fill),a.select("#logit-lower-"+e).raise(),a.selectAll(".softmax-abstract-edge-"+e).style("stroke-width",.8).style("stroke","#E0E0E0"),a.selectAll(".softmax-edge-"+e).style("stroke-width",1).style("stroke","#E0E0E0"),a.selectAll(".logit-output-edge-"+e).style("stroke-width",3).style("stroke","#E0E0E0"),t.selectAll(".logit-output-edge-"+e).style("stroke-width",3).style("stroke","#E0E0E0")},hn=e=>{ye.set({show:!1,text:"Logit: "+Dl(cn[e])}),ln.highlightI=-1,ge.set(ln);let t=Wl.select(".logit-layer"),a=Wl.select(".underneath"),l=Wl.select(".intermediate-layer");t.select("#logit-circle-"+e).style("stroke-width",1),l.select("#plus-symbol-clone-"+e).style("opacity",.2),a.selectAll(".softmax-abstract-edge-"+e).style("stroke-width",.2).style("stroke","#EDEDED"),a.selectAll(".softmax-edge-"+e).style("stroke-width",.2).style("stroke","#F1F1F1"),a.selectAll(".logit-output-edge-"+e).style("stroke-width",1.2).style("stroke","#E5E5E5"),t.selectAll(".logit-output-edge-"+e).style("stroke-width",1.2).style("stroke","#E5E5E5")},yn=e=>{gn(e.detail.curI)},mn=e=>{hn(e.detail.curI)},fn=e=>{let t=e.curLayerIndex,a=e.moveX,l=e.symbolX,n=e.symbolY,s=e.outputX,i=e.outputY,r=e.softmaxLeftMid,o=e.selectedI,d=e.intermediateX1,c=e.intermediateX2,u=e.pixelWidth,p=e.pixelHeight,g=e.topY,h=e.bottomY,y=e.middleGap,m=e.middleRectHeight,f=e.softmaxX,x=e.softmaxTextY,v=e.softmaxWidth,b=e.symbolGroup,w=e.flattenRange,k=r-4*a/5;d3.event.stopPropagation(),tn?(he.set(!1),Wl.select(".logit-layer").remove(),Wl.select(".logit-layer-lower").remove(),Wl.selectAll(".plus-symbol-clone").remove(),Wl.select(".underneath").selectAll(".logit-lower").style("opacity",0),ge.set({show:!1,logits:[]})):he.set(!0),Wl.select(".intermediate-layer-overlay").select("rect.overlay").transition("softmax").ease(d3.easeCubicInOut).duration(600).attr("transform",`translate(${tn?0:-a}, 0)`),Wl.selectAll(".intermediate-legend-"+(t-1)).each((e,t,l)=>pn(0,t,l,a,600,tn)),Wl.select(".intermediate-layer").select(".layer-label").each((e,t,l)=>pn(0,t,l,a,600,tn)),Wl.select(".intermediate-layer").select(".layer-detailed-label").each((e,t,l)=>pn(0,t,l,a,600,tn));for(let e=t-1;e>=0;e--){let t=+Wl.select("g#cnn-layer-group-"+e).select("image").attr("x");Qa({layerIndex:e,targetX:tn?t+a:t-a,disable:!0,delay:0,transitionName:"softmax",duration:600})}Wl.select(".plus-annotation").transition("softmax").duration(600).style("opacity",tn?1:0).style("pointer-events",tn?"all":"none");let $=Wl.select(".softmax-annotation").style("pointer-events",tn?"all":"none"),L=$.selectAll(".softmax-detail-annoataion").data([0]).enter().append("g").attr("class","softmax-detail-annoataion");tn&&$.selectAll(".softmax-detail-annoataion").remove(),$.select(".arrow-group").transition("softmax").duration(600).style("opacity",tn?1:0),$.select(".annotation-text").style("cursor","help").style("pointer-events","all").on("click",()=>{d3.event.stopPropagation(),document.querySelector("#article-softmax").scrollIntoView({behavior:"smooth"})}).transition("softmax").duration(600).style("opacity",tn?1:0).on("end",()=>{if(!tn){let e=f+v/2,a=x-10;0===o&&(a=x+70);let l=L.append("text").attr("x",e).attr("y",a).attr("class","annotation-text softmax-detail-text").style("dominant-baseline","baseline").style("text-anchor","middle").text("Normalize ");l.append("tspan").attr("dx",1).style("fill","#E56014").text("logits"),l.append("tspan").attr("dx",1).text(" into"),l.append("tspan").attr("x",e).attr("dy","1.1em").text("class probabilities"),tl(0===o?{group:L,sx:f+v/2-5,sy:x+44,tx:f+v/2,ty:a-12,dr:50,hFlip:!0,marker:"marker-alt"}:{group:L,sx:f+v/2-5,sy:x+4,tx:f+v/2,ty:n-Pl-4,dr:50,hFlip:!0,marker:"marker-alt"}),e=k+45,a=(ql.top+Yl)/2+5;let s=k+20,i=(ql.top+Yl)/2+5;L.append("g").attr("class","layer-detailed-label").attr("transform",()=>`translate(${k}, ${(ql.top+Yl)/2-5})`).classed("hidden",!sn).append("text").style("opacity",.7).style("dominant-baseline","middle").style("font-size","12px").style("font-weight","800").append("tspan").attr("x",0).text("logit").append("tspan").attr("x",0).style("font-size","8px").style("font-weight","normal").attr("dy","1.5em").text("(10)"),L.append("text").attr("class","annotation-text").attr("x",e).attr("y",(ql.top+Yl)/2+3).style("text-anchor","start").text("Before").append("tspan").attr("x",e).attr("dy","1em").text("normalization"),tl({group:L,tx:s,ty:i,sx:e-6,sy:a+2,dr:60,hFlip:!1,marker:"marker-alt"}),L.append("text").attr("class","annotation-text").attr("x",Jl[on][0].x-35).attr("y",(ql.top+Yl)/2+3).style("text-anchor","end").text("After").append("tspan").attr("x",Jl[on][0].x-35).attr("dy","1em").text("normalization"),tl({group:L,tx:Jl[on][0].x-8,ty:i,sx:Jl[on][0].x-27,sy:a+2,dr:60,hFlip:!0,marker:"marker-alt"});for(let e=0;e<10;e++)L.append("text").attr("x",k).attr("y",Jl[t-1][e].y+Gl/2+8).attr("class","annotation-text softmax-detail-text").attr("id","logit-text-"+e).style("text-anchor","middle").style("dominant-baseline","hanging").style("opacity",0).text(""+jl[e]);let r=L.append("g").attr("class","softmax-detail-hover-annotation").style("opacity",0);e=k+50,a=Jl[t-1][0].y+Gl/2,o<3&&(a=Jl[t-1][9].y+Gl/2);let d=r.append("text").attr("x",e).attr("y",a).attr("class","annotation-text softmax-detail-text softmax-hover-text").style("text-anchor","start").style("dominant-baseline","baseline").append("tspan").style("font-weight",700).style("dominant-baseline","baseline").text("Hover over ").append("tspan").style("font-weight",400).style("dominant-baseline","baseline").text("to see");d.append("tspan").style("dominant-baseline","baseline").attr("x",e).attr("dy","1em").text("its "),d.append("tspan").style("dominant-baseline","baseline").attr("dx",1).style("fill","#E56014").text("logit"),d.append("tspan").style("dominant-baseline","baseline").attr("dx",1).text(" value"),tl({group:r,tx:k+15,ty:a,sx:e-8,sy:a+2,dr:60,hFlip:!1})}}),Wl.select(".flatten-annotation").transition("softmax").duration(600).style("opacity",tn?1:0).style("pointer-events",tn?"all":"none");let I=Wl.select(".flatten-layer-left");I.transition("softmax").duration(600).ease(d3.easeCubicInOut).attr("transform",`translate(${tn?0:-a}, 0)`).on("end",()=>{if(!tn){(e=>{let t=e.curLayerIndex,a=e.moveX,l=e.softmaxLeftMid,n=e.selectedI,s=e.intermediateX1,i=e.intermediateX2,r=e.pixelWidth,o=e.pixelHeight,d=e.topY,c=e.bottomY,u=e.softmaxX,p=e.middleGap,g=e.middleRectHeight,h=e.symbolGroup,y=e.symbolX,m=e.flattenRange,f=Wl.select(".intermediate-layer").append("g").attr("class","logit-layer").raise(),x=Wl.select(".intermediate-layer").select(".flatten-layer").select(".plus-symbol").clone(!0).attr("class","temp-clone-plus-symbol").attr("transform",`translate(${y-a},\n      ${Jl[t][n].y+Gl/2})`).style("pointer-events","none").remove(),v=f.append(()=>x.node());Wl.select(".softmax-symbol").raise();let b=Wl.select(".underneath").append("g").attr("class","logit-layer-lower").lower(),w=l-4*a/5;cn=[];for(let e=0;e<Ul[on].length;e++)cn.push(Ul[on][e].logit);let k=d3.scaleLinear().domain(d3.extent(cn)).range([.2,1]);f.append("circle").attr("class","logit-circle").attr("id","logit-circle-"+n).attr("cx",w).attr("cy",Jl[t-1][n].y+Gl/2).attr("r",8).style("fill",Ol.logit(k(cn[n]))).style("cursor","crosshair").style("pointer-events","all").style("stroke",Bl).on("mouseover",()=>gn(n)).on("mouseleave",()=>hn(n)).on("click",()=>{d3.event.stopPropagation()});let $=Wl.select(".intermediate-layer-annotation").select(".softmax-detail-annoataion");$.select("#logit-text-"+n).style("opacity",1),v.raise(),f.append("line").attr("class","logit-output-edge-"+n).attr("x1",i-a+2*Pl).attr("x2",u).attr("y1",Jl[t-1][n].y+Gl/2).attr("y2",Jl[t-1][n].y+Gl/2).style("fill","none").style("stroke","#EAEAEA").style("stroke-width","1.2").lower();let L=[],I=Ul.flatten.length/Ul[1].length,A=[...Array(Ul[on].length).keys()].filter(e=>e!=n),N=0,M=d3.linkHorizontal().x(e=>e.x).y(e=>e.y);const C=()=>{if(!an)return void Wl.select(".underneath").selectAll(".logit-lower").remove();let e=A[N],l=Wl.select(".underneath").select("#logit-lower-"+e);if(l.empty()){l=Wl.select(".underneath").append("g").attr("class","logit-lower").attr("id","logit-lower-"+e).style("opacity",0);for(let l=0;l<I;l+=3){[0,9].forEach(n=>{let u=l+n*I;L.push({source:{x:s+r+3-a,y:0===n?d+l*o:c+l*o},target:{x:i-a,y:Jl[t][e].y+Gl/2},index:u,weight:Ul.flatten[u].outputLinks[e].weight,color:"#F1F1F1",width:.5,opacity:1,class:"softmax-edge-"+e})})}for(let l=0;l<Ul[on].length-2;l++)L.push({source:{x:s+r+3-a,y:d+I*o+p*(l+1)+g*(l+.5)},target:{x:i-a,y:Jl[t][e].y+Gl/2},index:-1,color:"#EDEDED",width:.5,opacity:1,class:"softmax-abstract-edge-"+e});l.selectAll("path.softmax-edge-"+e).data(L).enter().append("path").attr("class",e=>e.class).attr("id",e=>"edge-"+e.name).attr("d",e=>M({source:e.source,target:e.target})).style("fill","none").style("stroke-width",e=>e.width).style("stroke",e=>void 0===e.color?Bl:e.color).style("opacity",e=>e.opacity).style("pointer-events","none")}let x=f.append("g").attr("class","logit-layer-"+e).style("opacity",0),v=h.clone(!0).style("opacity",0);v.attr("class","plus-symbol-clone").attr("id","plus-symbol-clone-"+e).select("circle").datum({fill:ba(Ol.weight,m,Ul[on][e].bias,.35)}).style("pointer-events","none").style("fill","#E5E5E5"),v.attr("transform",`translate(${y},\n      ${Jl[t][e].y+Gl/2})`);let E=M({source:{x:i-a+2*Pl,y:Jl[t][e].y+Gl/2},target:{x:w+8,y:Jl[t][e].y+Gl/2}}),R=M({source:{x:w+8,y:Jl[t][e].y+Gl/2},target:{x:u,y:Jl[t][n].y+Gl/2}}),S=b.append("path").attr("class","logit-output-edge-"+e).attr("d",E).style("fill","none").style("stroke","#EAEAEA").style("stroke-width","1.2"),T=b.append("path").attr("class","logit-output-edge-"+e).attr("d",R).style("fill","none").style("stroke","#EAEAEA").style("stroke-width","1.2"),_=S.node().getTotalLength(),H=T.node().getTotalLength(),z=_+H,F=dn?500:800,O=dn?400:600;S.attr("stroke-dasharray",_+" "+_).attr("stroke-dashoffset",_),T.attr("stroke-dasharray",H+" "+H).attr("stroke-dashoffset",H),S.transition("softmax-output-edge").duration(_/z*F).attr("stroke-dashoffset",0),T.transition("softmax-output-edge").delay(_/z*F).duration(H/z*F).attr("stroke-dashoffset",0),x.append("circle").attr("class","logit-circle").attr("id","logit-circle-"+e).attr("cx",w).attr("cy",Jl[t-1][e].y+Gl/2).attr("r",7).style("fill",Ol.logit(k(cn[e]))).style("stroke",Bl).style("cursor","crosshair").on("mouseover",()=>gn(e)).on("mouseleave",()=>hn(e)).on("click",()=>{d3.event.stopPropagation()}),ln.startAnimation={i:e,duration:O,hasInitialized:!1},ge.set(ln),x.transition("softmax-edge").duration(O).style("opacity",1),(n<3&&9==e||n>=3&&0==e)&&$.select(".softmax-detail-hover-annotation").transition("softmax-edge").duration(O).style("opacity",1),$.select("#logit-text-"+e).transition("softmax-edge").duration(O).style("opacity",1),l.transition("softmax-edge").duration(O).style("opacity",1).on("end",()=>{N++,N<A.length?(L=[],C()):(dn=!0,ln.hasInitialized=!0,ge.set(ln))}),v.transition("softmax-edge").duration(O).style("opacity",.2)};let E=Wl.select(".intermediate-layer").select(".layer-label").node(),R=((e,t)=>{if(void 0!==e){let a=t;for(;null==a.getScreenCTM&&null!=a.parentNode;)a=a.parentNode;let l=e.node().ownerSVGElement.createSVGPoint(),n=a.getScreenCTM(),s=a.getBBox().height;l.x+=0,l.y-=s/2;let i=l.matrixTransform(n);return{top:i.y,left:i.x}}})(Wl,E),S=100+ +d3.select("#cnn-svg").style("height").replace("px","")/2-96;const T=document.getElementById("detailview");T.style.top=S+"px",T.style.left=R.left-490-50+"px",T.style.position="absolute",ge.set({show:!0,logits:cn,logitColors:cn.map(e=>Ol.logit(k(e))),selectedI:n,highlightI:-1,outputName:jl[n],outputValue:Ul[on][n].output,startAnimation:{i:-1,duration:0,hasInitialized:dn}}),C(),el({legendHeight:5,curLayerIndex:t,range:d3.extent(cn)[1]-d3.extent(cn)[0],minMax:{min:d3.extent(cn)[0],max:d3.extent(cn)[1]},group:f,width:u-(i+2*Pl-a+5),gradientAppendingName:"flatten-logit-gradient",gradientGap:.1,colorScale:Ol.logit,x:i+2*Pl-a+5,y:ql.top+10*Yl+Yl+10*Gl}),f.append("g").attr("class","layer-label").classed("hidden",sn).attr("transform",()=>`translate(${w}, ${(ql.top+Yl)/2+5})`).append("text").style("text-anchor","middle").style("dominant-baseline","middle").style("opacity",.8).style("font-weight",800).text("logit")})({curLayerIndex:t,moveX:a,softmaxLeftMid:r,selectedI:o,intermediateX1:d,intermediateX2:c,pixelWidth:u,pixelHeight:p,topY:g,bottomY:h,middleGap:y,middleRectHeight:m,softmaxX:f,symbolGroup:b,symbolX:l,flattenRange:w})}if(tn)I.select(".symbol-output-line").remove();else{I.select(".edge-group").append("line").attr("class","symbol-output-line").attr("x1",l).attr("y1",n).attr("x2",s+a).attr("y2",i).style("stroke-width",1.2).style("stroke","#E5E5E5").style("opacity",0).transition("softmax").delay(200).duration(400).style("opacity",1)}tn=!tn,pe.set(tn)})},xn=(e,t,a,l,n)=>{Wl.selectAll(".output-legend").classed("hidden",!1);let s=Gl/2,i=2*Gl+5.5*Kl*Xl+s,r=Jl[e][0].x-i,o=Kl*Xl*4/2;let d=d3.linkHorizontal().x(e=>e.x).y(e=>e.y);Wl.select("g.edge-group").style("visibility","hidden"),Qa({layerIndex:e-1,targetX:r,disable:!0,delay:0}),Qa({layerIndex:e,targetX:Jl[e][0].x,disable:!0,delay:0,opacity:.15,specialIndex:a});let c=(r-Kl-Jl[0][0].x-10*Gl)/10;if(c>20)for(let t=0;t<e-1;t++){let e=Jl[0][0].x+t*(Gl+c);Qa({layerIndex:t,targetX:e,disable:!0,delay:0})}else{c=20;let t=r-2*c-Gl;for(let a=e-2;a>=0;a--)Qa({layerIndex:a,targetX:t,disable:!0,delay:0}),t=t-c-Gl}Za("overlay-gradient-left",[{offset:"0%",color:"rgb(250, 250, 250)",opacity:1},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.95},{offset:"100%",color:"rgb(250, 250, 250)",opacity:.85}]);let u=Wl.append("g").attr("class","intermediate-layer-overlay");u.append("rect").attr("class","overlay").style("fill","url(#overlay-gradient-left)").style("stroke","none").attr("width",r+ql.left-2*c+3).attr("height",n+ql.top+ql.bottom).attr("x",-ql.left).attr("y",0).style("opacity",0),u.selectAll("rect.overlay").transition("move").duration(800).ease(d3.easeCubicInOut).style("opacity",1);let p=Wl.append("g").attr("class","intermediate-layer").style("opacity",0),g=r+Gl+o,h=g+o+s,y=Zl[Ql][e-1],m=Ol.conv,f=Ul.flatten.length/Ul[1].length,x=[],v=p.append("g").attr("class","flatten-layer").append("g").attr("class","flatten-layer-left"),b=Jl[e-1][0].y,w=Jl[e-1][9].y+Gl-1.1*f,k=Ul[e-1][0].output.length,$=Gl/(2*k),L=Gl/k,I=d3.extent(Ul.flatten.slice(f).map(e=>e.outputLinks[a].weight).concat(Ul.flatten.slice(9*f,10*f).map(e=>e.outputLinks[a].weight))),A=Math.round(1e3*Math.max(...I.map(Math.abs)))/1e3*2,N=e=>{let t=e.index;nn=void 0===e.weight?{show:!0,text:"Pixel value: "+Dl(un[t])}:{show:!0,text:"Weight: "+Dl(e.weight)},ye.set(nn),v.select("#edge-flatten-"+t).raise().style("stroke",Bl).style("stroke-width",1),v.select(`#edge-flatten-${t}-output`).raise().style("stroke-width",1).style("stroke",e=>ba(Ol.weight,A,e.weight,.1)),v.select("#bounding-"+t).raise().style("opacity",1)},M=e=>{let t=e.index;nn=void 0===e.weight?{show:!1,text:"Pixel value: "+Dl(un[t])}:{show:!1,text:"Weight: "+Dl(e.weight)},ye.set(nn),v.select("#edge-flatten-"+t).style("stroke-width",.6).style("stroke","#E5E5E5"),v.select(`#edge-flatten-${t}-output`).style("stroke-width",.6).style("stroke",e=>ba(Ol.weight,A,e.weight,.35)),v.select("#bounding-"+t).raise().style("opacity",0)};un={};for(let t=0;t<f;t++){[0,9].forEach(l=>{let n=t+l*f;un[n]=Ul.flatten[n].output,v.append("rect").attr("x",g).attr("y",0===l?b+1.1*t:w+1.1*t).attr("width",s).attr("height",1.1).style("cursor","crosshair").style("fill",m((Ul.flatten[n].output+y/2)/y)).on("mouseover",()=>N({index:n})).on("mouseleave",()=>M({index:n})).on("click",()=>{d3.event.stopPropagation()}),x.push({source:{x:g+s+3,y:0===l?b+1.1*t:w+1.1*t},target:{x:h,y:Jl[e][a].y+Gl/2},index:n,weight:Ul.flatten[n].outputLinks[a].weight,name:`flatten-${n}-output`,color:ba(Ol.weight,A,Ul.flatten[n].outputLinks[a].weight,.35),width:.6,opacity:1,class:"flatten-output"});let i=Math.floor(t/k);x.push({target:{x:g-3,y:0===l?b+1.1*t:w+1.1*t},source:{x:r+Gl+3,y:Jl[e-1][l].y+(2*i+1)*$},index:n,name:"flatten-"+n,color:"#E5E5E5",width:.6,opacity:1,class:"flatten"});let o=Ul.flatten[n].inputLinks[0].weight;v.append("rect").attr("id","bounding-"+n).attr("class","flatten-bounding").attr("x",r+o[1]*L).attr("y",Jl[e-1][l].y+o[0]*L).attr("width",L).attr("height",L).style("fill","none").style("stroke",Bl).style("stroke-length","0.5").style("pointer-events","all").style("cursor","crosshair").style("opacity",0).on("mouseover",()=>N({index:n})).on("mouseleave",()=>M({index:n})).on("click",()=>{d3.event.stopPropagation()})})}let C=[];for(let t=1;t<Ul[e-1].length-1;t++)C.push({index:t});let E=(10*Gl+9*Yl-1.1*f*2-45)/8;C.forEach((t,l)=>{v.append("rect").attr("x",g+s/4).attr("y",b+1.1*f+5*(l+1)+E*l).attr("width",s/2).attr("height",E).style("fill","#E5E5E5"),v.append("polyline").attr("points",`${r+Gl+3}\n        ${Jl[e-1][t.index].y},\n        ${r+Gl+10}\n        ${Jl[e-1][t.index].y+Gl/2},\n        ${r+Gl+3}\n        ${Jl[e-1][t.index].y+Gl}`).style("fill","#E5E5E5").style("opacity",1),x.push({source:{x:r+Gl+10,y:Jl[e-1][t.index].y+Gl/2},target:{x:g-3,y:b+1.1*f+5*(l+1)+E*(l+.5)},index:-1,width:1,opacity:1,name:"flatten-abstract-"+t.index,color:"#E5E5E5",class:"flatten-abstract"}),x.push({source:{x:g+s+3,y:b+1.1*f+5*(l+1)+E*(l+.5)},target:{x:h,y:Jl[e][a].y+Gl/2},index:-1,name:`flatten-abstract-${t.index}-output`,color:"#E5E5E5",weight:t.weight,width:1,opacity:1,class:"flatten-abstract-output"})});let R=h+Pl,S=Jl[e][a].y+Gl/2,T=v.append("g").attr("class","plus-symbol").attr("transform",`translate(${R}, ${S})`);T.append("rect").attr("x",-Pl).attr("y",-Pl).attr("width",2*Pl).attr("height",2*Pl).attr("rx",3).attr("ry",3).style("fill","none").style("stroke",Bl),T.append("rect").attr("x",-(Pl-3)).attr("y",-.5).attr("width",2*(Pl-3)).attr("height",1).style("fill",Bl),T.append("rect").attr("x",-.5).attr("y",-(Pl-3)).attr("width",1).attr("height",2*(Pl-3)).style("fill",Bl),T.append("circle").attr("cx",0).attr("cy",-Gl/2-.5*Vl).attr("r",1.5*Vl).style("stroke",Bl).style("cursor","crosshair").style("fill",ba(Ol.weight,A,t.bias,.35)).on("mouseover",()=>{ye.set({show:!0,text:"Bias: "+Dl(t.bias)})}).on("mouseleave",()=>{ye.set({show:!1,text:"Bias: "+Dl(t.bias)})}).on("click",()=>{d3.event.stopPropagation()}),T.append("path").attr("d",d({source:{x:0,y:0},target:{x:0,y:-Gl/2-.5*Vl}})).attr("id","bias-plus").attr("stroke-width",1.2).attr("stroke","#E5E5E5").lower(),x.push({source:xa({x:h+2*Pl-Gl,y:Jl[e][a].y}),target:va({x:Jl[e][a].x-3,y:Jl[e][a].y}),name:"symbol-output",width:1.2,color:"#E5E5E5"});let _=(i-2*Gl-2*o-55)/2,H=h+2*Pl,z=_+H,F=_/2+H,O=Jl[e][a].y-2*Vl-6,G={curLayerIndex:e,moveX:2*(h-(g+s+3))/3,symbolX:R,symbolY:S,outputX:Jl[e][a].x,outputY:S,softmaxLeftMid:F,selectedI:a,intermediateX1:g,intermediateX2:h,pixelWidth:s,pixelHeight:1.1,topY:b,bottomY:w,middleGap:5,middleRectHeight:E,softmaxX:z,softmaxWidth:55,softmaxTextY:O,symbolGroup:T,flattenRange:A},P=p.append("g").attr("class","softmax-symbol").attr("transform",`translate(${z}, ${S})`).style("pointer-event","all").style("cursor","pointer").on("click",()=>fn(G));P.append("rect").attr("x",0).attr("y",-Pl).attr("width",55).attr("height",2*Pl).attr("stroke",Bl).attr("rx",2).attr("ry",2).attr("fill","#FAFAFA"),P.append("text").attr("x",5).attr("y",1).style("dominant-baseline","middle").style("font-size","12px").style("opacity",.5).text("softmax"),p.append("g").attr("class","layer-label").classed("hidden",sn).attr("transform",()=>`translate(${r+Gl+(4*Kl*Xl+s)/2}, ${(ql.top+Yl)/2+5})`).style("cursor","help").on("click",()=>{d3.event.stopPropagation(),document.querySelector("#article-flatten").scrollIntoView({behavior:"smooth"})}).append("text").style("dominant-baseline","middle").style("opacity",.8).style("font-weight",800).text("flatten");let B=Number(d3.select("#cnn-svg").style("height").replace("px",""))+150,V=new SmoothScroll('a[href*="#"]',{offset:-B}),q=p.append("g").attr("transform",()=>`translate(${r+Gl+(4*Kl*Xl+s)/2}, ${(ql.top+Yl)/2-5})`).attr("class","layer-detailed-label").classed("hidden",!sn).style("cursor","help").on("click",()=>{d3.event.stopPropagation();let e=document.querySelector("#article-flatten");V.animateScroll(e)});q.append("title").text("Move to article section");let X=q.append("text").style("text-anchor","middle").style("dominant-baseline","middle").style("opacity","0.7").style("font-weight",800).append("tspan").text("flatten"),j=Ul[rn].length*Ul[rn][0].output.length*Ul[rn][0].output[0].length;X.append("tspan").attr("x",0).attr("dy","1.5em").style("font-size","8px").style("font-weight","normal").text(`(${j})`);let D=v.append("g").attr("class","edge-group").lower();D.selectAll("path").data(x).enter().append("path").attr("class",e=>e.class).attr("id",e=>"edge-"+e.name).attr("d",e=>d({source:e.source,target:e.target})).style("fill","none").style("stroke-width",e=>e.width).style("stroke",e=>void 0===e.color?Bl:e.color).style("opacity",e=>e.opacity),D.selectAll("path.flatten-abstract-output").lower(),D.selectAll("path.flatten,path.flatten-output").style("cursor","crosshair").style("pointer-events","all").on("mouseover",N).on("mouseleave",M).on("click",()=>{d3.event.stopPropagation()}),el({legendHeight:5,curLayerIndex:e,range:y,minMax:en[10],group:p,width:o+Gl-3,x:r,y:ql.top+10*Yl+Yl+10*Gl}),el({legendHeight:5,curLayerIndex:e,range:A,minMax:{min:I[0],max:I[1]},group:p,width:o-3-5,gradientAppendingName:"flatten-weight-gradient",gradientGap:.1,colorScale:Ol.weight,x:r+o+Gl+s+3,y:ql.top+10*Yl+Yl+10*Gl});let W=Wl.append("g").attr("class","intermediate-layer-annotation").style("opacity",0),Y=W.append("g").attr("class","plus-annotation"),K=h,U=Jl[e][a].y+Gl+3*Vl,J=Jl[e][a].y+Gl+2*Vl,Q=Jl[e][a].y+Gl/2+Pl;9==a&&(U-=110,J-=70,Q-=18);let Z=Y.append("text").attr("x",K).attr("y",U).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor","middle");Z.append("tspan").style("dominant-baseline","hanging").text("Add up all products"),Z.append("tspan").attr("x",K).attr("dy","1em").style("dominant-baseline","hanging").text("("),Z.append("tspan").style("fill","#66a3c8").style("dominant-baseline","hanging").text("element"),Z.append("tspan").style("dominant-baseline","hanging").text(" × "),Z.append("tspan").style("dominant-baseline","hanging").style("fill","#b58946").text("weight"),Z.append("tspan").style("dominant-baseline","hanging").text(")"),Z.append("tspan").attr("x",K).attr("dy","1em").style("dominant-baseline","hanging").text("and then "),Z.append("tspan").style("dominant-baseline","hanging").style("fill","#479d94").text("bias"),tl({group:Y,sx:h-2*Pl-3,sy:J,tx:h-5,ty:Q,dr:30,hFlip:9===a,marker:"marker-alt"});let ee=Jl[e][a].y;ee-=2*Vl+4,v.append("text").attr("class","annotation-text").attr("x",h+Pl).attr("y",ee).style("text-anchor","middle").style("dominant-baseline","baseline").text("Bias");let te=W.append("g").attr("class","softmax-annotation");te.append("text").attr("x",z+27.5).attr("y",O).attr("class","annotation-text").style("dominant-baseline","baseline").style("text-anchor","middle").style("font-weight",700).text("Click ").append("tspan").attr("dx",1).style("font-weight",400).text("to learn more"),tl({group:te,sx:z+27.5-5,sy:O+4,tx:z+27.5,ty:S-Pl-4,dr:50,hFlip:!0});let ae=W.append("g").attr("class","flatten-annotation");K=r-80,U=Jl[e-1][0].y;let le=ae.append("text").attr("x",K).attr("y",U).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor","middle");le.append("tspan").style("dominant-baseline","hanging").style("font-weight",700).text("Hover over ").append("tspan").attr("dx",1).style("font-weight",400).style("dominant-baseline","hanging").text("matrix to"),le.append("tspan").style("dominant-baseline","hanging").attr("x",K).attr("dy","1em").text("see how it is flattened"),le.append("tspan").style("dominant-baseline","hanging").attr("x",K).attr("dy","1em").text("into a 1D array!"),tl({group:ae,sx:K+45,sy:U+.4*Gl+12,tx:r-10,ty:U+Gl/2,dr:80,hFlip:!0}),U=Jl[e-1][1].y;let ne=ae.append("text").attr("x",K).attr("y",U).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor","middle");ne.append("tspan").style("dominant-baseline","hanging").text("Same flattening"),ne.append("tspan").style("dominant-baseline","hanging").attr("x",K).attr("dy","1em").text("operation for"),ne.append("tspan").style("dominant-baseline","hanging").attr("x",K).attr("dy","1em").text("each neuron"),tl({group:ae,sx:K+39,sy:U+25,tx:r-10,ty:U+Gl/2-2,dr:80,hFlip:!0,marker:"marker-alt"}),W.append("g").attr("class","output-annotation").append("text").attr("x",Jl[on][a].x).attr("y",Jl[on][a].y+10).attr("class","annotation-text").text(`(${d3.format(".4f")(Ul[on][a].output)})`),Wl.selectAll("g.intermediate-layer, g.intermediate-layer-annotation").transition().delay(500).duration(500).ease(d3.easeCubicInOut).style("opacity",1)};function vn(e,t,a){const l=e.slice();return l[82]=t[a],l[84]=a,l}function bn(e){let t,a,l,s,d,u,p,h,f;return{c(){t=c("div"),a=c("img"),u=g(),a.src!==(l="/rnnExplainer/assets/img/"+e[82].file)&&m(a,"src",l),m(a,"alt","image option"),m(a,"title",s=e[82].class),m(a,"data-imagename",d=e[82].file),m(a,"class","svelte-1t9jxuh"),m(t,"class","image-container svelte-1t9jxuh"),m(t,"data-imagename",p=e[82].file),$(t,"inactive",e[7]!==e[82].file),$(t,"disabled",e[6])},m(l,s){r(l,t,s),i(t,a),i(t,u),h||(f=y(t,"click",(function(){n(e[6]?An:e[16])&&(e[6]?An:e[16]).apply(this,arguments)})),h=!0)},p(a,l){e=a,16512&l[0]&&$(t,"inactive",e[7]!==e[82].file),64&l[0]&&$(t,"disabled",e[6])},d(e){e&&o(t),h=!1,f()}}}function wn(e){let t,a;return t=new _t({props:{logits:e[3].logits,logitColors:e[3].logitColors,selectedI:e[3].selectedI,highlightI:e[3].highlightI,outputName:e[3].outputName,outputValue:e[3].outputValue,startAnimation:e[3].startAnimation}}),t.$on("xClicked",e[23]),t.$on("mouseOver",yn),t.$on("mouseLeave",mn),{c(){W(t.$$.fragment)},m(e,l){Y(t,e,l),a=!0},p(e,a){const l={};8&a[0]&&(l.logits=e[3].logits),8&a[0]&&(l.logitColors=e[3].logitColors),8&a[0]&&(l.selectedI=e[3].selectedI),8&a[0]&&(l.highlightI=e[3].highlightI),8&a[0]&&(l.outputName=e[3].outputName),8&a[0]&&(l.outputValue=e[3].outputValue),8&a[0]&&(l.startAnimation=e[3].startAnimation),t.$set(l)},i(e){a||(j(t.$$.fragment,e),a=!0)},o(e){D(t.$$.fragment,e),a=!1},d(e){K(t,e)}}}function kn(e){let t,a;return t=new Et({props:{input:e[8][0].input,kernelLength:2,dataRange:e[8].colorRange,isExited:e[10]}}),t.$on("message",e[21]),{c(){W(t.$$.fragment)},m(e,l){Y(t,e,l),a=!0},p(e,a){const l={};256&a[0]&&(l.input=e[8][0].input),256&a[0]&&(l.dataRange=e[8].colorRange),1024&a[0]&&(l.isExited=e[10]),t.$set(l)},i(e){a||(j(t.$$.fragment,e),a=!0)},o(e){D(t.$$.fragment,e),a=!1},d(e){K(t,e)}}}function $n(e){let t,a;return t=new bt({props:{input:e[8][0].input,output:e[8][0].output,dataRange:e[8].colorRange,isExited:e[10]}}),t.$on("message",e[22]),{c(){W(t.$$.fragment)},m(e,l){Y(t,e,l),a=!0},p(e,a){const l={};256&a[0]&&(l.input=e[8][0].input),256&a[0]&&(l.output=e[8][0].output),256&a[0]&&(l.dataRange=e[8].colorRange),1024&a[0]&&(l.isExited=e[10]),t.$set(l)},i(e){a||(j(t.$$.fragment,e),a=!0)},o(e){D(t.$$.fragment,e),a=!1},d(e){K(t,e)}}}function Ln(e){let t,a;return t=new pt({props:{input:e[8][e[9]].input,kernel:e[8][e[9]].kernel,dataRange:e[8].colorRange,colorScale:e[8].inputIsInputLayer?e[13].input[0]:e[13].conv,isInputInputLayer:e[8].inputIsInputLayer,isExited:e[11]}}),t.$on("message",e[20]),{c(){W(t.$$.fragment)},m(e,l){Y(t,e,l),a=!0},p(e,a){const l={};768&a[0]&&(l.input=e[8][e[9]].input),768&a[0]&&(l.kernel=e[8][e[9]].kernel),256&a[0]&&(l.dataRange=e[8].colorRange),256&a[0]&&(l.colorScale=e[8].inputIsInputLayer?e[13].input[0]:e[13].conv),256&a[0]&&(l.isInputInputLayer=e[8].inputIsInputLayer),2048&a[0]&&(l.isExited=e[11]),t.$set(l)},i(e){a||(j(t.$$.fragment,e),a=!0)},o(e){D(t.$$.fragment,e),a=!1},d(e){K(t,e)}}}function In(e){let t,a,s,u,h,f,v,k,L,I,A,N,M,C,E,R,S,T,_,H,F,O,G,P,B,V,U,J,Q,Z,ee,te,ae,le,ne,se,ie,re,oe,de,ce,ue,pe,ge,he=e[4].text+"",ye=e[14],me=[];for(let t=0;t<ye.length;t+=1)me[t]=bn(vn(e,ye,t));ne=new aa({});const fe=[Ln,$n,kn,wn],xe=[];function ve(e,t){return e[5].data&&"conv"===e[5].data.type&&-1!=e[9]?0:e[5].data&&"relu"===e[5].data.type?1:e[5].data&&"pool"===e[5].data.type?2:e[3].show?3:-1}return~(re=ve(e))&&(oe=xe[re]=fe[re](e)),ce=new Ft({}),ce.$on("xClicked",e[18]),ce.$on("urlTyped",e[19]),{c(){t=c("div"),a=c("div"),s=c("div");for(let e=0;e<me.length;e+=1)me[e].c();u=g(),h=c("div"),f=c("img"),k=g(),L=c("span"),L.innerHTML='<i class="fas fa-circle fa-stack-2x"></i> \n            <i class="fas fa-pen fa-stack-1x fa-inverse"></i>',A=g(),N=c("button"),M=c("span"),M.innerHTML='<i class="fas fa-crosshairs "></i>',C=g(),E=c("span"),R=p(he),S=g(),T=c("div"),_=c("button"),H=c("span"),H.innerHTML='<i class="fas fa-eye"></i>',F=g(),O=c("span"),O.textContent="Show detail",G=g(),P=c("div"),B=c("span"),B.innerHTML='<i class="fas fa-palette"></i>',V=g(),U=c("div"),J=c("select"),Q=c("option"),Q.textContent="Unit",Z=c("option"),Z.textContent="Module",ee=c("option"),ee.textContent="Global",te=g(),ae=c("div"),ae.innerHTML='<svg id="cnn-svg" class="svelte-1t9jxuh"></svg>',le=g(),W(ne.$$.fragment),se=g(),ie=c("div"),oe&&oe.c(),de=g(),W(ce.$$.fragment),m(f,"class","custom-image svelte-1t9jxuh"),f.src!==(v="/rnnExplainer/assets/img/plus.svg")&&m(f,"src","/rnnExplainer/assets/img/plus.svg"),m(f,"alt","plus button"),m(f,"title","Add new input image"),m(f,"data-imagename","custom"),m(L,"class","fa-stack edit-icon svelte-1t9jxuh"),$(L,"hidden",null===e[12]),m(h,"class","image-container svelte-1t9jxuh"),m(h,"data-imagename",I="custom"),$(h,"inactive","custom"!==e[7]),$(h,"disabled",e[6]),m(M,"class","icon"),b(M,"margin-right","5px"),m(E,"id","hover-label-text"),m(N,"class","button is-very-small is-link is-light svelte-1t9jxuh"),m(N,"id","hover-label"),b(N,"opacity",e[4].show?1:0),m(s,"class","left-control svelte-1t9jxuh"),m(H,"class","icon"),m(O,"id","hover-label-text"),m(_,"class","button is-very-small svelte-1t9jxuh"),m(_,"id","detailed-button"),_.disabled=e[6],$(_,"is-activated",e[2]),m(B,"class","icon is-left"),Q.__value="local",Q.value=Q.__value,Z.__value="module",Z.value=Z.__value,ee.__value="global",ee.value=ee.__value,m(J,"id","level-select"),J.disabled=e[6],m(J,"class","svelte-1t9jxuh"),void 0===e[1]&&z(()=>e[24].call(J)),m(U,"class","select svelte-1t9jxuh"),m(P,"class","control is-very-small has-icons-left svelte-1t9jxuh"),m(P,"title","Change color scale range"),m(T,"class","right-control svelte-1t9jxuh"),m(a,"class","control-container svelte-1t9jxuh"),m(ae,"class","cnn svelte-1t9jxuh"),m(t,"class","overview svelte-1t9jxuh"),m(ie,"id","detailview")},m(l,o){r(l,t,o),i(t,a),i(a,s);for(let e=0;e<me.length;e+=1)me[e].m(s,null);i(s,u),i(s,h),i(h,f),i(h,k),i(h,L),i(s,A),i(s,N),i(N,M),i(N,C),i(N,E),i(E,R),i(a,S),i(a,T),i(T,_),i(_,H),i(_,F),i(_,O),i(T,G),i(T,P),i(P,B),i(P,V),i(P,U),i(U,J),i(J,Q),i(J,Z),i(J,ee),w(J,e[1]),i(t,te),i(t,ae),e[25](t),r(l,le,o),Y(ne,l,o),r(l,se,o),r(l,ie,o),~re&&xe[re].m(ie,null),r(l,de,o),Y(ce,l,o),ue=!0,pe||(ge=[y(h,"click",(function(){n(e[6]?Nn:e[17])&&(e[6]?Nn:e[17]).apply(this,arguments)})),y(_,"click",e[15]),y(J,"change",e[24])],pe=!0)},p(t,a){if(e=t,82112&a[0]){let t;for(ye=e[14],t=0;t<ye.length;t+=1){const l=vn(e,ye,t);me[t]?me[t].p(l,a):(me[t]=bn(l),me[t].c(),me[t].m(s,u))}for(;t<me.length;t+=1)me[t].d(1);me.length=ye.length}4096&a[0]&&$(L,"hidden",null===e[12]),128&a[0]&&$(h,"inactive","custom"!==e[7]),64&a[0]&&$(h,"disabled",e[6]),(!ue||16&a[0])&&he!==(he=e[4].text+"")&&x(R,he),(!ue||16&a[0])&&b(N,"opacity",e[4].show?1:0),(!ue||64&a[0])&&(_.disabled=e[6]),4&a[0]&&$(_,"is-activated",e[2]),(!ue||64&a[0])&&(J.disabled=e[6]),2&a[0]&&w(J,e[1]);let l=re;re=ve(e),re===l?~re&&xe[re].p(e,a):(oe&&(q(),D(xe[l],1,1,()=>{xe[l]=null}),X()),~re?(oe=xe[re],oe||(oe=xe[re]=fe[re](e),oe.c()),j(oe,1),oe.m(ie,null)):oe=null)},i(e){ue||(j(ne.$$.fragment,e),j(oe),j(ce.$$.fragment,e),ue=!0)},o(e){D(ne.$$.fragment,e),D(oe),D(ce.$$.fragment,e),ue=!1},d(a){a&&o(t),d(me,a),e[25](null),a&&o(le),K(ne,a),a&&o(se),a&&o(ie),~re&&xe[re].d(),a&&o(de),K(ce,a),pe=!1,l(ge)}}}const An=()=>{},Nn=()=>{};function Mn(e,t,a){let l,n=new Set(["local","module","global"]),s="local";ie.set(s);let i=s,r=void 0,o=void 0;const d=ha.layerColorScales,c=ha.nodeLength,u=ha.numLayers,p=ha.edgeOpacity,g=ha.edgeInitColor,h=ha.edgeHoverColor,y=ha.edgeStrokeWidth,m=ha.svgPaddings,f=ha.overlayRectOffset;let x=[void 0,void 0];de.subscribe(e=>{x=e});let v=void 0;se.subscribe(e=>{v=e});let b=void 0;re.subscribe(e=>{b=e});let w=void 0;oe.subscribe(e=>{w=e});let $=void 0;ce.subscribe(e=>{a(2,$=e)}),ue.subscribe(e=>{}),le.subscribe(e=>{});let L=void 0;ne.subscribe(e=>{L=e});let I=void 0;pe.subscribe(e=>{I=e});let A=void 0;ge.subscribe(e=>{a(3,A=e)});let M=void 0;me.subscribe(e=>{M=e});let C=void 0;ye.subscribe(e=>{a(4,C=e)});let E=void 0;fe.subscribe(e=>{E=e});let S=void 0,T=void 0,_=void 0,H={layerName:"",index:-1,data:null},z=!1,F=!1,O=-1,G=-1,P=void 0,B=!1,V=void 0;const q={input:0,conv_1_1:1,relu_1_1:2,conv_1_2:3,relu_1_2:4,max_pool_1:5,conv_2_1:6,relu_2_1:7,conv_2_2:8,relu_2_2:9,max_pool_2:10,output:11},X={0:{local:"input-legend",module:"input-legend",global:"input-legend"},1:{local:"local-legend-0-1",module:"module-legend-0",global:"global-legend"},2:{local:"local-legend-0-1",module:"module-legend-0",global:"global-legend"},3:{local:"local-legend-0-2",module:"module-legend-0",global:"global-legend"},4:{local:"local-legend-0-2",module:"module-legend-0",global:"global-legend"},5:{local:"local-legend-0-2",module:"module-legend-0",global:"global-legend"},6:{local:"local-legend-1-1",module:"module-legend-1",global:"global-legend"},7:{local:"local-legend-1-1",module:"module-legend-1",global:"global-legend"},8:{local:"local-legend-1-2",module:"module-legend-1",global:"global-legend"},9:{local:"local-legend-1-2",module:"module-legend-1",global:"global-legend"},10:{local:"local-legend-1-2",module:"module-legend-1",global:"global-legend"},11:{local:"output-legend",module:"output-legend",global:"output-legend"}};let j,D=[{file:"boat_1.jpeg",class:"lifeboat"},{file:"bug_1.jpeg",class:"ladybug"},{file:"pizza_1.jpeg",class:"pizza"},{file:"pepper_1.jpeg",class:"bell pepper"},{file:"bus_1.jpeg",class:"bus"},{file:"koala_1.jpeg",class:"koala"},{file:"espresso_1.jpeg",class:"espresso"},{file:"panda_1.jpeg",class:"red panda"},{file:"orange_1.jpeg",class:"orange"},{file:"car_1.jpeg",class:"sport car"}],W=D[6].file,Y=-1,K=!0,U=!0,J=null;const Q=(e,t,a)=>{void 0===P&&o.select("rect#underneath-gateway-"+e.index).style("opacity",1)},Z=(e,t,a)=>{void 0===P&&o.select("rect#underneath-gateway-"+e.index).style("opacity",0)},ee=(e,t,l,n,i)=>{if(d3.event.stopPropagation(),a(11,U=!1),P===e.index)a(9,Y=-1),P=void 0,o.select("rect#underneath-gateway-"+e.index).style("opacity",0);else{a(9,Y=e.index);e.output,e.outputLinks[n].weight;let t=b[s][i-1],l=b[s][i],r=Math.max(t,l);void 0!==P&&(o.select("rect#underneath-gateway-"+P).style("opacity",0),o.select("rect#underneath-gateway-"+e.index).style("opacity",1));let d=d3.select("#cnn-svg"),c=+d.style("height").replace("px","")/2,u=+d.style("width").replace("px",""),p=100+c-125,g=E[Object.keys(q)[i]],h=0;i>6?(h=(g-m.left)/2,h=m.left+h-243):(h=(u+m.right-g)/2,h=g+h-243);const y=document.getElementById("detailview");y.style.top=p+"px",y.style.left=h+"px",y.style.position="absolute",P=e.index,a(8,j.colorRange=r,j),a(8,j.inputIsInputLayer=i<=1,j)}},xe=()=>{if(void 0!==P)a(9,Y=-1),o.select("rect#underneath-gateway-"+P).style("opacity",0),P=void 0;else if(I)o.select(".softmax-symbol").dispatch("click");else if(z){let e=q[H.layerName];$e(e,H.domG,H.domI),d3.select(H.domG[H.domI]).dispatch("mouseleave")}else F&&ve()},ve=()=>{F=!1,O=-1;let e=q[H.layerName],t=H.index;o.select(`g#layer-${e}-node-${t}`).select("rect.bounding").classed("hidden",!0),H.data.inputLinks.forEach(e=>{let t=q[e.source.layerName],a=e.source.index;o.select(`g#layer-${t}-node-${a}`).select("rect.bounding").classed("hidden",!0)}),o.select("g.underneath").selectAll("rect").remove();o.select("g.edge-group").selectAll(".edge").filter(e=>e.targetLayerIndex!==G).style("visibility",null);a(6,B=!1),o.selectAll(`.${s}-legend`).classed("hidden",!$),o.selectAll(".input-legend").classed("hidden",!$),o.selectAll(".output-legend").classed("hidden",!$),o.select("g.cnn-group").select("g.edge-group").selectAll(`path.edge-${e}-${t}`).transition().ease(d3.easeCubicOut).duration(200).style("stroke",g).style("stroke-width",y).style("opacity",p),o.selectAll("g.intermediate-layer-overlay, g.intermediate-layer-annotation").transition("remove").duration(500).ease(d3.easeCubicInOut).style("opacity",0).on("end",(e,t,a)=>{o.selectAll("g.intermediate-layer-overlay, g.intermediate-layer-annotation").remove(),o.selectAll("defs.overlay-gradient").remove(),o.select(".input-annotation").classed("hidden",!1)}),o.select("g#cnn-layer-group-"+e).selectAll("g.node-group").each((e,t,a)=>{d3.select(a[t]).style("pointer-events","all")}),o.select("g#cnn-layer-group-"+(e-1)).selectAll("g.node-group").each((e,t,a)=>{d3.select(a[t]).style("pointer-events","all").on("mouseover",Ie).on("mouseleave",Ae).on("click",Le)}),a(5,H.layerName="",H),a(5,H.index=-1,H),a(5,H.data=null,H),G=-1},be=(e,t,a)=>{let l=q[e.layerName],n=e.index;o.select("g.cnn-group").select("g.edge-group").selectAll(`path.edge-${G}-${n}`).raise().transition().ease(d3.easeCubicInOut).duration(400).style("stroke",h).style("stroke-width","1").style("opacity",1),d3.select(a[t]).select("rect.bounding").classed("hidden",!1);let s=l-1;l===G-1&&(s=l+1),o.select(`g#layer-${s}-node-${n}`).select("rect.bounding").classed("hidden",!1)},we=(e,t,a)=>{let l=q[e.layerName],n=e.index;o.select("g.cnn-group").select("g.edge-group").selectAll(`path.edge-${G}-${n}`).transition().ease(d3.easeCubicOut).duration(200).style("stroke",g).style("stroke-width",y).style("opacity",p),d3.select(a[t]).select("rect.bounding").classed("hidden",!0);let s=l-1;l===G-1&&(s=l+1),o.select(`g#layer-${s}-node-${n}`).select("rect.bounding").classed("hidden",!0)},ke=(e,t,a)=>{let l=q[e.layerName],n=e.index;o.select(`g#layer-${l+1}-node-${n}`).node().dispatchEvent(new Event("click"))},$e=(e,t,l)=>{I&&(o.select(".logit-layer").remove(),o.select(".logit-layer-lower").remove(),o.selectAll(".plus-symbol-clone").remove(),o.select(".underneath").selectAll(".logit-lower").style("opacity",0),ge.set({show:!1,logits:[]}),he.set(!1)),pe.set(!1),z=!1,o.selectAll(`.${s}-legend`).classed("hidden",!$),o.selectAll(".input-legend").classed("hidden",!$),o.selectAll(".output-legend").classed("hidden",!$),a(6,B=!1);for(let t=0;t<V[e-1].length;t++)o.select(`g#layer-${e-1}-node-${t}`).on("mouseover",Ie).on("mouseleave",Ae).on("click",Le);o.select("g.underneath").selectAll("rect").remove(),P=void 0,o.select("g#cnn-layer-group-"+(e-1)).selectAll("rect.bounding").style("stroke-width",1),d3.select(t[l]).select("rect.bounding").style("stroke-width",1),o.selectAll(`g#layer-label-${e-1},\n      g#layer-detailed-label-${e-1},\n      g#layer-label-${e},\n      g#layer-detailed-label-${e}`).style("font-weight","normal"),a(5,H.layerName="",H),a(5,H.index=-1,H),a(5,H.data=null,H),a(11,U=!0);let n=o.select("g.intermediate-layer");if(ue.set(!1),n.transition("remove").duration(500).ease(d3.easeCubicInOut).style("opacity",0).on("end",(e,t,a)=>{d3.select(a[t]).remove()}),o.selectAll(".overlay-group").remove(),o.selectAll("g.intermediate-layer-overlay, g.intermediate-layer-annotation").transition("remove").duration(500).ease(d3.easeCubicInOut).style("opacity",0).on("end",(e,t,a)=>{o.selectAll("g.intermediate-layer-overlay, g.intermediate-layer-annotation").remove(),o.selectAll("defs.overlay-gradient").remove()}),void 0!==x[0]){let e=b[s][x[0]];void 0!==x[1]?o.select(`g#layer-${x[0]}-node-${x[1]}`).select("image.node-image").each((t,a,l)=>Pa(t,a,l,e)):o.select("g#cnn-layer-group-"+x[0]).selectAll("image.node-image").each((t,a,l)=>Pa(t,a,l,e))}for(let e=0;e<u;e++)Qa({layerIndex:e,targetX:v[e][0].x,disable:!1,delay:500,opacity:1});Qa({layerIndex:u-2,targetX:v[u-2][0].x,opacity:1,disable:!1,delay:500,onEndFunc:()=>{o.select("g.edge-group").style("visibility","visible"),o.select(".input-annotation").classed("hidden",!1)}})},Le=(e,t,l)=>{d3.event.stopPropagation();let n=e.index;if(a(5,H.layerName=e.layerName,H),a(5,H.index=e.index,H),a(5,H.data=e,H),a(5,H.domI=t,H),a(5,H.domG=l,H),"conv"===e.type||"relu"===e.type||"pool"===e.type){let t=[];for(let a=0;a<e.inputLinks.length;a++)t.push({input:e.inputLinks[a].source.output,kernel:e.inputLinks[a].weight,output:e.inputLinks[a].dest.output});let l=q[e.layerName];t.colorRange=b[s][l],t.isInputInputLayer=l<=1,a(8,j=t)}let i=q[e.layerName];if("relu"==e.type||"pool"==e.type)if(a(10,K=!1),F)if(e.index===O)ve();else{o.select(`g#layer-${i}-node-${O}`).select("rect.bounding").classed("hidden",!0),o.select(`g#layer-${i-1}-node-${O}`).select("rect.bounding").classed("hidden",!0);let e=o.select("g.cnn-group").select("g.edge-group");e.selectAll(`path.edge-${i}-${O}`).transition().ease(d3.easeCubicOut).duration(200).style("stroke",g).style("stroke-width",y).style("opacity",p);let t=o.select("g.underneath");t.select("#underneath-gateway-"+O).style("opacity",0),o.select(`g#layer-${i}-node-${n}`).select("rect.bounding").classed("hidden",!1),o.select(`g#layer-${i-1}-node-${n}`).select("rect.bounding").classed("hidden",!1),e.selectAll(`path.edge-${i}-${n}`).raise().transition().ease(d3.easeCubicInOut).duration(400).style("stroke",h).style("stroke-width","1").style("opacity",1),t.select("#underneath-gateway-"+n).style("opacity",1),O=n}else((e,t)=>{F=!0,O=t,G=e;let l=d3.select("#cnn-svg"),n=+l.style("height").replace("px","")/2,i=+l.style("width").replace("px",""),r=100+n-130,d=0;e>5?(d=v[e-1][0].x+50,d=d/2-250):(d=(i-v[e][0].x-c)/2,d=v[e][0].x+c+d-250);const u=document.getElementById("detailview");u.style.top=r+"px",u.style.left=d+"px",u.style.position="absolute";o.select("g.edge-group").selectAll(".edge").filter(t=>t.targetLayerIndex!==e).style("visibility","hidden");a(6,B=!0),o.select(".input-annotation").classed("hidden",!0),o.selectAll(`.${s}-legend`).classed("hidden",!0),o.selectAll(".input-legend").classed("hidden",!0),o.selectAll(".output-legend").classed("hidden",!0),o.select("#"+X[e][s]).classed("hidden",!1);let p=v[e-1][t].x,g=v[e][t].x+c+5,h=S-g-f/2,y=p-v[0][0].x;if(h>y){let e=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.9},{offset:"100%",color:"rgb(250, 250, 250)",opacity:1}];Za("overlay-gradient-right",e),e=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85+y/h*(.95-.85)},{offset:"100%",color:"rgb(250, 250, 250)",opacity:.85}],Za("overlay-gradient-left",e)}else{let e=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:1},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.9},{offset:"100%",color:"rgb(250, 250, 250)",opacity:.85}];Za("overlay-gradient-left",e),e=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85},{offset:"100%",color:"rgb(250, 250, 250)",opacity:.85+h/y*(.95-.85)}],Za("overlay-gradient-right",e)}Sl("overlay-gradient-right",g+f/2+.5,0,h,T+m.top),Sl("overlay-gradient-left",v[0][0].x-f/2,0,y,T+m.top),o.selectAll("rect.overlay").on("click",xe);let x=o.select("g.underneath");for(let t=0;t<V[e-1].length;t++)x.append("rect").attr("class","underneath-gateway").attr("id","underneath-gateway-"+t).attr("x",v[e-1][t].x-7).attr("y",v[e-1][t].y-7).attr("width",2*c+L+14).attr("height",c+14).attr("rx",10).style("fill","rgba(160, 160, 160, 0.3)").style("opacity",0),o.select(`g#layer-${e-1}-node-${t}`).style("pointer-events","all").style("cursor","pointer").on("mouseover",be).on("mouseleave",we).on("click",ke);x.lower(),x.select("#underneath-gateway-"+t).style("opacity",1)})(i,e.index);"conv"!==e.type&&"output"!==e.layerName||z?"conv"!==e.type&&"output"!==e.layerName||!z||$e(i,l,t):(((e,t,l,n)=>{z=!0,o.selectAll(`.${s}-legend`).classed("hidden",!0),o.selectAll(".input-legend").classed("hidden",!0),o.selectAll(".output-legend").classed("hidden",!0),o.select(".input-annotation").classed("hidden",!0),o.select("g#cnn-layer-group-"+(n-1)).selectAll("rect.bounding").style("stroke-width",2),d3.select(t[l]).select("rect.bounding").style("stroke-width",2),a(6,B=!0),ue.set(!0),o.selectAll(`g#layer-label-${n-1},\n      g#layer-detailed-label-${n-1},\n      g#layer-label-${n},\n      g#layer-detailed-label-${n}`).style("font-weight","800"),d3.select("#cnn-svg").on("click",xe)})(0,l,n,i),"conv_1_1"===e.layerName?_l(i,e,n,S,T,Q,Z,ee):"conv_1_2"===e.layerName?Hl(i,e,n,S,T,Q,Z,ee):"conv_2_1"===e.layerName?zl(i,e,n,S,T,Q,Z,ee):"conv_2_2"===e.layerName?Fl(i,e,n,S,T,Q,Z,ee):"output"===e.layerName&&xn(i,e,n,0,T))},Ie=(e,t,a)=>{if(z)return;let l=q[e.layerName],n=e.index;if(o.select("g.cnn-group").select("g.edge-group").selectAll(`path.edge-${l}-${n}`).raise().transition().ease(d3.easeCubicInOut).duration(400).style("stroke",h).style("stroke-width","1").style("opacity",1),d3.select(a[t]).select("rect.bounding").classed("hidden",!1),1===e.inputLinks.length){let t=e.inputLinks[0],a=q[t.source.layerName],l=t.source.index;o.select(`g#layer-${a}-node-${l}`).select("rect.bounding").classed("hidden",!1)}else o.select("g#cnn-layer-group-"+(l-1)).selectAll("g.node-group").selectAll("rect.bounding").classed("hidden",!1);"output"===e.layerName&&d3.select(a[t]).select(".output-text").style("opacity",.8).style("text-decoration","underline")},Ae=(e,t,a)=>{if(!z&&(F||e.layerName!==H.layerName||e.index!==H.index)){let l=q[e.layerName],n=e.index;if(o.select("g.cnn-group").select("g.edge-group").selectAll(`path.edge-${l}-${n}`).transition().ease(d3.easeCubicOut).duration(200).style("stroke",g).style("stroke-width",y).style("opacity",p),d3.select(a[t]).select("rect.bounding").classed("hidden",!0),1===e.inputLinks.length){let t=e.inputLinks[0],a=q[t.source.layerName],l=t.source.index;o.select(`g#layer-${a}-node-${l}`).select("rect.bounding").classed("hidden",!0)}else o.select("g#cnn-layer-group-"+(l-1)).selectAll("g.node-group").selectAll("rect.bounding").classed("hidden",e=>e.layerName!==H.layerName||e.index!==H.index);"output"===e.layerName&&d3.select(a[t]).select(".output-text").style("fill","black").style("opacity",.5).style("text-decoration","none")}};N(async()=>{r=d3.select(l).select("#cnn-svg"),o=r.append("g").attr("class","main-svg").attr("transform",`translate(${m.left}, 0)`),ae.set(o),S=Number(r.style("width").replace("px",""))-m.left-m.right,T=Number(r.style("height").replace("px",""))-m.top-m.bottom;let e=o.append("g").attr("class","cnn-group");o.append("g").attr("class","underneath"),r.style("height").replace("px","");var t;o.append("defs").append("marker").attr("id","marker").attr("viewBox","0 -5 10 10").attr("refX",6).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").style("stroke-width",1.2).style("fill","gray").style("stroke","gray").attr("d","M0,-5L10,0L0,5"),o.append("defs").append("marker").attr("id","marker-alt").attr("viewBox","0 -5 10 10").attr("refX",6).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").style("fill","none").style("stroke","gray").style("stroke-width",2).attr("d","M-5,-10L10,0L-5,10"),console.time("Construct cnn"),_=await(t="/rnnExplainer/assets/data/model.json",tf.loadLayersModel(t)),console.log("The cnn model is: ",_),V=await ua("/rnnExplainer/assets/img/"+W,_),console.timeEnd("Construct cnn"),te.set(V);let a=V[V.length-2];V.splice(V.length-2,1),V.flatten=a,console.log("cnn layers are: ",V),ja(),console.log("cnn layer ranges and MinMax are: ",b,w),qa(S,T,e,Ie,Ae,Le)});const Ne=async e=>{a(12,J=e.detail.url),V=await ua(J,_);let t=V[V.length-2];V.splice(V.length-2,1),V.flatten=t,te.set(V),((e,t)=>{let a=e.width,l=t[0].output.length,n=document.createElement("canvas"),s=n.getContext("2d");n.width=l,n.height=l;let i=s.getImageData(0,0,l,l),r=i.data;for(let e=0;e<r.length;e+=4){let a=Math.floor(e/4),n=Math.floor(a/l),s=a%l,i=t[0].output[n][s],o=t[1].output[n][s],d=t[2].output[n][s];r[e]=255*i,r[e+1]=255*o,r[e+2]=255*d,r[e+3]=255}let o=document.createElement("canvas");o.width=3*a,o.height=3*a;let d=o.getContext("2d");s.putImageData(i,0,0),d.drawImage(n,0,0,l,l,0,0,3*a,3*a);let c=o.toDataURL();e.src=c,n.remove(),o.remove()})(d3.select(l).select(".custom-image").node(),V[0]),ja(),Xa()};return e.$$.update=()=>{2&e.$$.dirty[0]&&(()=>{if(void 0!==o){if(n.add(s)||console.error("Encounter unknown scale level!"),s!=i){({local:{module:[1,2,8,9,10],global:[1,2,3,4,5,8,9,10]},module:{local:[1,2,8,9,10],global:[1,2,3,4,5,8,9,10]},global:{local:[1,2,3,4,5,8,9,10],module:[1,2,3,4,5]}})[i][s].forEach(e=>{let t=b[s][e];o.select("#cnn-layer-group-"+e).selectAll(".node-image").each((e,a,l)=>Pa(e,a,l,t))}),o.selectAll(`.${i}-legend`).classed("hidden",!0),o.selectAll(`.${s}-legend`).classed("hidden",!$)}i=s,ie.set(s)}})()},[l,s,$,A,C,H,B,W,j,Y,K,U,J,d,D,()=>{a(2,$=!$),ce.set($),z||(o.selectAll(`.${s}-legend`).classed("hidden",!$),o.selectAll(".input-legend").classed("hidden",!$),o.selectAll(".output-legend").classed("hidden",!$)),o.selectAll(".layer-detailed-label").classed("hidden",!$),o.selectAll(".layer-label").classed("hidden",$)},async e=>{let t=d3.select(e.target).attr("data-imageName");if(t!==W){a(7,W=t),V=await ua("/rnnExplainer/assets/img/"+W,_);let e=V[V.length-2];V.splice(V.length-2,1),V.flatten=e,te.set(V),ja(),Xa()}},()=>{if(null===J)M.show=!0,M.preImage=W,me.set(M);else if("custom"!==W){Ne({detail:{url:J}})}else M.show=!0,M.preImage=W,me.set(M);"custom"!==W&&a(7,W="custom")},e=>{a(7,W=e.detail.preImage)},Ne,function(e){e.detail.text&&(P=void 0,o.select("rect#underneath-gateway-"+Y).style("opacity",0),a(9,Y=-1))},function(e){e.detail.text&&(ve(),a(10,K=!0))},function(e){e.detail.text&&(ve(),a(10,K=!0))},function(e){a(3,A.show=!1,A),ge.set(A)},function(){s=k(this),a(1,s)},function(e){R[e?"unshift":"push"](()=>{l=e,a(0,l)})}]}class Cn extends Q{constructor(e){super(),J(this,e,Mn,In,s,{},[-1,-1,-1])}}const En=(e,t=0)=>[...Array(e).keys()].map(e=>e+t);function Rn(e,t,a){const l=e.slice();return l[3]=t[a],l}function Sn(t){let a;return{c(){a=c("div"),m(a,"class","circle svelte-195boue"),b(a,"animation-delay",1===t[3]?"0s":2===t[3]?"0.33333s":3===t[3]?"0.66666s":"0s")},m(e,t){r(e,a,t)},p:e,d(e){e&&o(a)}}}function Tn(t){let a,l=En(3,1),n=[];for(let e=0;e<l.length;e+=1)n[e]=Sn(Rn(t,l,e));return{c(){a=c("div");for(let e=0;e<n.length;e+=1)n[e].c();m(a,"class","wrapper svelte-195boue"),b(a,"--size",t[0]+t[2]),b(a,"--color",t[1])},m(e,t){r(e,a,t);for(let e=0;e<n.length;e+=1)n[e].m(a,null)},p(e,[t]){if(0&t){let s;for(l=En(3,1),s=0;s<l.length;s+=1){const i=Rn(e,l,s);n[s]?n[s].p(i,t):(n[s]=Sn(i),n[s].c(),n[s].m(a,null))}for(;s<n.length;s+=1)n[s].d(1);n.length=l.length}5&t&&b(a,"--size",e[0]+e[2]),2&t&&b(a,"--color",e[1])},i:e,o:e,d(e){e&&o(a),d(n,e)}}}function _n(e,t,a){let{size:l=60}=t,{color:n="#FF3E00"}=t,{unit:s="px"}=t;return e.$set=e=>{"size"in e&&a(0,l=e.size),"color"in e&&a(1,n=e.color),"unit"in e&&a(2,s=e.unit)},[l,n,s]}class Hn extends Q{constructor(e){super(),J(this,e,_n,Tn,s,{size:0,color:1,unit:2})}}function zn(t){let a,l,n,s,d,p,h,f,x,v;return{c(){a=c("div"),l=c("div"),n=c("div"),s=c("div"),s.innerHTML='<i class="fas control-icon fa-times-circle"></i>',d=g(),p=c("div"),p.textContent="Sigmoid Score",h=g(),f=u("svg"),m(s,"class","delete-button control-button svelte-1uac4ng"),m(s,"title","Close"),m(n,"class","buttons svelte-1uac4ng"),m(p,"class","title-text svelte-1uac4ng"),m(f,"id","sigmoid-svg"),m(f,"width","240"),m(f,"height","105"),m(f,"class","svelte-1uac4ng"),m(l,"class","box svelte-1uac4ng"),m(a,"class","container")},m(e,o){r(e,a,o),i(a,l),i(l,n),i(n,s),i(l,d),i(l,p),i(l,h),i(l,f),t[8](a),x||(v=y(s,"click",t[1]),x=!0)},p:e,i:e,o:e,d(e){e&&o(a),t[8](null),x=!1,v()}}}function Fn(e,t,a){let l,{logits:n}=t,{logitColors:s}=t,{selectedI:i}=t,{highlightI:r=-1}=t,{outputValue:o}=t,{startAnimation:d}=t,c=null;const u=C(),p=(e,t)=>void 0===t?d3.format(".2f")(e):d3.format(`.${t}f`)(e),g=(e,t,l,n)=>{a(2,r=n),u("mouseOver",{curI:n})},h=(e,t,l,n)=>{a(2,r=-1),u("mouseLeave",{curI:n})};return N(()=>{a(9,c=d3.select(l).select("#sigmoid-svg"));let e=c.append("g").attr("class","formula-right").attr("transform","translate(10, 0)").style("font-size","15px"),t=e.append("g").attr("class","denominator").attr("transform","translate(0, 58)");t.append("text").attr("x",0).attr("y",0).style("fill","gray").text("(");let r=8;n.forEach((e,a)=>{a/4>=1&&a%4==0&&(r=8);let l=t.append("text").attr("x",r).attr("y",20*Math.floor(a/4)).style("cursor","crosshair").style("pointer-events","all").on("mouseover",(e,t,l)=>g(0,0,0,a)).on("mouseleave",(e,t,l)=>h(0,0,0,a)).text("exp(");l.append("tspan").attr("class",`formula-term-${a} formula-term`).attr("dx","1").style("fill",s[a]).style("fill-opacity",a===i||d.hasInitialized?1:0).text(p(e)),l.append("tspan").attr("dx","1").text(")");let o=l.node().getBBox();r+=o.width+4,a!==n.length-1?(t.append("text").attr("x",r).attr("y",20*Math.floor(a/4)).text("+"),r+=14):t.append("text").attr("x",r-2).attr("y",20*Math.floor(a/4)).style("fill","gray").text("+ 1 )")}),t.selectAll("text").data(n).enter().append("text").attr("x",(e,t)=>40*t).attr("y",0).text(e=>p(e));let u=t.node().getBBox();e.append("line").attr("class","separation-line").attr("x1",-5).attr("x2",u.width+5).attr("y1",32).attr("y2",32).style("stroke-width",1.2).style("stroke","gray");e.append("g").attr("class","numerator-group").attr("transform","translate(0, 20)").append("text").attr("x",u.x+u.width/2).attr("y",0).on("mouseover",(e,t,a)=>g(0,0,0,i)).on("mouseleave",(e,t,a)=>h(0,0,0,i)).style("pointer-events","all").style("cursor","crosshair").style("text-anchor","middle").text(" 1 ");let y=c.append("g").attr("class","formula-left").attr("transform","translate(145, 32)");y.append("text").attr("x",20).attr("dominant-baseline","middle").text(""+p(o,4)).node().getBBox();y.append("text").attr("dominant-baseline","middle").attr("x",0).attr("y",0).style("fill","gray").style("font-weight","bold").text("=")}),e.$set=e=>{"logits"in e&&a(3,n=e.logits),"logitColors"in e&&a(4,s=e.logitColors),"selectedI"in e&&a(5,i=e.selectedI),"highlightI"in e&&a(2,r=e.highlightI),"outputValue"in e&&a(6,o=e.outputValue),"startAnimation"in e&&a(7,d=e.startAnimation)},e.$$.update=()=>{516&e.$$.dirty&&null!==c&&(c.selectAll(".formula-term").style("text-decoration","none").style("font-weight","normal"),c.selectAll(".formula-term-"+r).style("font-weight","bold").style("text-decoration","underline")),640&e.$$.dirty&&null!==c&&c.select(".formula-term-"+d.i).transition("sigmoid-edge").duration(d.duration).style("fill-opacity",1)},[l,()=>{u("xClicked",{})},r,n,s,i,o,d,function(e){R[e?"unshift":"push"](()=>{l=e,a(0,l)})}]}class On extends Q{constructor(e){super(),J(this,e,Fn,zn,s,{logits:3,logitColors:4,selectedI:5,highlightI:2,outputValue:6,startAnimation:7})}}function Gn(t){let a;return{c(){a=c("div"),a.innerHTML='<svg id="grid" width="100%" height="100%"></svg>',b(a,"display","inline-block"),b(a,"vertical-align","middle"),m(a,"class","grid")},m(e,l){r(e,a,l),t[10](a)},p:e,i:e,o:e,d(e){e&&o(a),t[10](null)}}}function Pn(e,t,a){let l,{data:n}=t,{highlights:s}=t,{isKernelMath:i}=t,{constraint:r}=t,{dataRange:o}=t,{outputLength:d}=t,{stride:c}=t,{colorScale:u=d3.interpolateRdBu}=t,{isInputLayer:p=!1}=t;const g=C();let h=s,y=n;const m=()=>{d3.select(l).selectAll("#grid > *").remove();const e=n.length*r+2,t=n[0].length*r+2;var a=d3.select(l).select("#grid").attr("width",t+"px").attr("height",e+"px").append("svg").attr("width",t+"px").attr("height",e+"px").selectAll(".row").data(n).enter().append("g").attr("class","row");a.selectAll(".square").data((function(e){return e})).enter().append("rect").attr("class","square").attr("x",(function(e){return 3*e.x})).attr("y",(function(e){return e.y})).attr("width",(function(e){return 3*e.width})).attr("height",(function(e){return 3*e.height})).style("opacity",.8).style("fill",(function(e){let t=e.text;return t=p?1-e.text:(e.text+o/2)/o,u(t)})).on("mouseover",(function(e){n.length!=d?g("message",{hoverH:Math.min(Math.floor(e.row/c),d-1),hoverW:Math.min(Math.floor(e.col/c),d-1)}):g("message",{hoverH:Math.min(Math.floor(e.row/1),d-1),hoverW:Math.min(Math.floor(e.col/1),d-1)})}));if(i)a.selectAll(".text").data((function(e){return e})).enter().append("text").attr("class","text").style("font-size",Math.floor(r/2.6)+"px").attr("x",(function(e){return e.x+e.width/2})).attr("y",(function(e){return e.y+e.height/2})).style("fill",(function(e){let t=e.text;return t=p?1-e.text:(e.text+o/2)/o,t<.2||t>.8?"white":"black"})).style("text-anchor","middle").style("dominant-baseline","middle").text((function(e){return e.text}))};return M(()=>{(n!=y&&(m(),y=n),s!=h)&&(d3.select(l).select("#grid").select("svg").selectAll(".square").style("stroke",e=>i||s.length&&s[e.row*n.length+e.col]?"black":null),h=s)}),N(()=>{m()}),e.$set=e=>{"data"in e&&a(1,n=e.data),"highlights"in e&&a(2,s=e.highlights),"isKernelMath"in e&&a(3,i=e.isKernelMath),"constraint"in e&&a(4,r=e.constraint),"dataRange"in e&&a(5,o=e.dataRange),"outputLength"in e&&a(6,d=e.outputLength),"stride"in e&&a(7,c=e.stride),"colorScale"in e&&a(8,u=e.colorScale),"isInputLayer"in e&&a(9,p=e.isInputLayer)},[l,n,s,i,r,o,d,c,u,p,function(e){R[e?"unshift":"push"](()=>{l=e,a(0,l)})}]}class Bn extends Q{constructor(e){super(),J(this,e,Pn,Gn,s,{data:1,highlights:2,isKernelMath:3,constraint:4,dataRange:5,outputLength:6,stride:7,colorScale:8,isInputLayer:9})}}function Vn(e){let t,a,l,n,s,d,u,h,y,f,v,b,w,k,$,L,I,A,N,M,C,E,R,S,T=e[0][0][0]+"",_=e[3]+1+"",H=e[1].length+"",z=e[1][0].length+"";return n=new Bn({props:{data:e[6],highlights:e[8],outputLength:e[1].length,isKernelMath:!0,constraint:Ye(e[0].length),dataRange:e[2],stride:1}}),n.$on("message",e[9]),w=new Bn({props:{data:e[4],highlights:e[5],isKernelMath:!0,constraint:20,dataRange:e[2]}}),R=new Bn({props:{data:e[7],highlights:e[5],isKernelMath:!1,outputLength:e[1][0].length,constraint:3*Ye(e[1][0].length),dataRange:e[2],stride:1}}),R.$on("message",e[9]),{c(){t=c("div"),a=c("div"),a.textContent="Token",l=g(),W(n.$$.fragment),s=g(),d=c("div"),u=c("span"),h=p("Vocab["),y=p(T),f=p("]["),v=p(_),b=p("]\n    =\n    "),W(w.$$.fragment),k=g(),$=c("div"),L=c("div"),I=p("Output ("),A=p(H),N=p(", "),M=p(z),C=p(")"),E=g(),W(R.$$.fragment),m(a,"class","header-text"),m(t,"class","column has-text-centered svelte-gz7a6i"),m(d,"class","column has-text-centered svelte-gz7a6i"),m(L,"class","header-text"),m($,"class","column has-text-centered svelte-gz7a6i")},m(e,o){r(e,t,o),i(t,a),i(t,l),Y(n,t,null),r(e,s,o),r(e,d,o),i(d,u),i(u,h),i(u,y),i(u,f),i(u,v),i(u,b),Y(w,u,null),r(e,k,o),r(e,$,o),i($,L),i(L,I),i(L,A),i(L,N),i(L,M),i(L,C),i($,E),Y(R,$,null),S=!0},p(e,[t]){const a={};64&t&&(a.data=e[6]),2&t&&(a.outputLength=e[1].length),1&t&&(a.constraint=Ye(e[0].length)),4&t&&(a.dataRange=e[2]),n.$set(a),(!S||1&t)&&T!==(T=e[0][0][0]+"")&&x(y,T),(!S||8&t)&&_!==(_=e[3]+1+"")&&x(v,_);const l={};16&t&&(l.data=e[4]),32&t&&(l.highlights=e[5]),4&t&&(l.dataRange=e[2]),w.$set(l),(!S||2&t)&&H!==(H=e[1].length+"")&&x(A,H),(!S||2&t)&&z!==(z=e[1][0].length+"")&&x(M,z);const s={};128&t&&(s.data=e[7]),32&t&&(s.highlights=e[5]),2&t&&(s.outputLength=e[1][0].length),2&t&&(s.constraint=3*Ye(e[1][0].length)),4&t&&(s.dataRange=e[2]),R.$set(s)},i(e){S||(j(n.$$.fragment,e),j(w.$$.fragment,e),j(R.$$.fragment,e),S=!0)},o(e){D(n.$$.fragment,e),D(w.$$.fragment,e),D(R.$$.fragment,e),S=!1},d(e){e&&o(t),K(n),e&&o(s),e&&o(d),K(w),e&&o(k),e&&o($),K(R)}}}function qn(e,t,a){let{image:l}=t,{output:n}=t,{isPaused:s}=t,{dataRange:i}=t;const r=C();let o,d,c,u=l.length+0,p=(Ue([[0]]),Ue([[0]])),g=Be(l.length*l[0].length,e=>!0),h=Be(n.length*n[0].length,e=>!0);function y(){c=0,d&&clearInterval(d),a(12,d=setInterval(()=>{if(s)return;const e=c%(n.length*n[0].length);a(5,h=Be(n.length*n[0].length,e=>!1));const t=Math.floor(e/n[0].length),l=e%n[0].length;a(3,o=t*n[0].length+l),a(5,h[o]=!0,h);const i=We(n,h);a(4,p=Ue(i)),c++},250))}y();let m=Ue(l),f=Ue(n,Ye(n[0].length));return e.$set=e=>{"image"in e&&a(0,l=e.image),"output"in e&&a(1,n=e.output),"isPaused"in e&&a(10,s=e.isPaused),"dataRange"in e&&a(2,i=e.dataRange)},e.$$.update=()=>{if(1&e.$$.dirty&&(u=l.length+0),3&e.$$.dirty){Be(l.length*l[0].length,e=>!0),Be(n.length*n[0].length,e=>!0)}3&e.$$.dirty&&(y(),a(6,m=Ue(l)),a(7,f=Ue(n,Ye(n[0].length))))},[l,n,i,o,p,h,m,f,g,function(e){a(5,h=Be(n.length*n[0].length,e=>!1));const t=e.detail.hoverH,l=e.detail.hoverW;a(3,o=t*n[0].length+l),a(5,h[o]=!0,h);const i=We(n,h);a(4,p=Ue(i)),a(10,s=!0),r("message",{text:s})},s]}class Xn extends Q{constructor(e){super(),J(this,e,qn,Vn,s,{image:0,output:1,isPaused:10,dataRange:2})}}function jn(e){let t,a,n,s,d,u,p,h,f,x,v,b,w,k,$,L=e[5]?'<i class="fas fa-play-circle play-icon"></i>':'<i class="fas fa-pause-circle"></i>';return b=new Xn({props:{image:e[0],kernel:e[1],output:e[2],isPaused:e[5],dataRange:e[3]}}),b.$on("message",e[7]),{c(){t=c("div"),a=c("div"),n=c("div"),s=c("div"),s.textContent="Word Embedding",d=g(),u=c("div"),p=c("div"),h=g(),f=c("div"),f.innerHTML='<i class="fas control-icon fa-times-circle"></i>',x=g(),v=c("div"),W(b.$$.fragment),m(s,"class","title-text svelte-1lq7956"),m(p,"class","play-button control-button svelte-1lq7956"),m(p,"title","Play animation"),m(f,"class","delete-button control-button svelte-1lq7956"),m(f,"title","Close"),m(u,"class","buttons svelte-1lq7956"),m(n,"class","control-pannel svelte-1lq7956"),m(v,"class","container is-centered is-vcentered svelte-1lq7956"),m(a,"class","box svelte-1lq7956"),m(t,"class","container svelte-1lq7956")},m(l,o){r(l,t,o),i(t,a),i(a,n),i(n,s),i(n,d),i(n,u),i(u,p),p.innerHTML=L,i(u,h),i(u,f),i(a,x),i(a,v),Y(b,v,null),w=!0,k||($=[y(p,"click",e[6]),y(f,"click",e[8])],k=!0)},p(e,t){(!w||32&t)&&L!==(L=e[5]?'<i class="fas fa-play-circle play-icon"></i>':'<i class="fas fa-pause-circle"></i>')&&(p.innerHTML=L);const a={};1&t&&(a.image=e[0]),2&t&&(a.kernel=e[1]),4&t&&(a.output=e[2]),32&t&&(a.isPaused=e[5]),8&t&&(a.dataRange=e[3]),b.$set(a)},i(e){w||(j(b.$$.fragment,e),w=!0)},o(e){D(b.$$.fragment,e),w=!1},d(e){e&&o(t),K(b),k=!1,l($)}}}function Dn(e){let t,a,l=!e[4]&&jn(e);return{c(){l&&l.c(),t=h()},m(e,n){l&&l.m(e,n),r(e,t,n),a=!0},p(e,[a]){e[4]?l&&(q(),D(l,1,1,()=>{l=null}),X()):l?(l.p(e,a),16&a&&j(l,1)):(l=jn(e),l.c(),j(l,1),l.m(t.parentNode,t))},i(e){a||(j(l),a=!0)},o(e){D(l),a=!1},d(e){l&&l.d(e),e&&o(t)}}}function Wn(e,t,a){let{input:l}=t,{kernel:n}=t,{output:s}=t,{dataRange:i}=t,{isExited:r}=t;const o=C();let d=!1;return e.$set=e=>{"input"in e&&a(0,l=e.input),"kernel"in e&&a(1,n=e.kernel),"output"in e&&a(2,s=e.output),"dataRange"in e&&a(3,i=e.dataRange),"isExited"in e&&a(4,r=e.isExited)},[l,n,s,i,r,d,function(){a(5,d=!d)},function(e){a(5,d=e.detail.text)},function(){o("message",{text:!0})}]}class Yn extends Q{constructor(e){super(),J(this,e,Wn,Dn,s,{input:0,kernel:1,output:2,dataRange:3,isExited:4})}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const Kn="input",Un="conv",Jn="pool",Qn="relu",Zn="fc",es="flatten",ts="embedding",as="lstm",ls="dense";class ns{async init(e){return this.urls=e,this.model=await rs(e.model),this.metadata=await this.loadMetadata(e.metadata),this}async loadMetadata(e){console.log("Loading metadata from "+e);try{const t=await fetch(e),a=await t.json();return console.log("Done loading metadata from "+e),this.indexFrom=a.index_from,this.maxLen=a.max_len,this.wordIndex=a.word_index,this.vocabularySize=a.vocabulary_size,console.log("indexFrom = ",this.indexFrom),console.log("maxLen = ",this.maxLen),console.log("vocabularySize = ",this.vocabularySize),a}catch(e){console.error(e),console.log("Loading metadata failed.")}}getInputTextTensor(){try{let e=this.inputArray.map(e=>{let t=this.wordIndex[e]+this.indexFrom;return(!t||t>this.vocabularySize)&&(t=2),t});return this.paddedSequence=function(e,t,a="pre",l="pre",n=0){return e.map(e=>{if(e.length>t)"pre"===l?e.splice(0,e.length-t):e.splice(t,e.length-t);else if(e.length<t){const l=[];for(let a=0;a<t-e.length;++a)l.push(n);e="pre"===a?l.concat(e):e.concat(l)}return e})}([e],this.maxLen),tf.tensor2d(this.paddedSequence,[1,this.maxLen])}catch(e){console.error(e),console.log("Get Input Text Tensor failed.")}}predictResult(e,t=this.model){console.log("-----------------predict directly and print the result-----------------");let a=ss(e);this.inputArray?this.inputArray!==a&&(this.inputArray=a):this.inputArray=a;let l=this.getInputTextTensor();this.inputTensor?this.inputTensor!==l&&(this.inputTensor=l):this.inputTensor=l;let n=performance.now(),s=t.predict(this.inputTensor),i=s.dataSync()[0];return s.dispose(),{score:i,elapsed:performance.now()-n,inputReviewArray:this.inputArray,inputReviewTensor:this.inputTensor}}async constructNN(e,t=this.model){console.log("-----------------predict layer by layer and generate NN structure-----------------");let a=await ss(e);this.inputArray?this.inputArray!==a&&(this.inputArray=a):this.inputArray=a;let l=await this.getInputTextTensor();this.inputTensor?this.inputTensor!==l&&(this.inputTensor=l):this.inputTensor=l,console.log(this.inputTensor);let n=this.inputTensor,s=[];for(let e=0;e<t.layers.length;e++){console.log("current layer name is: ",t.layers[e].name);let a=t.layers[e].apply(n),l=a.squeeze([0]);console.log(l.shape),s.push(l),n=a}return console.log("final rnn outputs is "),console.log(s),console.log("rnn result is "+s[2]),is(s,t,this.inputTensor)}}const ss=e=>e.trim().toLowerCase().replace(/(\.|\,|\!|\?|\\|\/|\-|\@|\#|\$|\%|\^|\&|\*|\(|\)|\+|\_|\=|\<|\>|\:|\;)/g," ").replace(/\s+/g," ").trim().split(" "),is=(e,t,a)=>{let l=[],n=[],s=[],i=[],r=[],o=t.layers[0].batchInputShape.slice(1),d=a.transpose([1,0]).arraySync();for(let e=0;e<o[0];e++){let t=new la("input",e,Kn,0,d[e]);n.push(t),0!==d[e][0]&&s.push(t)}l.push(n);let c=1;for(let a=0;a<t.layers.length;a++){let n=t.layers[a],s=null;s=e[a].shape.length>1?e[a].squeeze():e[a],s=s.arraySync();let o,d=[];switch(n.name.includes("conv")?o=Un:n.name.includes("pool")?o=Jn:n.name.includes("relu")?o=Qn:n.name.includes("output")?o=Zn:n.name.includes("flatten")?o=es:n.name.includes("embedding")?o=ts:n.name.includes("lstm")?o=as:n.name.includes("dense")?o=ls:console.log("Find unknown type"),o){case Un:{let e=n.bias.val.arraySync(),t=n.kernel.val.transpose([3,2,0,1]).arraySync();for(let a=0;a<s.length;a++){let i=new la(n.name,a,o,e[a],s[a]);for(let e=0;e<l[c-1].length;e++){let n=l[c-1][e],s=new na(n,i,t[a][e]);n.outputLinks.push(s),i.inputLinks.push(s)}d.push(i)}break}case Zn:{let e=n.bias.val.arraySync(),t=n.kernel.val.transpose([1,0]).arraySync();for(let a=0;a<s.length;a++){let i=new la(n.name,a,o,e[a],s[a]),r=0;for(let e=0;e<l[c-1].length;e++){let n=l[c-1][e],s=new na(n,i,t[a][e]);n.outputLinks.push(s),i.inputLinks.push(s),r+=n.output*t[a][e]}r+=e[a],i.logit=r,d.push(i)}l[c-1].sort((e,t)=>e.realIndex-t.realIndex);break}case Qn:case Jn:{let e=0,t=null;for(let a=0;a<s.length;a++){let i=new la(n.name,a,o,e,s[a]),r=l[c-1][a],u=new na(r,i,t);r.outputLinks.push(u),i.inputLinks.push(u),d.push(i)}break}case es:{let e=0;for(let t=0;t<s.length;t++){let a=l[c-1][0].output.length,i=l[c-1].length,r=t%i,u=Math.floor(Math.floor(t/i)/a),p=Math.floor(t/i)%a,g=r*(a*a)+u*a+p,h=new la(n.name,t,o,e,s[t]);h.realIndex=g;let y=new na(l[c-1][r],h,[u,p]);l[c-1][r].outputLinks.push(y),h.inputLinks.push(y),d.push(h)}d.sort((e,t)=>e.index-t.index);break}case ts:{let e=0,t=n.embeddings.val.arraySync();for(let a=0;a<s.length;a++){let i=new la(n.name,a,o,e,s[a]),r=l[c-1][a],u=new na(r,i,t[r.output]);r.outputLinks.push(u),i.inputLinks.push(u),d.push(i)}break}case as:{let e,t=0,a=n.cell.bias.val.arraySync(),u=n.cell.kernel.val.transpose([1,0]).arraySync(),p=(n.cell.recurrentKernel.val.transpose([1,0]).arraySync(),new la(n.name,0,o,t,s));for(let e=0;e<l[c-1].length;e++){let t=l[c-1][e],a=new na(t,p,u);p.inputLinks.push(a)}d.push(p);for(let e=0;e<s.length;e++){let t=new la(n.name,e,o,0,s[e]);i.push(t)}let g=new la(n.name,0,o,a,e),h=l[c-1][0],y=new na(h,g,u);g.inputLinks.push(y),r.push(g);for(let t=1;t<l[c-1].length;t++){g=new la(n.name,t,o,a,e),h=l[c-1][t];let s=r[t-1],i=new na(s,g,u);g.inputLinks.push(i),s.outputLinks.push(i),y=new na(h,g,u),g.inputLinks.push(y),r.push(g)}break}case ls:{let e=n.bias.val.arraySync(),t=n.kernel.val.transpose([1,0]).arraySync();for(let a=0;a<s.length;a++){let u=new la(n.name,a,o,e[a],s[a]),p=0;for(let e=0;e<l[c-1].length;e++){let n=l[c-1][e],s=new na(n,u,t[a]);n.outputLinks.push(s),u.inputLinks.push(s);for(let a=0;a<n.output.length;a++)p+=n.output[a]*t[e][a]}if(p+=e[a],u.logit=p,d.push(u),r&&r.length>0){let e=r[r.length-1],l=new na(e,u,t[a]);e.outputLinks.push(l)}for(let e=0;e<i.length;e++){let l=i[e],n=new na(l,u,t[a][e]);l.outputLinks.push(n)}}l[c-1].sort((e,t)=>e.realIndex-t.realIndex);break}default:console.error("Encounter unknown layer type")}l.push(d),c++}return l.lstmAtEnd=i,l.lstmLayerOnTime=r,l.nonPadInput=s,l},rs=e=>tf.loadLayersModel(e),os=ya.nodeHeight,ds=ya.nodeLength,cs=ya.inputNodeHeight,us=ya.embedddingLength,ps=e=>{let t=1/0,a=-1/0;if(void 0===e.length||1===e.length)return[e,e];if(void 0===e[0].length){for(let l=0;l<e.length;l++)e[l]<t?t=e[l]:e[l]>a&&(a=e[l]);return[t,a]}for(let l=0;l<e.length;l++)for(let n=0;n<e[0].length;n++)e[l][n]<t?t=e[l][n]:e[l][n]>a&&(a=e[l][n]);return[t,a]},gs=(e,t,a)=>({x:e.x+t,y:e.y+a}),hs=e=>({x:e.x,y:e.y+ds/2}),ys=(e,t,a,l)=>(void 0===l&&(l=0),e((a+t/2)/t*(1-2*l)+l)),ms=ya.layerColorScales,fs=ya.nodeLength,xs=ya.embedddingLength,vs=ya.intermediateColor;let bs=void 0,ws=ya.svgPaddings.top/2-4;ve.subscribe(e=>{bs=e}),be.subscribe(e=>{});const ks=e=>{let t=e.layerIndex,a=e.targetX,l=e.disable,n=e.delay,s=e.opacity,i=e.specialIndex,r=e.onEndFunc,o=void 0===e.transitionName?"move":e.transitionName,d=void 0===e.duration?500:e.duration;bs.select("g#rnn-layer-group-"+t).selectAll("g.node-group").each((e,t,r)=>{d3.select(r[t]).style("cursor",l&&t!==i?"default":"pointer").style("pointer-events",l&&t!==i?"none":"all").select("image").transition(o).ease(d3.easeCubicInOut).delay(n).duration(d).attr("x",a),d3.select(r[t]).select("rect.bounding").transition(o).ease(d3.easeCubicInOut).delay(n).duration(d).attr("x",a),void 0!==s&&t!==i&&d3.select(r[t]).select("image").style("opacity",s)}),bs.selectAll("g#layer-label-"+t).transition(o).ease(d3.easeCubicInOut).delay(n).duration(d).attr("transform",(e,t)=>`translate(${"embedding"!==e.type?a+fs/2:a+xs/2}, ${ws})`).on("end",r),bs.selectAll("g#layer-detailed-label-"+t).transition(o).ease(d3.easeCubicInOut).delay(n).duration(d).attr("transform",(e,t)=>`translate(${"embedding"!==e.type?a+fs/2:a+xs/2}, ${ws})`).on("end",r)},$s=(e,t,a)=>{void 0===a&&(a=bs);let l=a.append("defs").attr("class","overlay-gradient").append("linearGradient").attr("id",e).attr("x1","0%").attr("x2","100%").attr("y1","100%").attr("y2","100%");t.forEach(e=>{l.append("stop").attr("offset",e.offset).attr("stop-color",e.color).attr("stop-opacity",e.opacity)})},Ls=e=>{let t=e.legendHeight,a=e.curLayerIndex,l=e.range,n=e.group,s=e.minMax,i=e.width,r=e.x,o=e.y,d=e.isInput,c=e.colorScale,u=e.gradientAppendingName,p=e.gradientGap;void 0===c&&(c=ms.conv),void 0===p&&(p=0);let g="url(#inputGradient)",h=e=>c(e*(1-2*p)+p);if(!d){let e=(s.min+l/2)/l,t=(0+l/2)/l,a=(s.max+l/2)/l,i=s.max-s.min,r=(0-s.min)/i,o=e+(t-e)/2,d=t+(a-t)/2,c=[{offset:0,color:h(e),opacity:1},{offset:r/2,color:h(o),opacity:1},{offset:r,color:h(t),opacity:1},{offset:r+(1-t)/2,color:h(d),opacity:1},{offset:1,color:h(a),opacity:1}];void 0===u?($s("intermediate-legend-gradient",c,n),g="url(#intermediate-legend-gradient)"):($s(""+u,c,n),g=`url(#${u})`)}let y=d3.scaleLinear().range([0,i-1.2]).domain(d?[0,l]:[s.min,s.max]),m=d3.axisBottom().scale(y).tickFormat(d3.format(d?"d":".2f")).tickValues(d?[0,l]:[s.min,0,s.max]),f=n.append("g").attr("class","intermediate-legend-"+(a-1)).attr("transform",`translate(${r}, ${o})`),x=f.append("g").attr("transform",`translate(0, ${t-3})`).call(m);x.selectAll("text").style("font-size","9px").style("fill",vs),x.selectAll("path, line").style("stroke",vs),f.append("rect").attr("width",i).attr("height",t).attr("transform",`rotate(${d?180:0},\n      ${i/2}, ${t/2})`).style("fill",g)},Is=e=>{let t=e.group,a=e.sx,l=e.sy,n=e.tx,s=e.ty,i=e.dr,r=e.hFlip,o=void 0===e.marker?"marker":e.marker;t.append("g").attr("class","arrow-group").append("path").attr("d",`M${a},${l}A${i},${i} 0 0,${r?0:1} ${n},${s}`).attr("marker-end",`url(#${o})`).style("stroke","gray").style("fill","none")},As=ya.layerColorScales,Ns=ya.nodeLength,Ms=ya.nodeHeight,Cs=ya.embedddingLength,Es=ya.inputNodeHeight,Rs=ya.numLayers,Ss=ya.edgeOpacity,Ts=ya.edgeInitColor,_s=ya.edgeStrokeWidth,Hs=ya.svgPaddings,zs=ya.gapRatio,Fs=ya.classLists,Os=d3.format(".4f");let Gs=void 0;ve.subscribe(e=>{Gs=e});let Ps=void 0;be.subscribe(e=>{Ps=e});let Bs=void 0;we.subscribe(e=>{Bs=e});let Vs=void 0;xe.subscribe(e=>{Vs=e});let qs=void 0;ke.subscribe(e=>{qs=e});let Xs=void 0;$e.subscribe(e=>{Xs=e});let js=void 0;Le.subscribe(e=>{js=e});let Ds=void 0;Ie.subscribe(e=>{Ds=e});let Ws=void 0;Ne.subscribe(e=>{Ws=e});let Ys=void 0;Te.subscribe(e=>{Ys=e});let Ks,Us=Hs.top/2-4;const Js=(e,t,a,l,n,s,i)=>{let r=document.createElement("canvas");r.width=a,r.height=l;let o=r.getContext("2d");s.putImageData(i,0,0),o.drawImage(n,0,0,e,t,0,0,a,l);let d=r.toDataURL();return r.remove(),d},Qs=(e,t,a,l)=>{let n=a[t],s=As[e.type],i=void 0===e.output.length?1:e.output.length,r=document.createElement("canvas"),o=r.getContext("2d");r.width=i,r.height=i;let d,c=o.getImageData(0,0,i,1),u=c.data;for(let t=0;t<i;t++){let a;"input"===e.type?a=d3.rgb(s(.1+e.output/l)):(e.type.includes("lstm")||e.type.includes("embedding"))&&(a=d3.rgb(s((e.output[t]+l/2)/l))),u[4*t]=a.r,u[4*t+1]=a.g,u[4*t+2]=a.b,u[4*t+3]=255}d="input"===e.type?Js(i,1,Ns,Es,r,o,c):"embedding"==e.type?Js(i,1,3*Cs,3*Es,r,o,c):Js(i,1,Ns,Ms,r,o,c),d3.select(n).attr("xlink:href",d),r.remove()},Zs=(e,t,a,l)=>{d3.select(a[t]).select("rect.output-rect").transition("dense").delay(500).duration(800).ease(d3.easeCubicIn).attr("width",l(e.output))},ei=(e,t,a,l,n)=>{void 0===l&&(l=0),void 0===n&&(n=1);let s=e.append("defs").append("svg:linearGradient").attr("id",""+a).attr("x1","0%").attr("y1","100%").attr("x2","100%").attr("y2","100%").attr("spreadMethod","pad");for(let e=0;e<10;e++){let a=e/9,i=t(a*(n-l)+l);s.append("stop").attr("offset",100*a+"%").attr("stop-color",i).attr("stop-opacity",1)}},ti=(e,t,a,l=-1,n=-1)=>{let s,i=d3.scaleLinear().range([0,e]).domain([-t/2,t/2]),r=d3.axisBottom().scale(i).tickFormat(d3.format(".2f")).tickValues([-t/2,0,t/2]);"local"===a?s=`g#local-legend-${l}-${n}`:"module"===a?s="g#module-legend-"+l:"global"===a&&(s="g#global-legend"),Gs.select(s).select("g").call(r)},ai=(e,t,a,l,n,s,i="",r=-1,o=-1)=>{let d,c=d3.scaleLinear().range([0,e]).domain([-t/2,t/2]),u=d3.axisBottom().scale(c).tickFormat(d3.format(".2f")).tickValues([-t/2,0,t/2]);"local"===a?d=`local-legend-${r}-${o}`:"module"===a?d="module-legend-"+r:"global"===a&&(d="global-legend");let p=l.append("g").attr("class",`legend ${a}-legend`).attr("id",d).classed("hidden",!Ws||Xs!==a).attr("transform",`translate(${qs[n][0].x}, 0)`);p.append("g").attr("transform",`translate(0, ${s-3})`).call(u),p.append("rect").attr("width",e).attr("height",s).style("fill",i)},li=(e,t,a)=>(e-a*t)/(t+1),ni=()=>{ei(Gs,As.embedding,"embeddingGradient"),ei(Gs,As.lstm,"lstmGradient"),ei(Gs,As.input,"inputGradient");let e=Es;Ks=Hs.top+Ps*(Vs[Vs.length-1].length+1)+3*e,((e,t)=>{for(let a=0;a<1;a++){let l=1+2*a,n=1*Cs+0*Bs-1.2,s=js.local[l];ai(n,s,"local",e,l,t,"url(#embeddingGradient)",a,1);let i=1*Ns+0*Bs-1.2,r=js.local[l+1];ai(i,r,"local",e,l+1,t,"url(#lstmGradient)",a,2)}for(let a=0;a<1;a++){let l=1+2*a,n=js.module[l];ai(1*Ns+Cs+0*Bs+1*Bs*zs-1.2,n,"module",e,l,t,"url(#lstmGradient)",a)}let a=js.global[1];ai((Rs-3)*Ns+Cs+0*Bs+1*Bs*zs-1.2,a,"global",e,1,t,"url(#lstmGradient)");let l=d3.scaleLinear().domain([Ds[qs.length-1].min,Ds[qs.length-1].max]).range([0,Ns-1.2]),n=d3.axisBottom().scale(l).tickFormat(d3.format(".1f")).tickValues([0,Ds[qs.length-1].max]),s=e.append("g").attr("class","legend output-legend").attr("id","output-legend").classed("hidden",!Ws).attr("transform",`translate(${qs[qs.length-1][0].x}, 0)`);s.append("g").attr("transform",`translate(0, ${t-3})`).call(n),s.append("rect").attr("width",Ns-.3).attr("height",t).style("fill","gray");let i=d3.scaleLinear().range([0,Ns-1.2]).domain([0,js.local[0]]),r=d3.axisBottom().scale(i).tickValues([0,js.local[0]]),o=e.append("g").attr("class","legend input-legend").classed("hidden",!Ws).attr("transform",`translate(${qs[0][0].x}, 0)`);o.append("g").attr("transform",`translate(0, ${t-3})`).call(r),o.append("rect").attr("x",.3).attr("width",Ns-.3).attr("height",t).style("stroke","rgb(20, 20, 20)").style("stroke-width",.3).style("fill","url(#inputGradient)")})(Gs.append("g").attr("class","color-legend").attr("transform",`translate(0, ${Ks})`),e)},si=e=>{let t=d3.linkHorizontal().x(e=>e.x).y(e=>e.y),a=((e,t)=>{let a=[];for(let s=1;s<t.length;s++)for(let i=0;i<t[s].length;i++){let r="output"===t[s][i].layerName,o=1===s?cs/2:os/2,d=(l=e[s][i],n=o,{x:l.x,y:l.y+n});for(let l=0;l<t[s][i].inputLinks.length;l++){let n,o=t[s][i].inputLinks[l].source.index;if(r){let e=t[s-1][0].output.length*t[s-1][0].output.length;if(o%e!=0)continue;o=Math.floor(o/e)}let c="embedding"!==t[s-1][i].type?ds:us,u=1===s?cs/2:os/2;if(!t[s-1][o])continue;n=gs(e[s-1][o],c,u);let p=t[s][i].inputLinks[l].weight;a.push({source:n,target:d,weight:p,targetLayerIndex:s,targetNodeIndex:i,sourceNodeIndex:o})}}var l,n;return a})(qs,Vs);e.append("g").attr("class","edge-group").selectAll("path.edge").data(a).enter().append("path").attr("class",e=>`edge edge-${e.targetLayerIndex} edge-${e.targetLayerIndex}-${e.targetNodeIndex}`).attr("id",e=>`edge-${e.targetLayerIndex}-${e.targetNodeIndex}-${e.sourceNodeIndex}`).attr("d",e=>t({source:e.source,target:e.target})).style("fill","none").style("stroke-width",e=>2===e.targetLayerIndex?_s:4*_s).style("opacity",Ss).style("stroke",Ts)},ii=(e,t,a,l)=>{e.append("image").attr("class","node-image").attr("width",Ns).attr("height",Es).attr("x",t).attr("y",(e,t)=>qs[a][t].y),e.append("rect").attr("class","input-rect").attr("class","bounding").attr("width",Ns).attr("height",Es).attr("x",t).attr("y",(e,t)=>qs[a][t].y).style("fill","none").style("stroke","gray").style("stroke-width",1).classed("hidden",!0),e.append("text").attr("class","input-text-index").attr("x",t-30).attr("y",(e,t)=>qs[a][t].y+Es/2).style("dominant-baseline","middle").style("font-size","6px").style("fill","black").style("opacity",.8).text((e,t)=>"#"+(t+1))},ri=(e,t,a)=>{e.append("rect").attr("class","bounding").attr("x",t).attr("y",(e,t)=>qs[a][t].y).attr("height",Ms).attr("width",Ns).style("fill","none").style("stroke","gray").style("stroke-width",.5).classed("hidden",!1),e.append("rect").attr("class","output-rect").attr("x",t).attr("y",(e,t)=>qs[a][t].y).attr("height",Ms).attr("width",Ns).style("fill","gray"),e.append("text").attr("class","output-text-one").attr("x",t-Ns/5).attr("y",(e,t)=>qs[a][t].y-Ns/4).style("dominant-baseline","middle").style("font-size","11px").style("fill","black").style("opacity",.5).text((e,t)=>Fs[t]),e.append("text").attr("class","output-text-two").attr("x",t+4*Ns/5).attr("y",(e,t)=>qs[a][t].y-Ns/4).style("dominant-baseline","middle").style("font-size","11px").style("fill","black").style("opacity",.5).text((e,t)=>Fs[t+1])},oi=()=>{let e=d3.scaleLinear().domain([Ds[Vs.length-1].min,Ds[Vs.length-1].max]).range([0,Ns]);Gs.selectAll("g.node-output").each((t,a,l)=>Zs(t,a,l,e))},di=(e,t,a)=>{let l=t+Ns/2,n=qs[a][0].y-Ns,s=e.append("g").attr("class","lstm-annotation").classed("hidden",!1),i=s.append("text").attr("x",l).attr("y",n).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor","middle").append("tspan").style("dominant-baseline","hanging").text("The carry state (long-term) and momery ");i.append("tspan").attr("x",l).attr("dy","1em").style("dominant-baseline","hanging").text("state (short-tem) will go back into the"),i.append("tspan").attr("x",l).attr("dy","1em").style("dominant-baseline","hanging").text("LSTM for computation at next time step."),i.append("tspan").attr("x",l).attr("dy","1em").style("dominant-baseline","hanging").text(`This loop repeat for ${qs[a-1].length-1} times`),Is({group:s,sx:t+Ns,sy:qs[a][0].y+Ms/2,tx:t,ty:qs[a][0].y-2,dr:Ns/3,hFlip:!0,marker:"marker-alt"}),console.log("node-lstm is: ",s)},ci=(e,t,a)=>{e.append("image").attr("class","node-image").attr("width",(e,t)=>"embedding"!==e.type?Ns:Cs).attr("height",(e,t)=>"embedding"!==e.type?Ms:Es).attr("x",t).attr("y",(e,t)=>qs[a][t].y),e.append("rect").attr("class","bounding").attr("width",(e,t)=>"embedding"!==e.type?Ns:Cs).attr("height",(e,t)=>"embedding"!==e.type?Ms:Es).attr("x",t).attr("y",(e,t)=>qs[a][t].y).style("fill","none").style("stroke","gray").style("stroke-width",1).classed("hidden",!0)},ui=e=>{let t=js[Xs][e];Gs.select("g#rnn-layer-group-"+e).selectAll("image.node-image").each((e,a,l)=>Qs(e,a,l,t))},pi=(e,t,a,l,n,s)=>{Bs=(e=>(e-Ns*(Rs-1)-Cs)/(3+2*zs))(e),we.set(Bs);let i=0;qs.length=0;for(let e=0;e<Vs.length;e++){let r=Vs[e],o="input"===r[0].layerName,d="dense_Dense1"===r[0].layerName,c="lstm"===r[0].type;qs.push([]),d||"lstm"===r[0].type?i+=Bs*zs:i+=Bs;let u=i,p=r[0].layerName;Ps="input"===p||p.includes("embedding")?li(t,r.length,Es):li(t,r.length,Ms),be.set(Ps);let g=a.append("g").attr("class","rnn-layer-group").attr("id","rnn-layer-group-"+e),h=g.selectAll("g.node-group").data(r,e=>e.index).enter().append("g").attr("class","node-group").style("cursor","pointer").style("pointer-events","all").on("click",c?null:s).on("mouseover",l).on("mouseleave",n).classed("node-input",o).classed("node-output",d).classed("node-lstm",c).attr("id",(t,a)=>{let l;return l="input"===t.type||"embedding"===t.type?a*Es+(a+1)*Ps:a*Ms+(a+1)*Ps,l+=Hs.top,qs[e].push({x:u,y:l}),`layer-${e}-node-${a}`});g.selectAll("g.node-input").on("mouseover",(e,t,a)=>{l(e,t,a);let n=0===e.output[0]?"<pad>":Ys[t+Ys.length-r.length];Se.set({show:!0,text:`'${n}' token in vocabulary is: ${e.output[0]}`})}).on("mouseleave",(e,t,a)=>{n(e,t,a);let l=0===e.output[0]?"<pad>":Ys[t+Ys.length-r.length];Se.set({show:!1,text:`'${l}' token in vocabulary is: ${e.output[0]}`})}),g.selectAll("g.node-output").on("mouseover",(e,t,a)=>{l(e,t,a),Se.set({show:!0,text:"Output value: "+Os(e.output)})}).on("mouseleave",(e,t,a)=>{n(e,t,a),Se.set({show:!1,text:"Output value: "+Os(e.output)})}),"input"===r[0].layerName?(ii(h,u,e),ui(e)):r[0].layerName.includes("dense")?(ri(h,u,e),oi()):r[0].layerName.includes("embedding")?(ci(h,u,e),ui(e)):r[0].layerName.includes("lstm")&&(ci(h,u,e),di(h,u,e),ui(e)),i+="embedding"!==Vs[e][0].type?Ns:Cs}ke.set(qs),console.log("nodeCoordinate is: ",qs),(()=>{let e=Vs.map(e=>"dense_Dense1"===e[0].layerName||e[0].layerName.includes("lstm")?{name:e[0].layerName,dimension:`(${e.length})`}:{name:e[0].layerName,dimension:`(${e[0].output.length}, ${e.length})`}),t=Number(d3.select("#rnn-svg").style("height").replace("px",""))+150,a=new SmoothScroll('a[href*="#"]',{offset:-t}),l=Gs.selectAll("g.layer-detailed-label").data(e).enter().append("g").attr("class","layer-detailed-label").attr("id",(e,t)=>"layer-detailed-label-"+t).classed("hidden",!Ws).attr("transform",(e,t)=>`translate(${e.name.includes("embedding")?qs[t][0].x+Cs/2:qs[t][0].x+Ns/2}, ${Us})`).style("cursor",e=>e.name.includes("dense")?"default":"help").on("click",e=>{let t="";e.name.includes("conv")&&(t="convolution"),e.name.includes("relu")&&(t="relu"),e.name.includes("max_pool")&&(t="pooling"),e.name.includes("input")&&(t="input"),e.name.includes("embedding")&&(t="embedding"),e.name.includes("lstm")&&(t="lstm");let l=document.querySelector("#article-"+t);a.animateScroll(l)});l.append("title").text("Move to article section"),l.append("text").style("opacity",.7).style("dominant-baseline","middle").append("tspan").style("font-size","12px").text(e=>"dense_Dense1"!==e.name?e.name:"output").append("tspan").style("font-size","8px").style("font-weight","normal").attr("x",0).attr("dy","1.5em").text(e=>e.dimension);let n=Gs.selectAll("g.layer-label").data(e).enter().append("g").attr("class","layer-label").attr("id",(e,t)=>"layer-label-"+t).classed("hidden",Ws).attr("transform",(e,t)=>`translate(${e.name.includes("embedding")?qs[t][0].x+Cs/2:qs[t][0].x+Ns/2}, ${Us})`).style("cursor",e=>e.name.includes("dense")?"default":"help").on("click",e=>{let t="";e.name.includes("conv")&&(t="convolution"),e.name.includes("relu")&&(t="relu"),e.name.includes("max_pool")&&(t="pooling"),e.name.includes("input")&&(t="input"),e.name.includes("embedding")&&(t="embedding"),e.name.includes("lstm")&&(t="lstm");let l=document.querySelector("#article-"+t);a.animateScroll(l)});n.append("title").text("Move to article section"),n.append("text").style("dominant-baseline","middle").style("opacity",.8).text(e=>e.name.includes("conv")?"conv":e.name.includes("relu")?"relu":e.name.includes("max_pool")?"max_pool":e.name.includes("embedding")?"embedding":e.name.includes("lstm")?"lstm":e.name.includes("dense")?"output":e.name)})(),ni(),si(a)},gi=()=>{console.log("reviewArray is: ",Ys);let e=d3.scaleLinear().domain([Ds[Vs.length-1].min,Ds[Vs.length-1].max]).range([0,Ns]);for(let t=0;t<Vs.length;t++){let a=Vs[t],l=js[Xs][t],n=Gs.select("g#rnn-layer-group-"+t).selectAll("g.node-group").data(a);t<Vs.length-1?n.transition("disappear").duration(300).ease(d3.easeCubicOut).style("opacity",0).on("end",(function(){d3.select(this).select("image.node-image").each((e,t,a)=>Qs(e,t,a,l)),d3.select(this).select("text.input-annotation").text((e,t)=>e.output),d3.select(this).transition("appear").duration(700).ease(d3.easeCubicIn).style("opacity",1)})):n.each((t,a,l)=>Zs(t,a,l,e))}for(let e=0;e<1;e++){let t=1+2*e,a=js.local[t];ti(1*Cs+0*Bs,a,"local",e,1);let l=1*Ns+0*Bs,n=js.local[t+1];ti(l,n,"local",e,2)}for(let e=0;e<1;e++){let t=1+2*e,a=1*Ns+1*Cs+0*Bs+1*Bs*zs-1.2,l=js.module[t];ti(a,l,"module",e)}let t=(Rs-3)*Ns+1*Cs+0*Bs+1*Bs*zs-1.2,a=js.global[1];ti(t,a,"global")},hi=(e=1)=>{let t=[e],a=void 0;Ds=[];for(let e=0;e<Vs.length-1;e++){let l=Vs[e],n=l.map(e=>ps(e.output)).reduce((e,t)=>[Math.min(e[0],t[0]),Math.max(e[1],t[1])]);Ds.push({min:n[0],max:n[1]}),"embedding"!==l[0].type&&"lstm"!==l[0].type||(n=n.map(Math.abs),a=2*(.1+Math.round(1e3*Math.max(...n))/1e3)),void 0!==a&&t.push(a)}t.push(1),Ds.push({min:0,max:1});let l=[e],n=(Rs-2)/2;for(let e=0;e<n;e++){let a=t.slice(1+2*e,1+2*e+2),n=Math.max(...a);for(let e=0;e<2;e++)l.push(n)}l.push(1);let s=[e],i=Math.max(...t.slice(1,t.length-1));for(let e=0;e<Rs-2;e++)s.push(i);s.push(1),js.local=t,js.module=l,js.global=s,js.output=[0,d3.max(Vs[Vs.length-1].map(e=>e.output))],Le.set(js),Ie.set(Ds)};d3.format(".4f");let yi=void 0;ve.subscribe(e=>{yi=e}),be.subscribe(e=>{}),we.subscribe(e=>{}),xe.subscribe(e=>{}),ke.subscribe(e=>{}),$e.subscribe(e=>{}),Le.subscribe(e=>{}),Ie.subscribe(e=>{}),Ae.subscribe(e=>{}),Me.subscribe(e=>{}),Ne.subscribe(e=>{}),_e.subscribe(e=>{});const mi=(e,t,a,l,n)=>{yi.select(".intermediate-layer-overlay").empty()&&yi.append("g").attr("class","intermediate-layer-overlay"),yi.select(".intermediate-layer-overlay").append("rect").attr("class","overlay").style("fill",`url(#${e})`).style("stroke","none").attr("width",l).attr("height",n).attr("x",t).attr("y",a).style("opacity",0).transition("move").duration(800).ease(d3.easeCubicInOut).style("opacity",1)},fi=ya.layerColorScales,xi=ya.numLayers,vi=ya.nodeLength,bi=ya.nodeHeight,wi=ya.inputNodeHeight,ki=ya.embedddingLength,$i=ya.plusSymbolRadius,Li=ya.intermediateColor,Ii=ya.kernelRectLength,Ai=ya.svgPaddings,Ni=ya.gapRatio,Mi=ya.classLists,Ci=d3.format(".4f");let Ei=void 0;ve.subscribe(e=>{Ei=e});let Ri=void 0;be.subscribe(e=>{Ri=e});let Si=void 0;we.subscribe(e=>{Si=e});let Ti=void 0;xe.subscribe(e=>{Ti=e});let _i=void 0;ke.subscribe(e=>{_i=e});let Hi=void 0;$e.subscribe(e=>{Hi=e});let zi=void 0;Le.subscribe(e=>{zi=e});let Fi=void 0;Ie.subscribe(e=>{Fi=e});let Oi=void 0;Ce.subscribe(e=>{Oi=e});let Gi=void 0;Re.subscribe(e=>{Gi=e});let Pi=void 0;Ee.subscribe(e=>{Pi=e});let Bi=void 0;Se.subscribe(e=>{Bi=e});let Vi=void 0;Ne.subscribe(e=>{Vi=e});let qi=void 0;Me.subscribe(e=>{qi=e});const Xi=3;let ji,Di=Ai.top/2-4,Wi=!1,Yi=[];const Ki=(e,t,a,l)=>{d3.select(a[t]).transition().duration(6e4).ease(d3.easeLinear).attr("stroke-dashoffset",l).on("end",(e,t,a)=>{qi&&Ki(e,t,a,l-2e3)})},Ui=(e,t,a,l,n,s)=>{let i=d3.select(a[t]);if(s){let e=+i.attr("data-preX"),t=+i.attr("data-preY");i.transition("sigmoid").duration(n).ease(d3.easeCubicInOut).attr("transform",`translate(${e}, ${t})`)}else{let e=i.attr("transform"),t=+e.replace(/.*\(([\d\.]+),.*/,"$1"),a=+e.replace(/.*,\s([\d\.]+)\)/,"$1");i.transition("sigmoid").duration(n).ease(d3.easeCubicInOut).attr("transform",`translate(${t-l}, ${a})`),i.attr("data-preX",t),i.attr("data-preY",a)}},Ji=e=>{Se.set({show:!0,text:"Logit: "+Ci(Yi[e])}),Pi.highlightI=e,Ee.set(Pi);let t=Ei.select(".logit-layer"),a=Ei.select(".underneath"),l=Ei.select(".intermediate-layer");t.select("#logit-circle-"+e).style("stroke-width",2),l.select("#plus-symbol-clone-"+e).style("opacity",1).select("circle").style("fill",e=>e.fill),a.select("#logit-lower-"+e).raise(),a.selectAll(".sigmoid-abstract-edge-"+e).style("stroke-width",.8).style("stroke","#E0E0E0"),a.selectAll(".sigmoid-edge-"+e).style("stroke-width",1).style("stroke","#E0E0E0"),a.selectAll(".logit-output-edge-"+e).style("stroke-width",3).style("stroke","#E0E0E0"),t.selectAll(".logit-output-edge-"+e).style("stroke-width",3).style("stroke","#E0E0E0")},Qi=e=>{Se.set({show:!1,text:"Logit: "+Ci(Yi[e])}),Pi.highlightI=-1,Ee.set(Pi);let t=Ei.select(".logit-layer"),a=Ei.select(".underneath"),l=Ei.select(".intermediate-layer");t.select("#logit-circle-"+e).style("stroke-width",1),l.select("#plus-symbol-clone-"+e).style("opacity",.2),a.selectAll(".sigmoid-abstract-edge-"+e).style("stroke-width",.2).style("stroke","#EDEDED"),a.selectAll(".sigmoid-edge-"+e).style("stroke-width",.2).style("stroke","#F1F1F1"),a.selectAll(".logit-output-edge-"+e).style("stroke-width",1.2).style("stroke","#E5E5E5"),t.selectAll(".logit-output-edge-"+e).style("stroke-width",1.2).style("stroke","#E5E5E5")},Zi=e=>{Ji(e.detail.curI)},er=e=>{Qi(e.detail.curI)},tr=e=>{let t=e.curLayerIndex,a=e.moveX,l=e.symbolX,n=e.symbolY,s=e.outputX,i=e.outputY,r=e.sigmoidLeftMid,o=e.selectedI,d=e.intermediateX1,c=e.intermediateX2,u=e.pixelWidth,p=e.pixelHeight,g=e.topY,h=e.bottomY,y=e.middleGap,m=e.middleRectHeight,f=e.sigmoidX,x=e.sigmoidTextY,v=e.sigmoidWidth,b=e.symbolGroup,w=e.lstmRange,k=r-4*a/5;d3.event.stopPropagation(),Oi?(Re.set(!1),Ei.select(".logit-layer").remove(),Ei.select(".logit-layer-lower").remove(),Ei.selectAll(".plus-symbol-clone").remove(),Ei.select(".underneath").selectAll(".logit-lower").style("opacity",0),Ee.set({show:!1,logits:[]})):Re.set(!0),Ei.select(".intermediate-layer-overlay").select("rect.overlay").transition("sigmoid").ease(d3.easeCubicInOut).duration(600).attr("transform",`translate(${Oi?0:-a}, 0)`),Ei.selectAll(".intermediate-legend-"+(t-1)).each((e,t,l)=>Ui(0,t,l,a,600,Oi)),Ei.select(".intermediate-layer").select(".layer-label").each((e,t,l)=>Ui(0,t,l,a,600,Oi)),Ei.select(".intermediate-layer").select(".layer-detailed-label").each((e,t,l)=>Ui(0,t,l,a,600,Oi));for(let e=t-1;e>=0;e--){let t=+Ei.select("g#rnn-layer-group-"+e).select("image").attr("x");ks({layerIndex:e,targetX:Oi?t+a:t-a,disable:!0,delay:0,transitionName:"sigmoid",duration:600})}Ei.select(".plus-annotation").transition("sigmoid").duration(600).style("opacity",Oi?1:0).style("pointer-events",Oi?"all":"none");let $=Ei.select(".sigmoid-annotation").style("pointer-events",Oi?"all":"none"),L=$.selectAll(".sigmoid-detail-annoataion").data([0]).enter().append("g").attr("class","sigmoid-detail-annoataion");Oi&&$.selectAll(".sigmoid-detail-annoataion").remove(),$.select(".arrow-group").transition("sigmoid").duration(600).style("opacity",Oi?1:0),$.select(".annotation-text").style("cursor","help").style("pointer-events","all").on("click",()=>{d3.event.stopPropagation(),document.querySelector("#article-sigmoid").scrollIntoView({behavior:"smooth"})}).transition("sigmoid").duration(600).style("opacity",Oi?1:0).on("end",()=>{if(!Oi){let e=f+v/2,a=x-10;0===o&&(a=x+70);let l=L.append("text").attr("x",e).attr("y",a).attr("class","annotation-text sigmoid-detail-text").style("dominant-baseline","baseline").style("text-anchor","middle").text("Normalize ");l.append("tspan").attr("dx",1).style("fill","#E56014").text("logits"),l.append("tspan").attr("dx",1).text(" into"),l.append("tspan").attr("x",e).attr("dy","1.1em").text("class probabilities"),Is(0===o?{group:L,sx:f+v/2-5,sy:x+44,tx:f+v/2,ty:a-12,dr:50,hFlip:!0,marker:"marker-alt"}:{group:L,sx:f+v/2-5,sy:x+4,tx:f+v/2,ty:n-$i-4,dr:50,hFlip:!0,marker:"marker-alt"}),e=k+45,a=Di+5;let s=k+20,i=Di+5;L.append("g").attr("class","layer-detailed-label").attr("transform",()=>`translate(${k}, ${Di-5})`).classed("hidden",!Vi).append("text").attr("y",Di).style("opacity",.7).style("dominant-baseline","middle").style("font-size","12px").style("font-weight","800").append("tspan").attr("x",0).text("logit").append("tspan").attr("x",0).style("font-size","8px").style("font-weight","normal").attr("dy","1.5em").text("(1)"),L.append("text").attr("class","annotation-text").attr("x",e).attr("y",Di+5).style("text-anchor","start").text("Before").append("tspan").attr("x",e).attr("dy","1em").text("normalization"),Is({group:L,tx:s,ty:i,sx:e-6,sy:a+2,dr:60,hFlip:!1,marker:"marker-alt"});let r=Xi;L.append("text").attr("class","annotation-text").attr("x",_i[r][0].x-30).attr("y",Di+3).style("text-anchor","end").text("After").append("tspan").attr("x",_i[r][0].x-30).attr("dy","1em").text("normalization"),Is({group:L,tx:_i[r][0].x,ty:i,sx:_i[r][0].x-24,sy:a+2,dr:60,hFlip:!0,marker:"marker-alt"});let d=L.append("g").attr("class","sigmoid-detail-hover-annotation").style("opacity",0);e=k+50,a=_i[t-1][0].y+vi/2;let c=d.append("text").attr("x",e).attr("y",a).attr("class","annotation-text sigmoid-detail-text sigmoid-hover-text").style("text-anchor","start").style("dominant-baseline","baseline").append("tspan").style("font-weight",700).style("dominant-baseline","baseline").text("Hover over ").append("tspan").style("font-weight",400).style("dominant-baseline","baseline").text("to see");c.append("tspan").style("dominant-baseline","baseline").attr("x",e).attr("dy","1em").text("its "),c.append("tspan").style("dominant-baseline","baseline").attr("dx",1).style("fill","#E56014").text("logit"),c.append("tspan").style("dominant-baseline","baseline").attr("dx",1).text(" value"),Is({group:d,tx:k+15,ty:a,sx:e-8,sy:a+2,dr:60,hFlip:!1})}}),Ei.select(".lstm-annotation").classed("hidden",!0);let I=Ei.select(".lstm-layer-left");I.transition("sigmoid").duration(600).ease(d3.easeCubicInOut).attr("transform",`translate(${Oi?0:-a}, 0)`).on("end",()=>{if(!Oi){(e=>{let t=e.curLayerIndex,a=e.moveX,l=e.sigmoidLeftMid,n=e.selectedI,s=e.intermediateX1,i=e.intermediateX2,r=e.pixelWidth,o=(e.pixelHeight,e.topY,e.bottomY,e.sigmoidX),d=(e.middleGap,e.middleRectHeight,e.symbolGroup),c=e.symbolX,u=e.lstmRange,p=Ei.select(".intermediate-layer").append("g").attr("class","logit-layer").raise(),g=Ei.select(".intermediate-layer").select(".dense-layer").select(".plus-symbol").clone(!0).attr("class","temp-clone-plus-symbol").attr("transform",`translate(${c-a},\n      ${_i[t][n].y+bi/2})`).style("pointer-events","none").remove(),h=p.append(()=>g.node());Ei.select(".sigmoid-symbol").raise();let y=Ei.select(".underneath").append("g").attr("class","logit-layer-lower").lower(),m=l-4*a/5;Yi=[];let f=Ti[Xi];for(let e=0;e<f.length;e++)Yi.push(f[e].logit);let x=d3.scaleLinear().domain(d3.extent(Yi)).range([.2,1]);p.append("circle").attr("class","logit-circle").attr("id","logit-circle-"+n).attr("cx",m).attr("cy",_i[t][n].y+bi/2).attr("r",8).style("fill",fi.logit(x(Yi[n]))).style("cursor","crosshair").style("pointer-events","all").style("stroke",Li).on("mouseover",()=>Ji(n)).on("mouseleave",()=>Qi(n)).on("click",()=>{d3.event.stopPropagation()});let v=Ei.select(".intermediate-layer-annotation").select(".sigmoid-detail-annoataion");v.select("#logit-text-"+n).style("opacity",1),h.raise(),p.append("line").attr("class","logit-output-edge-"+n).attr("x1",i-a+2*$i).attr("x2",o).attr("y1",_i[t][n].y+bi/2).attr("y2",_i[t][n].y+bi/2).style("fill","none").style("stroke","#EAEAEA").style("stroke-width","1.2").lower();let b=[],w=Ti.lstm.length,k=[...Array(f.length).keys()].filter(e=>e!=n),$=0,L=d3.linkHorizontal().x(e=>e.x).y(e=>e.y);const I=()=>{if(!Gi)return void Ei.select(".underneath").selectAll(".logit-lower").remove();if(0===k.length)return;let e=k[$],l=Ei.select(".underneath").select("#logit-lower-"+e);if(l.empty()){l=Ei.select(".underneath").append("g").attr("class","logit-lower").attr("id","logit-lower-"+e).style("opacity",0);for(let l=0;l<w;l+=3)b.push({source:{x:s+r+3-a,y:_i[t-1][l]+bi/2},target:{x:i-a,y:_i[t][e].y+bi/2},index:factoredF,weight:Ti.lstm[factoredF].outputLinks[e].weight,color:"#F1F1F1",width:.5,opacity:1,class:"sigmoid-edge-"+e});l.selectAll("path.sigmoid-edge-"+e).data(b).enter().append("path").attr("class",e=>e.class).attr("id",e=>"edge-"+e.name).attr("d",e=>L({source:e.source,target:e.target})).style("fill","none").style("stroke-width",e=>e.width).style("stroke",e=>void 0===e.color?Li:e.color).style("opacity",e=>e.opacity).style("pointer-events","none")}let g=p.append("g").attr("class","logit-layer-"+e).style("opacity",0),h=d.clone(!0).style("opacity",0);h.attr("class","plus-symbol-clone").attr("id","plus-symbol-clone-"+e).select("circle").datum({fill:ys(fi.weight,u,f[e].bias,.35)}).style("pointer-events","none").style("fill","#E5E5E5"),h.attr("transform",`translate(${c},\n      ${_i[t][e].y+vi/2})`);let A=L({source:{x:i-a+2*$i,y:_i[t][e].y+vi/2},target:{x:m+8,y:_i[t][e].y+vi/2}}),N=L({source:{x:m+8,y:_i[t][e].y+vi/2},target:{x:o,y:_i[t][n].y+vi/2}}),M=y.append("path").attr("class","logit-output-edge-"+e).attr("d",A).style("fill","none").style("stroke","#EAEAEA").style("stroke-width","1.2"),C=y.append("path").attr("class","logit-output-edge-"+e).attr("d",N).style("fill","none").style("stroke","#EAEAEA").style("stroke-width","1.2"),E=M.node().getTotalLength(),R=C.node().getTotalLength(),S=E+R,T=Wi?500:800,_=Wi?400:600;M.attr("stroke-dasharray",E+" "+E).attr("stroke-dashoffset",E),C.attr("stroke-dasharray",R+" "+R).attr("stroke-dashoffset",R),M.transition("sigmoid-output-edge").duration(E/S*T).attr("stroke-dashoffset",0),C.transition("sigmoid-output-edge").delay(E/S*T).duration(R/S*T).attr("stroke-dashoffset",0),g.append("circle").attr("class","logit-circle").attr("id","logit-circle-"+e).attr("cx",m).attr("cy",_i[t-1][e].y+vi/2).attr("r",7).style("fill",fi.logit(x(Yi[e]))).style("stroke",Li).style("cursor","crosshair").on("mouseover",()=>Ji(e)).on("mouseleave",()=>Qi(e)).on("click",()=>{d3.event.stopPropagation()}),Pi.startAnimation={i:e,duration:_,hasInitialized:!1},Ee.set(Pi),g.transition("sigmoid-edge").duration(_).style("opacity",1),(n<3&&9==e||n>=3&&0==e)&&v.select(".sigmoid-detail-hover-annotation").transition("sigmoid-edge").duration(_).style("opacity",1),v.select("#logit-text-"+e).transition("sigmoid-edge").duration(_).style("opacity",1),l.transition("sigmoid-edge").duration(_).style("opacity",1).on("end",()=>{$++,$<k.length?(b=[],I()):(Wi=!0,Pi.hasInitialized=!0,Ee.set(Pi))}),h.transition("sigmoid-edge").duration(_).style("opacity",.2)};let A=Ei.select(".intermediate-layer").select(".layer-label").node(),N=((e,t)=>{if(void 0!==e){let a=t;for(;null==a.getScreenCTM&&null!=a.parentNode;)a=a.parentNode;let l=e.node().ownerSVGElement.createSVGPoint(),n=a.getScreenCTM(),s=a.getBBox().height;l.x+=0,l.y-=s/2;let i=l.matrixTransform(n);return{top:i.y,left:i.x}}})(Ei,A),M=+d3.select("#rnn-svg").style("height").replace("px","")/2,C=2.5*vi+M;const E=document.getElementById("detailview");E.style.top=C+"px",E.style.left=N.left-vi+"px",E.style.position="absolute",Ee.set({show:!0,logits:Yi,logitColors:Yi.map(e=>fi.logit(x(e))),selectedI:n,highlightI:-1,outputName:Mi[n],outputValue:f[n].output,startAnimation:{i:-1,duration:0,hasInitialized:Wi}}),I();let R=wi;ji=Ai.top+Ri*(Ti[Ti.length-1].length+1)+3*R;Ls({legendHeight:5,curLayerIndex:t,range:Math.abs(d3.extent(Yi)[1])+Math.abs(d3.extent(Yi)[0]),minMax:{min:-Math.abs(d3.extent(Yi)[0]),max:Math.abs(d3.extent(Yi)[1])},group:p,width:o-(i+2*$i-a+5),gradientAppendingName:"flatten-logit-gradient",gradientGap:.1,colorScale:fi.logit,x:i+2*$i-a+5,y:ji});p.append("g").attr("class","layer-label").classed("hidden",Vi).attr("transform",()=>`translate(${m}, ${Di})`).append("text").style("text-anchor","middle").style("dominant-baseline","middle").style("opacity",.8).style("font-weight",800).text("logit")})({curLayerIndex:t,moveX:a,sigmoidLeftMid:r,selectedI:o,intermediateX1:d,intermediateX2:c,pixelWidth:u,pixelHeight:p,topY:g,bottomY:h,middleGap:y,middleRectHeight:m,sigmoidX:f,symbolGroup:b,symbolX:l,lstmRange:w})}if(Oi)I.select(".symbol-output-line").remove();else{I.select(".edge-group").append("line").attr("class","symbol-output-line").attr("x1",l).attr("y1",n).attr("x2",s+a).attr("y2",i).style("stroke-width",1.2).style("stroke","#E5E5E5").style("opacity",0).transition("sigmoid").delay(200).duration(400).style("opacity",1)}Oi=!Oi,Ce.set(Oi)})};function ar(e){let t,a,l;return a=new Hn({props:{size:"120",color:"#0abab5"}}),{c(){t=c("div"),W(a.$$.fragment),m(t,"class","spinner-item svelte-wq6b7c"),m(t,"title","Jumper")},m(e,n){r(e,t,n),Y(a,t,null),l=!0},i(e){l||(j(a.$$.fragment,e),l=!0)},o(e){D(a.$$.fragment,e),l=!1},d(e){e&&o(t),K(a)}}}function lr(e){let t,a;return t=new On({props:{logits:e[3].logits,logitColors:e[3].logitColors,selectedI:e[3].selectedI,highlightI:e[3].highlightI,outputName:e[3].outputName,outputValue:e[3].outputValue,startAnimation:e[3].startAnimation}}),t.$on("xClicked",e[18]),t.$on("mouseOver",Zi),t.$on("mouseLeave",er),{c(){W(t.$$.fragment)},m(e,l){Y(t,e,l),a=!0},p(e,a){const l={};8&a[0]&&(l.logits=e[3].logits),8&a[0]&&(l.logitColors=e[3].logitColors),8&a[0]&&(l.selectedI=e[3].selectedI),8&a[0]&&(l.highlightI=e[3].highlightI),8&a[0]&&(l.outputName=e[3].outputName),8&a[0]&&(l.outputValue=e[3].outputValue),8&a[0]&&(l.startAnimation=e[3].startAnimation),t.$set(l)},i(e){a||(j(t.$$.fragment,e),a=!0)},o(e){D(t.$$.fragment,e),a=!1},d(e){K(t,e)}}}function nr(e){let t,a;return t=new Yn({props:{input:[e[11][0].input],kernel:e[11][0].kernel,output:[e[11][0].output],dataRange:e[11].colorRange,isExited:e[12]}}),t.$on("message",e[17]),{c(){W(t.$$.fragment)},m(e,l){Y(t,e,l),a=!0},p(e,a){const l={};2048&a[0]&&(l.input=[e[11][0].input]),2048&a[0]&&(l.kernel=e[11][0].kernel),2048&a[0]&&(l.output=[e[11][0].output]),2048&a[0]&&(l.dataRange=e[11].colorRange),4096&a[0]&&(l.isExited=e[12]),t.$set(l)},i(e){a||(j(t.$$.fragment,e),a=!0)},o(e){D(t.$$.fragment,e),a=!1},d(e){K(t,e)}}}function sr(e){let t,a,s,d,h,f,v,k,L,I,A,N,M,C,E,R,S,T,_,H,F,O,G,P,B,V,W,Y,K,U,J,Q,Z,ee,te,ae,le,ne,se,ie,re,oe,de,ce,ue,pe,ge,he=e[4].text+"",ye=e[8][e[9]]+"",me=!e[7]&&ar();const fe=[nr,lr],xe=[];function ve(e,t){return e[5].data&&"embedding"===e[5].data.type?0:e[3].show?1:-1}return~(de=ve(e))&&(ce=xe[de]=fe[de](e)),{c(){t=c("div"),a=c("div"),s=c("div"),d=c("div"),h=c("span"),h.innerHTML='<i class="fas fa-palette"></i>',f=g(),v=c("div"),k=c("select"),L=c("option"),L.textContent="Positive example",I=c("option"),I.textContent="Negative example",A=c("option"),A.textContent="Input your review",N=g(),M=c("button"),C=c("span"),C.innerHTML='<i class="fas fa-crosshairs "></i>',E=g(),R=c("span"),S=p(he),T=g(),_=c("div"),H=c("button"),F=c("span"),F.innerHTML='<i class="fas fa-eye"></i>',O=g(),G=c("span"),G.textContent="Show detail",P=g(),B=c("div"),V=c("span"),V.innerHTML='<i class="fas fa-layer-group"></i>',W=g(),Y=c("div"),K=c("select"),U=c("option"),U.textContent="Unit",J=c("option"),J.textContent="Module",Q=c("option"),Q.textContent="Global",Z=g(),ee=c("div"),te=c("div"),ae=p(ye),le=g(),ne=c("div"),me&&me.c(),se=g(),ie=u("svg"),re=g(),oe=c("div"),ce&&ce.c(),m(h,"class","icon is-left"),L.__value="positive",L.value=L.__value,I.__value="negative",I.value=I.__value,A.__value="input",A.value=A.__value,k.disabled=e[6],m(k,"id","example-select"),m(k,"class","form-control svelte-wq6b7c"),void 0===e[9]&&z(()=>e[19].call(k)),m(v,"class","select"),m(d,"class","control is-very-small has-icons-left svelte-wq6b7c"),m(d,"title","Change input using different examples"),m(C,"class","icon"),b(C,"margin-right","5px"),m(R,"id","hover-label-text"),m(M,"class","button is-very-small is-link is-light svelte-wq6b7c"),m(M,"id","hover-label"),b(M,"opacity",e[4].show?1:0),m(s,"class","left-control svelte-wq6b7c"),m(F,"class","icon"),m(G,"id","hover-label-text"),m(H,"class","button is-very-small svelte-wq6b7c"),m(H,"id","detailed-button"),H.disabled=e[6],$(H,"is-activated",e[2]),m(V,"class","icon is-left"),U.__value="local",U.value=U.__value,J.__value="module",J.value=J.__value,Q.__value="global",Q.value=Q.__value,m(K,"id","level-select"),K.disabled=e[6],m(K,"class","svelte-wq6b7c"),void 0===e[1]&&z(()=>e[20].call(K)),m(Y,"class","select svelte-wq6b7c"),m(B,"class","control is-very-small has-icons-left svelte-wq6b7c"),m(B,"title","Change color scale range"),m(_,"class","right-control svelte-wq6b7c"),m(a,"class","control-container svelte-wq6b7c"),m(te,"class","textarea svelte-wq6b7c"),m(te,"id","review-content"),m(te,"disabled",e[6]),m(te,"contenteditable","false"),void 0===e[10]&&z(()=>e[21].call(te)),m(ee,"class","review svelte-wq6b7c"),m(ie,"id","rnn-svg"),m(ie,"class","svelte-wq6b7c"),m(ne,"class","rnn svelte-wq6b7c"),m(ne,"id","rnnView"),m(t,"class","rnnOverview svelte-wq6b7c"),m(oe,"id","detailview")},m(l,o){r(l,t,o),i(t,a),i(a,s),i(s,d),i(d,h),i(d,f),i(d,v),i(v,k),i(k,L),i(k,I),i(k,A),w(k,e[9]),i(s,N),i(s,M),i(M,C),i(M,E),i(M,R),i(R,S),i(a,T),i(a,_),i(_,H),i(H,F),i(H,O),i(H,G),i(_,P),i(_,B),i(B,V),i(B,W),i(B,Y),i(Y,K),i(K,U),i(K,J),i(K,Q),w(K,e[1]),i(t,Z),i(t,ee),i(ee,te),i(te,ae),void 0!==e[10]&&(te.textContent=e[10]),i(t,le),i(t,ne),me&&me.m(ne,null),i(ne,se),i(ne,ie),e[22](t),r(l,re,o),r(l,oe,o),~de&&xe[de].m(oe,null),ue=!0,pe||(ge=[y(k,"change",e[19]),y(k,"change",(function(){n(e[6]?"":e[15])&&(e[6]?"":e[15]).apply(this,arguments)})),y(H,"click",e[16]),y(K,"change",e[20]),y(te,"input",e[21]),y(te,"focus",e[13]),y(te,"blur",e[14])],pe=!0)},p(t,a){e=t,(!ue||64&a[0])&&(k.disabled=e[6]),512&a[0]&&w(k,e[9]),(!ue||16&a[0])&&he!==(he=e[4].text+"")&&x(S,he),(!ue||16&a[0])&&b(M,"opacity",e[4].show?1:0),(!ue||64&a[0])&&(H.disabled=e[6]),4&a[0]&&$(H,"is-activated",e[2]),(!ue||64&a[0])&&(K.disabled=e[6]),2&a[0]&&w(K,e[1]),(!ue||768&a[0])&&ye!==(ye=e[8][e[9]]+"")&&x(ae,ye),(!ue||64&a[0])&&m(te,"disabled",e[6]),1024&a[0]&&e[10]!==te.textContent&&(te.textContent=e[10]),e[7]?me&&(q(),D(me,1,1,()=>{me=null}),X()):me?128&a[0]&&j(me,1):(me=ar(),me.c(),j(me,1),me.m(ne,se));let l=de;de=ve(e),de===l?~de&&xe[de].p(e,a):(ce&&(q(),D(xe[l],1,1,()=>{xe[l]=null}),X()),~de?(ce=xe[de],ce||(ce=xe[de]=fe[de](e),ce.c()),j(ce,1),ce.m(oe,null)):ce=null)},i(e){ue||(j(me),j(ce),ue=!0)},o(e){D(me),D(ce),ue=!1},d(a){a&&o(t),me&&me.d(),e[22](null),a&&o(re),a&&o(oe),~de&&xe[de].d(),pe=!1,l(ge)}}}const ir="Please input your review within 100 words.";function rr(e,t,a){const l={model:"/rnnExplainer/resources/model.json",metadata:"/rnnExplainer/resources/metadata.json"};let n,s=new Set(["local","module","global"]),i="local";$e.set(i);let r=i,o=void 0,d=void 0,c=void 0;const u=ya.nodeLength,p=ya.embedddingLength,g=ya.inputNodeHeight,h=ya.numLayers,y=ya.edgeOpacity,m=ya.edgeInitColor,f=ya.edgeHoverColor,x=ya.edgeStrokeWidth,v=ya.svgPaddings,b=ya.overlayRectOffset;let w=[void 0,void 0];Ae.subscribe(e=>{w=e});let $=void 0;ke.subscribe(e=>{$=e});let L=void 0;Le.subscribe(e=>{L=e});let I=void 0;Ie.subscribe(e=>{I=e});let A=void 0;Ne.subscribe(e=>{a(2,A=e)}),Me.subscribe(e=>{}),be.subscribe(e=>{});let M=void 0;we.subscribe(e=>{M=e});let C=void 0;Ce.subscribe(e=>{C=e});let E=void 0;Ee.subscribe(e=>{a(3,E=e)});let S=void 0;Se.subscribe(e=>{a(4,S=e)}),_e.subscribe(e=>{});let T=void 0;Te.subscribe(e=>{T=e});let _=void 0,H=void 0,z=void 0,F={layerName:"",index:-1,data:null},O=!1,G=!1,P=-1,B=-1,V=void 0,q=!1,X=void 0;const j={input:0,embedding_Embedding1:1,lstm_LSTM1:2,dense_Dense1:3},D={0:{local:"input-legend",module:"input-legend",global:"input-legend"},1:{local:"local-legend-0-1",module:"module-legend-0",global:"global-legend"},2:{local:"local-legend-0-1",module:"module-legend-0",global:"global-legend"},3:{local:"output-legend",module:"output-legend",global:"output-legend"}},W={input:ir,empty:"Helpless Waiting... The text here is for testing as rendering 100 words representation will cost much time I will seek to improve the response speed later",positive:"die hard mario fan and i loved this game br br this game starts slightly boring but trust me it's worth it as soon as you start your hooked the levels are fun and exiting they will hook you OOV your mind turns to mush i'm not kidding this game is also orchestrated and is beautifully done br br to keep this spoiler free i have to keep my mouth shut about details but please try this game it'll be worth it br br story 9 9 action 10 1 it's that good OOV 10 attention OOV 10 average 10",negative:"the mother in this movie is reckless with her children to the point of neglect i wish i wasn't so angry about her and her actions because i would have otherwise enjoyed the flick what a number she was take my advise and fast forward through everything you see her do until the end also is anyone else getting sick of watching movies that are filmed so dark anymore one can hardly see what is being filmed as an audience we are impossibly involved with the actions on the screen so then why the hell can't we have night vision"};let Y,K,U,J,Q="negative",Z=Q,ee=!0;const te=async()=>{console.time("Construct rnn"),a(7,X=await K.constructNN(W[Q],z)),console.timeEnd("Construct rnn");let e=X[X.length-2];a(7,X.lstm=e,X),xe.set(X),console.log("rnn layers are: ",X),T=K.inputArray,Te.set(T),hi(U),console.log("rnn layer ranges and MinMax are: ",L,I),gi()},ae=()=>{if(void 0!==V)c.select("rect#underneath-gateway-"+V).style("opacity",0),V=void 0;else if(C)c.select(".sigmoid-symbol").dispatch("click");else if(O){let e=j[F.layerName];le(e,F.domG,F.domI),d3.select(F.domG[F.domI]).dispatch("mouseleave")}else G&&ne()},le=(e,t,l)=>{C&&(c.select(".logit-layer").remove(),c.select(".logit-layer-lower").remove(),c.selectAll(".plus-symbol-clone").remove(),c.select(".underneath").selectAll(".logit-lower").style("opacity",0),Ee.set({show:!1,logits:[]}),Re.set(!1)),Ce.set(!1),O=!1,c.selectAll(`.${i}-legend`).classed("hidden",!A),c.selectAll(".input-legend").classed("hidden",!A),c.selectAll(".output-legend").classed("hidden",!A),a(6,q=!1);for(let t=0;t<X[e-1].length;t++)c.select(`g#layer-${e-1}-node-${t}`).on("mouseover",de).on("mouseleave",ce).on("click",oe);c.select("g.underneath").selectAll("rect").remove(),V=void 0,c.select("g#rnn-layer-group-"+(e-1)).selectAll("rect.bounding").style("stroke-width",1),d3.select(t[l]).select("rect.bounding").style("stroke-width",1),c.selectAll(`g#layer-label-${e-1},\n      g#layer-detailed-label-${e-1},\n      g#layer-label-${e},\n      g#layer-detailed-label-${e}`).style("font-weight","normal"),a(5,F.layerName="",F),a(5,F.index=-1,F),a(5,F.data=null,F);let n=c.select("g.intermediate-layer");if(Me.set(!1),n.transition("remove").duration(500).ease(d3.easeCubicInOut).style("opacity",0).on("end",(e,t,a)=>{d3.select(a[t]).remove()}),c.selectAll(".overlay-group").remove(),c.selectAll("g.intermediate-layer-overlay, g.intermediate-layer-annotation").transition("remove").duration(500).ease(d3.easeCubicInOut).style("opacity",0).on("end",(e,t,a)=>{c.selectAll("g.intermediate-layer-overlay, g.intermediate-layer-annotation").remove(),c.selectAll("defs.overlay-gradient").remove()}),void 0!==w[0]){let e=L[i][w[0]];void 0!==w[1]?c.select(`g#layer-${w[0]}-node-${w[1]}`).select("image.node-image").each((t,a,l)=>drawOutput(t,a,l,e)):c.select("g#rnn-layer-group-"+w[0]).selectAll("image.node-image").each((t,a,l)=>drawOutput(t,a,l,e))}for(let e=0;e<h;e++)ks({layerIndex:e,targetX:$[e][0].x,disable:!1,delay:500,opacity:1});ks({layerIndex:h-1,targetX:$[h-1][0].x,opacity:1,disable:!1,delay:800,onEndFunc:()=>{c.select("g.edge-group").style("visibility","visible"),c.select(".lstm-annotation").classed("hidden",!1),c.select(".input-annotation").classed("hidden",!1)}})},ne=()=>{G=!1,P=-1;let e=j[F.layerName],t=F.index;c.select(`g#layer-${e}-node-${t}`).select("rect.bounding").classed("hidden",!0),F.data.inputLinks.forEach(e=>{let t=j[e.source.layerName],a=e.source.index;c.select(`g#layer-${t}-node-${a}`).select("rect.bounding").classed("hidden",!0)}),c.select("g.underneath").selectAll("rect").remove();c.select("g.edge-group").selectAll(".edge").filter(e=>e.targetLayerIndex!==B).style("visibility",null);a(6,q=!1),c.selectAll(`.${i}-legend`).classed("hidden",!A),c.selectAll(".input-legend").classed("hidden",!A),c.selectAll(".output-legend").classed("hidden",!A),c.select("g.rnn-group").select("g.edge-group").selectAll(`path.edge-${e}-${t}`).transition().ease(d3.easeCubicOut).duration(200).style("stroke",m).style("stroke-width",x).style("opacity",y),c.selectAll("g.intermediate-layer-overlay, g.intermediate-layer-annotation").transition("remove").duration(500).ease(d3.easeCubicInOut).style("opacity",0).on("end",(e,t,a)=>{c.selectAll("g.intermediate-layer-overlay, g.intermediate-layer-annotation").remove(),c.selectAll("defs.overlay-gradient").remove(),c.select(".input-annotation").classed("hidden",!1)}),c.select("g#rnn-layer-group-"+e).selectAll("g.node-group").each((e,t,a)=>{d3.select(a[t]).style("pointer-events","all")}),c.select("g#rnn-layer-group-"+(e-1)).selectAll("g.node-group").each((e,t,a)=>{d3.select(a[t]).style("pointer-events","all").on("mouseover",de).on("mouseleave",ce).on("click",oe)}),a(5,F.layerName="",F),a(5,F.index=-1,F),a(5,F.data=null,F),B=-1},se=(e,t,a)=>{let l=j[e.layerName],n=e.index;c.select("g.rnn-group").select("g.edge-group").selectAll(`path.edge-${B}-${n}`).raise().transition().ease(d3.easeCubicInOut).duration(400).style("stroke",f).style("stroke-width","1").style("opacity",1),d3.select(a[t]).select("rect.bounding").classed("hidden",!1);let s=l-1;l===B-1&&(s=l+1),c.select(`g#layer-${s}-node-${n}`).select("rect.bounding").classed("hidden",!1)},ie=(e,t,a)=>{let l=j[e.layerName],n=e.index;c.select("g.rnn-group").select("g.edge-group").selectAll(`path.edge-${B}-${n}`).transition().ease(d3.easeCubicOut).duration(200).style("stroke",m).style("stroke-width",x).style("opacity",y),d3.select(a[t]).select("rect.bounding").classed("hidden",!0);let s=l-1;l===B-1&&(s=l+1),c.select(`g#layer-${s}-node-${n}`).select("rect.bounding").classed("hidden",!0)},re=(e,t,a)=>{let l=j[e.layerName],n=e.index;c.select(`g#layer-${l+1}-node-${n}`).node().dispatchEvent(new Event("click"))},oe=(e,t,l)=>{d3.event.stopPropagation();let n=e.index;if(a(5,F.layerName=e.layerName,F),a(5,F.index=e.index,F),a(5,F.data=e,F),a(5,F.domI=t,F),a(5,F.domG=l,F),"embedding"===e.type||"lstm"===e.type||"dense"===e.type){let t=[];for(let a=0;a<e.inputLinks.length;a++)t.push({input:e.inputLinks[a].source.output,kernel:e.inputLinks[a].weight,output:e.inputLinks[a].dest.output});let l=j[e.layerName];t.colorRange=L[i][l],t.isInputInputLayer=l<=1,a(11,J=t)}let s=j[e.layerName];if("embedding"===e.type)if(a(12,ee=!1),G)if(e.index===P)ne();else{c.select(`g#layer-${s}-node-${P}`).select("rect.bounding").classed("hidden",!0),c.select(`g#layer-${s-1}-node-${P}`).select("rect.bounding").classed("hidden",!0);let e=c.select("g.rnn-group").select("g.edge-group");e.selectAll(`path.edge-${s}-${P}`).transition().ease(d3.easeCubicOut).duration(200).style("stroke",m).style("stroke-width",x).style("opacity",y);let t=c.select("g.underneath");t.select("#underneath-gateway-"+P).style("opacity",0),c.select(`g#layer-${s}-node-${n}`).select("rect.bounding").classed("hidden",!1),c.select(`g#layer-${s-1}-node-${n}`).select("rect.bounding").classed("hidden",!1),e.selectAll(`path.edge-${s}-${n}`).raise().transition().ease(d3.easeCubicInOut).duration(400).style("stroke",f).style("stroke-width","1").style("opacity",1),t.select("#underneath-gateway-"+n).style("opacity",1),P=n}else((e,t)=>{G=!0,P=t,B=e;let l=d3.select("#rnn-svg"),n=+l.style("height").replace("px","")/2,s=+l.style("width").replace("px",""),r=100+n-130,o=0;e>2?(o=$[e-1][0].x+50,o=o/2-250):(o=(s-$[e][0].x-u)/2,o=$[e][0].x+u+o-250);const d=document.getElementById("detailview");d.style.top=r+"px",d.style.left=o+"px",d.style.position="absolute";c.select("g.edge-group").selectAll(".edge").filter(t=>t.targetLayerIndex!==e).style("visibility","hidden");a(6,q=!0),c.select(".input-annotation").classed("hidden",!0),c.selectAll(`.${i}-legend`).classed("hidden",!0),c.selectAll(".input-legend").classed("hidden",!0),c.selectAll(".output-legend").classed("hidden",!0),c.select("#"+D[e][i]).classed("hidden",!1);let h=$[e-1][t].x,y=$[e][t].x+u+5;1===e&&(y=y-u+p);let m=_-y-b/2,f=h-$[0][0].x;if(m>f){let e=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.9},{offset:"100%",color:"rgb(250, 250, 250)",opacity:1}];$s("overlay-gradient-right",e),e=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85+f/m*(.95-.85)},{offset:"100%",color:"rgb(250, 250, 250)",opacity:.85}],$s("overlay-gradient-left",e)}else{let e=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:1},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.9},{offset:"100%",color:"rgb(250, 250, 250)",opacity:.85}];$s("overlay-gradient-left",e),e=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85},{offset:"100%",color:"rgb(250, 250, 250)",opacity:.85+m/f*(.95-.85)}],$s("overlay-gradient-right",e)}mi("overlay-gradient-right",y+b/2+.5,0,m,H+v.top),mi("overlay-gradient-left",$[0][0].x-b/2,0,f,H+v.top),c.selectAll("rect.overlay").on("click",ae);let x=c.select("g.underneath");for(let t=0;t<X[e-1].length;t++)x.append("rect").attr("class","underneath-gateway").attr("id","underneath-gateway-"+t).attr("x",$[e-1][t].x-1).attr("y",$[e-1][t].y-1).attr("width",1*u+1*p+M+2).attr("height",g+2).attr("rx",10).style("fill","rgba(160, 160, 160, 0.3)").style("opacity",0),c.select(`g#layer-${e-1}-node-${t}`).style("pointer-events","all").style("cursor","pointer").on("mouseover",se).on("mouseleave",ie).on("click",re);x.lower(),x.select("#underneath-gateway-"+t).style("opacity",1)})(s,e.index);"lstm"!==e.type&&"dense_Dense1"!==e.layerName||O?"lstm"!==e.type&&"dense_Dense1"!==e.layerName||!O||le(s,l,t):(((e,t,l,n)=>{O=!0,c.selectAll(`.${i}-legend`).classed("hidden",!0),c.selectAll(".input-legend").classed("hidden",!0),c.selectAll(".output-legend").classed("hidden",!0),c.select(".input-annotation").classed("hidden",!0),c.select(".lstm-annotation").classed("hidden",!0),c.select("g#rnn-layer-group-"+(n-1)).selectAll("rect.bounding").style("stroke-width",2),d3.select(t[l]).select("rect.bounding").style("stroke-width",2),a(6,q=!0),Me.set(!0),c.selectAll(`g#layer-label-${n-1},\n      g#layer-detailed-label-${n-1},\n      g#layer-label-${n},\n      g#layer-detailed-label-${n}`).style("font-weight","800"),d3.select("#rnn-svg").on("click",ae)})(0,l,n,s),"dense_Dense1"===e.layerName?((e,t,a,l,n)=>{Ei.selectAll(".output-legend").classed("hidden",!1);let s=vi/2,i=2*vi+2*Si*Ni+s,r=_i[e][0].x-i,o=Si*Ni*1/2;let d=d3.linkHorizontal().x(e=>e.x).y(e=>e.y);Ei.select("g.edge-group").style("visibility","hidden"),ks({layerIndex:e-1,targetX:r,disable:!0,delay:0}),ks({layerIndex:e,targetX:_i[e][0].x,disable:!0,delay:0,opacity:.15,specialIndex:a});let c=(r-Si-_i[0][0].x-(xi-3)*vi-ki)/(xi-2);if(c>20)for(let t=0;t<e-1;t++){let e;e=t<1?_i[0][0].x+t*(vi+c):_i[0][0].x+t*c+(t-1)*vi+ki,ks({layerIndex:t,targetX:e,disable:!0,delay:0})}else{c=20;let t=r-2*c-ki;for(let a=e-2;a>=0;a--)ks({layerIndex:a,targetX:t,disable:!0,delay:0}),t=t-c-vi}$s("overlay-gradient-left",[{offset:"0%",color:"rgb(250, 250, 250)",opacity:1},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.95},{offset:"100%",color:"rgb(250, 250, 250)",opacity:.85}]);let u=Ei.append("g").attr("class","intermediate-layer-overlay");u.append("rect").attr("class","overlay").style("fill","url(#overlay-gradient-left)").style("stroke","none").attr("width",r+Ai.left-2*c+3).attr("height",n+Ai.top+Ai.bottom).attr("x",-Ai.left).attr("y",0).style("opacity",0),u.selectAll("rect.overlay").transition("move").duration(800).ease(d3.easeCubicInOut).style("opacity",1);let p=Ei.append("g").attr("class","intermediate-layer").style("opacity",0),g=r+vi+o,h=g+o+s,y=(zi[Hi][e-1],Ti.lstm.length),m=[],f=p.append("g").attr("class","dense-layer").append("g").attr("class","lstm-layer-left"),x=_i[e-1][0].y,v=Ti[e-1].length-1,b=_i[e-1][v].y+bi-1.1*y,w=bi/1,k=zi[Hi][e-1],$=e=>{let t=e.index;if(void 0===e.weight){let e=Ti.lstm[t].output.map(d3.format(".2f"));Bi={show:!0,text:"lstm output: "+e}}else{let t=e.weight.map(d3.format(".2f"));Bi={show:!0,text:"Weight: "+t}}Se.set(Bi),f.select(`#edge-lstm-${t}-output`).raise().style("stroke-width",1).style("stroke",e=>ys(fi.weight,k,e.weight,.1)),f.select("#bounding-"+t).raise().style("opacity",1)},L=e=>{let t=e.index;Bi=(e.weight,{show:!1,text:""}),Se.set(Bi),f.select(`#edge-lstm-${t}-output`).style("stroke-width",(e,t)=>e.width).style("stroke",e=>ys(fi.weight,k,e.weight,.35)),f.select("#bounding-"+t).raise().style("opacity",0)};for(let t=0;t<y;t++){m.push({source:{x:r+vi+3,y:_i[e-1][t].y+bi/2},target:{x:h,y:_i[e][a].y+bi/2},index:t,weight:Ti.lstm[t].outputLinks[a].weight,name:`lstm-${t}-output`,color:ys(fi.weight,k,Ti.lstm[t].outputLinks[a].weight,.35),width:1.2,opacity:.7,class:"lstm-output"});Ti.lstm[t].outputLinks[0].weight;f.append("rect").attr("id","bounding-"+t).attr("class","lstm-bounding").attr("x",r).attr("y",_i[e-1][t].y).attr("width",vi).attr("height",w).style("fill","none").style("stroke",Li).style("stroke-length","0.2").style("pointer-events","all").style("cursor","crosshair").style("opacity",0).on("mouseover",()=>$({index:t})).on("mouseleave",()=>L({index:t})).on("click",()=>{d3.event.stopPropagation()})}let I=n,A=h+$i,N=_i[e][a].y+bi/2,M=f.append("g").attr("class","plus-symbol").attr("transform",`translate(${A}, ${N})`);var C;M.append("rect").attr("x",-$i).attr("y",-$i).attr("width",2*$i).attr("height",2*$i).attr("rx",3).attr("ry",3).style("fill","none").style("stroke",Li),M.append("rect").attr("x",-($i-3)).attr("y",-.5).attr("width",2*($i-3)).attr("height",1).style("fill",Li),M.append("rect").attr("x",-.5).attr("y",-($i-3)).attr("width",1).attr("height",2*($i-3)).style("fill",Li),M.append("circle").attr("cx",0).attr("cy",-vi/2-.5*Ii).attr("r",1.5*Ii).style("stroke",Li).style("cursor","crosshair").style("fill",ys(fi.weight,k,t.bias,.35)).on("mouseover",()=>{Se.set({show:!0,text:"Bias: "+Ci(t.bias)})}).on("mouseleave",()=>{Se.set({show:!1,text:"Bias: "+Ci(t.bias)})}).on("click",()=>{d3.event.stopPropagation()}),M.append("path").attr("d",d({source:{x:0,y:0},target:{x:0,y:-vi/2-.5*Ii}})).attr("id","bias-plus").attr("stroke-width",1.2).attr("stroke","#E5E5E5").lower(),m.push({source:(C={x:h+2*$i-vi,y:_i[e][a].y-vi/2+bi/2},{x:C.x+ds,y:C.y+ds/2}),target:hs({x:_i[e][a].x-3,y:_i[e][a].y-vi/2+bi/2}),name:"symbol-output",width:1.2,color:"#E5E5E5"});let E=(i-2*vi-2*o-55)/2,R=h+2*$i,S=E+R,T=E/2+R,_=_i[e][a].y-2*Ii-2*bi,H={curLayerIndex:e,moveX:2*(h-(g+s+3))/3,symbolX:A,symbolY:N,outputX:_i[e][a].x,outputY:N,sigmoidLeftMid:T,selectedI:a,intermediateX1:g,intermediateX2:h,pixelWidth:s,pixelHeight:1.1,topY:x,bottomY:b,middleGap:5,middleRectHeight:I,sigmoidX:S,sigmoidWidth:55,sigmoidTextY:_,symbolGroup:M,lstmRange:k},z=p.append("g").attr("class","sigmoid-symbol").attr("transform",`translate(${S}, ${N})`).style("pointer-event","all").style("cursor","pointer").on("click",()=>tr(H));z.append("rect").attr("x",0).attr("y",-$i).attr("width",55).attr("height",2*$i).attr("stroke",Li).attr("rx",2).attr("ry",2).attr("fill","#FAFAFA"),z.append("text").attr("x",5).attr("y",1).style("dominant-baseline","middle").style("font-size","12px").style("opacity",.5).text("Sigmoid");p.append("g").attr("class","layer-label").classed("hidden",Vi).attr("transform",()=>`translate(${S}, ${Di})`).style("cursor","help").on("click",()=>{d3.event.stopPropagation(),document.querySelector("#article-lstm").scrollIntoView({behavior:"smooth"})});let F=Number(d3.select("#rnn-svg").style("height").replace("px",""))+150,O=(new SmoothScroll('a[href*="#"]',{offset:-F}),f.append("g").attr("class","edge-group").lower());O.selectAll("path").data(m).enter().append("path").attr("class",e=>e.class).classed("flow-edge",e=>"output-next"!==e.name).attr("id",e=>"edge-"+e.name).attr("d",e=>d({source:e.source,target:e.target})).style("fill","none").style("stroke-width",e=>e.width).style("stroke",e=>void 0===e.color?Li:e.color).style("opacity",e=>e.opacity),O.selectAll("path.flow-edge").attr("stroke-dasharray","4 2").attr("stroke-dashoffset",0).each((e,t,a)=>Ki(e,t,a,-1e3)),O.selectAll("path.lstm-output,path.lstm-output").style("cursor","crosshair").style("pointer-events","all").on("mouseover",$).on("mouseleave",L).on("click",()=>{d3.event.stopPropagation()});let G=Ai.top+Ri*(Ti[Ti.length-1].length+1)+3*wi;Ls({legendHeight:5,curLayerIndex:e,range:k,minMax:Fi[e-1],group:p,width:h-r,gradientAppendingName:"lstm-weight-gradient",gradientGap:.1,colorScale:fi.weight,x:r,y:G});let P=Ei.append("g").attr("class","intermediate-layer-annotation").style("opacity",0),B=P.append("g").attr("class","plus-annotation"),V=h,q=_i[e][a].y+bi+3*$i,X=_i[e][a].y+bi+2*$i,j=_i[e][a].y+bi+$i;9==a&&(q-=110,X-=70,j-=18);let D=B.append("text").attr("x",V).attr("y",q).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor","middle");D.append("tspan").style("dominant-baseline","hanging").text("Add up all products"),D.append("tspan").attr("x",V).attr("dy","1em").style("dominant-baseline","hanging").text("("),D.append("tspan").style("fill","#66a3c8").style("dominant-baseline","hanging").text("element"),D.append("tspan").style("dominant-baseline","hanging").text(" × "),D.append("tspan").style("dominant-baseline","hanging").style("fill","#b58946").text("weight"),D.append("tspan").style("dominant-baseline","hanging").text(")"),D.append("tspan").attr("x",V).attr("dy","1em").style("dominant-baseline","hanging").text("and then "),D.append("tspan").style("dominant-baseline","hanging").style("fill","#479d94").text("bias"),Is({group:B,sx:h-2*$i-3,sy:X,tx:h-5,ty:j,dr:30,hFlip:9===a,marker:"marker-alt"});let W=N-vi/2-Ii;W-=2*Ii+4,f.append("text").attr("class","annotation-text").attr("x",h+$i).attr("y",W).style("text-anchor","middle").style("dominant-baseline","baseline").text("Bias");let Y=P.append("g").attr("class","sigmoid-annotation");Y.append("text").attr("x",S+27.5).attr("y",_).attr("class","annotation-text").style("dominant-baseline","baseline").style("text-anchor","middle").style("font-weight",700).text("Click ").append("tspan").attr("dx",1).style("font-weight",400).text("to learn more"),Is({group:Y,sx:S+27.5-5,sy:_+4,tx:S+27.5,ty:N-$i-4,dr:50,hFlip:!0});let K=P.append("g").attr("class","output-annotation"),U=Xi;K.append("text").attr("x",_i[U][a].x).attr("y",_i[U][a].y-bi).attr("class","annotation-text").text(`(${d3.format(".4f")(Ti[U][a].output)})`),Ei.selectAll("g.intermediate-layer, g.intermediate-layer-annotation").transition().delay(500).duration(500).ease(d3.easeCubicInOut).style("opacity",1)})(s,e,n,0,H):e.layerName)},de=(e,t,a)=>{if(O)return;let l=j[e.layerName],n=e.index;if(c.select("g.rnn-group").select("g.edge-group").selectAll(`path.edge-${l}-${n}`).raise().transition().ease(d3.easeCubicInOut).duration(400).style("stroke",f).style("stroke-width","1").style("opacity",1),d3.select(a[t]).select("rect.bounding").classed("hidden",!1),1===e.inputLinks.length){let t=e.inputLinks[0],a=j[t.source.layerName],l=t.source.index;c.select(`g#layer-${a}-node-${l}`).select("rect.bounding").classed("hidden",!1)}else c.select("g#rnn-layer-group-"+(l-1)).selectAll("g.node-group").selectAll("rect.bounding").classed("hidden",!1);'"dense_Dense1"'===e.layerName&&d3.select(a[t]).select(".output-text").style("opacity",.8).style("text-decoration","underline")},ce=(e,t,a)=>{if(!O&&(G||e.layerName!==F.layerName||e.index!==F.index)){let l=j[e.layerName],n=e.index;if(c.select("g.rnn-group").select("g.edge-group").selectAll(`path.edge-${l}-${n}`).transition().ease(d3.easeCubicOut).duration(200).style("stroke",m).style("stroke-width",e=>2===e.targetLayerIndex?x:4*x).style("opacity",y),"dense"!==e.type&&d3.select(a[t]).select("rect.bounding").classed("hidden",!0),1===e.inputLinks.length){let t=e.inputLinks[0],a=j[t.source.layerName],l=t.source.index;c.select(`g#layer-${a}-node-${l}`).select("rect.bounding").classed("hidden",!0)}else c.select("g#rnn-layer-group-"+(l-1)).selectAll("g.node-group").selectAll("rect.bounding").classed("hidden",e=>e.layerName!==F.layerName||e.index!==F.index);"dense_Dense1"===e.layerName&&d3.select(a[t]).select(".output-text").style("fill","black").style("opacity",.5).style("text-decoration","none")}};return N(async()=>{console.log("-----------Creating RNN---------------"),o=d3.select(n),_=Number(o.style("width").replace("px",""))-v.left-v.right,d=d3.select(n).select("#rnn-svg"),c=d.append("g").attr("class","main-svg").attr("transform",`translate(${v.left}, 0)`),ve.set(c),H=Number(d.style("height").replace("px",""))-v.top-v.bottom;let e=c.append("g").attr("class","rnn-group");c.append("g").attr("class","underneath"),d.style("height").replace("px","");c.append("defs").append("marker").attr("id","marker").attr("viewBox","0 -5 10 10").attr("refX",6).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").style("stroke-width",1.2).style("fill","gray").style("stroke","gray").attr("d","M0,-5L10,0L0,5"),c.append("defs").append("marker").attr("id","marker-alt").attr("viewBox","0 -5 10 10").attr("refX",6).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").style("fill","none").style("stroke","gray").style("stroke-width",2).attr("d","M-5,-10L10,0L-5,10"),K=await(new ns).init(l),z=K.model,console.log("The rnn model is: ",z),((e,t)=>{if(K){let a=K.predictResult(e,t);console.log("Direct Result: Inference result (0 - negative; 1 - positive): "+a.score.toFixed(6)+" (elapsed: "+a.elapsed.toFixed(2)+" ms)")}else console.log("something went wrong with predictor")})(""+W[Q],z),console.time("Construct rnn"),a(7,X=await K.constructNN(""+W[Q],z)),console.timeEnd("Construct rnn");let t=X[X.length-2];a(7,X.lstm=t,X),xe.set(X),console.log("rnn layers are: ",X),T=K.inputArray,Te.set(T),U=z.layers[0].inputDim,hi(U),console.log("rnn layer ranges and MinMax are: ",L,I),pi(_,H,e,de,ce,oe)}),e.$$.update=()=>{2&e.$$.dirty[0]&&(()=>{if(void 0!==c){if(s.add(i)||console.error("Encounter unknown scale level!"),i!=r){({local:{module:[1,2],global:[1,2,3,4]},module:{local:[1,2],global:[1,2,3,4]},global:{local:[1,2,3,4],module:[1,2,3,4]}})[r][i].forEach(e=>{let t=L[i][e];c.select("#rnn-layer-group-"+e).selectAll(".node-image").each((e,a,l)=>Qs(e,a,l,t))}),c.selectAll(`.${r}-legend`).classed("hidden",!0),c.selectAll(`.${i}-legend`).classed("hidden",!A)}r=i,$e.set(i)}})()},[n,i,A,E,S,F,q,X,W,Q,Y,J,ee,async()=>{Y===ir&&a(10,Y="")},async()=>{""===Y.trim()?console.log("The current review content is empty, please write down your review."):Y.trim()===W[Q]?console.log("The current Review content does not change"):(a(8,W[Q]=Y.trim(),W),te())},async()=>{Q===Z?console.log("The current Review Option does not change"):(Z=Q,a(10,Y=W[Q]),console.log("The current Review is: ",Q),console.log("The reviewContent is: ",Y),"input"!==Q?(d3.select("#review-content").attr("contenteditable","false"),te()):(d3.select("#review-content").attr("contenteditable","true"),Y!==ir&&te()))},()=>{a(2,A=!A),Ne.set(A),O||(c.selectAll(`.${i}-legend`).classed("hidden",!A),c.selectAll(".input-legend").classed("hidden",!A),c.selectAll(".output-legend").classed("hidden",!A)),c.selectAll(".layer-detailed-label").classed("hidden",!A),c.selectAll(".layer-label").classed("hidden",A)},function(e){e.detail.text&&(ne(),a(12,ee=!0))},function(e){a(3,E.show=!1,E),Ee.set(E)},function(){Q=k(this),a(9,Q)},function(){i=k(this),a(1,i)},function(){Y=this.textContent,a(10,Y)},function(e){R[e?"unshift":"push"](()=>{n=e,a(0,n)})}]}class or extends Q{constructor(e){super(),J(this,e,rr,sr,s,{},[-1,-1,-1])}}function dr(e){let t,a;return t=new or({}),{c(){W(t.$$.fragment)},m(e,l){Y(t,e,l),a=!0},i(e){a||(j(t.$$.fragment,e),a=!0)},o(e){D(t.$$.fragment,e),a=!1},d(e){K(t,e)}}}function cr(e){let t,a;return t=new Cn({}),{c(){W(t.$$.fragment)},m(e,l){Y(t,e,l),a=!0},i(e){a||(j(t.$$.fragment,e),a=!0)},o(e){D(t.$$.fragment,e),a=!1},d(e){K(t,e)}}}function ur(e){let t,a,l,n;const s=[cr,dr],i=[];function d(e,t){return"CNN"===e[0]?0:"RNN"===e[0]?1:-1}return~(a=d(e))&&(l=i[a]=s[a](e)),{c(){t=c("div"),l&&l.c(),m(t,"id","explainer"),m(t,"class","svelte-1afhocu")},m(e,l){r(e,t,l),~a&&i[a].m(t,null),n=!0},p(e,[n]){let r=a;a=d(e),a!==r&&(l&&(q(),D(i[r],1,1,()=>{i[r]=null}),X()),~a?(l=i[a],l||(l=i[a]=s[a](e),l.c()),j(l,1),l.m(t,null)):l=null)},i(e){n||(j(l),n=!0)},o(e){D(l),n=!1},d(e){e&&o(t),~a&&i[a].d()}}}function pr(e,t,a){let{nn:l}=t;return e.$set=e=>{"nn"in e&&a(0,l=e.nn)},[l]}class gr extends Q{constructor(e){super(),J(this,e,pr,ur,s,{nn:0})}}function hr(e,t,a){const l=e.slice();return l[3]=t[a],l}function yr(e){let t,a,l,n,s=e[3].alis+"";return{c(){t=c("option"),a=p(s),l=g(),t.__value=n=e[3],t.value=t.__value},m(e,n){r(e,t,n),i(t,a),i(t,l)},p(e,l){2&l&&s!==(s=e[3].alis+"")&&x(a,s),2&l&&n!==(n=e[3])&&(t.__value=n,t.value=t.__value)},d(e){e&&o(t)}}}function mr(t){let a,l,n,s,h,f,v,b,k,$,L,I,A,N,M,C,E,R,S,T,_,H,F,O,G,P,B,V,q=t[0].alis+"",X=t[0].name+"",j=t[0].alis+"",D=t[1],W=[];for(let e=0;e<D.length;e+=1)W[e]=yr(hr(t,D,e));return{c(){a=c("div"),l=c("div"),n=c("div"),s=p(q),h=p(" Explainer"),f=g(),v=u("svg"),b=u("defs"),k=u("filter"),$=u("feTurbulence"),L=u("feColorMatrix"),I=u("feComposite"),A=u("g"),N=u("text"),M=p("Learn "),C=p(X),E=p(" ("),R=p(j),S=p(") in your browser!"),T=g(),_=c("div"),H=c("span"),H.innerHTML='<i class="fas fa-bezier-curve"></i>',F=g(),O=c("div"),G=c("div"),P=c("select");for(let e=0;e<W.length;e+=1)W[e].c();m(n,"id","logo-text"),m(n,"class","svelte-164ls4c"),m($,"type","fractalNoise"),m($,"baseFrequency","2"),m($,"numOctaves","5"),m($,"stitchTiles","stitch"),m($,"result","f1"),m(L,"type","matrix"),m(L,"values","0 0 0 0 0, 0 0 0 0 0, 0 0 0 0 0, 0 0 0 -1.5 1.5"),m(L,"result","f2"),m(I,"operator","in"),m(I,"in2","f2"),m(I,"in","SourceGraphic"),m(I,"result","f3"),m(k,"x","0%"),m(k,"y","0%"),m(k,"width","100%"),m(k,"height","100%"),m(k,"filterUnits","objectBoundingBox"),m(k,"id","chalk-texture"),m(N,"id","svg-logo-tagline"),m(N,"x","20%"),m(N,"y","80%"),m(N,"class","svelte-164ls4c"),m(A,"class","svg-logo svelte-164ls4c"),m(A,"filter","url(#chalk-texture)"),m(v,"class","logo-svg svelte-164ls4c"),m(H,"class","icon is-right svelte-164ls4c"),m(P,"class","NNselector svelte-164ls4c"),void 0===t[0]&&z(()=>t[2].call(P)),m(G,"id","NN-select"),m(G,"class","svelte-164ls4c"),m(O,"class","select svelte-164ls4c"),m(_,"class","control is-very-small has-icons-left svelte-164ls4c"),m(_,"title","Change NN"),m(l,"id","logo"),m(l,"class","svelte-164ls4c"),m(a,"id","header"),m(a,"class","svelte-164ls4c")},m(e,o){r(e,a,o),i(a,l),i(l,n),i(n,s),i(n,h),i(l,f),i(l,v),i(v,b),i(b,k),i(k,$),i(k,L),i(k,I),i(v,A),i(A,N),i(N,M),i(N,C),i(N,E),i(N,R),i(N,S),i(l,T),i(l,_),i(_,H),i(_,F),i(_,O),i(O,G),i(G,P);for(let e=0;e<W.length;e+=1)W[e].m(P,null);w(P,t[0]),B||(V=y(P,"change",t[2]),B=!0)},p(e,[t]){if(1&t&&q!==(q=e[0].alis+"")&&x(s,q),1&t&&X!==(X=e[0].name+"")&&x(C,X),1&t&&j!==(j=e[0].alis+"")&&x(R,j),2&t){let a;for(D=e[1],a=0;a<D.length;a+=1){const l=hr(e,D,a);W[a]?W[a].p(l,t):(W[a]=yr(l),W[a].c(),W[a].m(P,null))}for(;a<W.length;a+=1)W[a].d(1);W.length=D.length}3&t&&w(P,e[0])},i:e,o:e,d(e){e&&o(a),d(W,e),B=!1,V()}}}function fr(e,t,a){let{NNs:l}=t,{selectedNN:n}=t;return e.$set=e=>{"NNs"in e&&a(1,l=e.NNs),"selectedNN"in e&&a(0,n=e.selectedNN)},[n,l,function(){n=k(this),a(0,n),a(1,l)}]}class xr extends Q{constructor(e){super(),J(this,e,fr,mr,s,{NNs:1,selectedNN:0})}}function vr(e){let t,a,l,n,s,d;function u(t){e[3].call(null,t)}let p={NNs:e[1]};return void 0!==e[0]&&(p.selectedNN=e[0]),a=new xr({props:p}),R.push(()=>function(e,t,a){const l=e.$$.props[t];void 0!==l&&(e.$$.bound[l]=a,a(e.$$.ctx[l]))}(a,"selectedNN",u)),s=new gr({props:{nn:e[0].alis}}),{c(){t=c("div"),W(a.$$.fragment),n=g(),W(s.$$.fragment),m(t,"id","app-page")},m(e,l){r(e,t,l),Y(a,t,null),i(t,n),Y(s,t,null),d=!0},p(e,[t]){const n={};var i;!l&&1&t&&(l=!0,n.selectedNN=e[0],i=()=>l=!1,T.push(i)),a.$set(n);const r={};1&t&&(r.nn=e[0].alis),s.$set(r)},i(e){d||(j(a.$$.fragment,e),j(s.$$.fragment,e),d=!0)},o(e){D(a.$$.fragment,e),D(s.$$.fragment,e),d=!1},d(e){e&&o(t),K(a),K(s)}}}function br(e,t,a){let{defaultNN:l}=t;const n=[{id:1,name:"Convolutional Neural Network",alis:"CNN"},{id:2,name:"Recurrent Neural Network",alis:"RNN"}];let s;return s=l&&"RNN"===l?n[1]:n[0],e.$set=e=>{"defaultNN"in e&&a(2,l=e.defaultNN)},[s,n,l,function(e){s=e,a(0,s)}]}return new class extends Q{constructor(e){super(),J(this,e,br,vr,s,{defaultNN:2})}}({target:document.body,props:{defaultNN:"RNN"}})}();
//# sourceMappingURL=bundle.js.map
